/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/CrudOperations.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.iterator";import"core-js/modules/es.array.concat";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.map";import"core-js/modules/es.array.reduce";import"core-js/modules/es.array.slice";import"core-js/modules/es.function.name";import"core-js/modules/es.number.constructor";import"core-js/modules/es.number.is-integer";import"core-js/modules/es.object.to-string";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.iterator";function _createForOfIteratorHelper(e,o){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||o&&e&&"number"==typeof e.length){t&&(e=t);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==t.return||t.return()}finally{if(a)throw s}}}}function _slicedToArray(e,o){return _arrayWithHoles(e)||_iterableToArrayLimit(e,o)||_unsupportedIterableToArray(e,o)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,o){if(e){if("string"==typeof e)return _arrayLikeToArray(e,o);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,o):void 0}}function _arrayLikeToArray(e,o){(null==o||o>e.length)&&(o=e.length);for(var t=0,r=new Array(o);t<o;t++)r[t]=e[t];return r}function _iterableToArrayLimit(e,o){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],r=!0,n=!1,s=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(t.push(i.value),!o||t.length!==o);r=!0);}catch(e){n=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,o){for(var t=0;t<o.length;t++){var r=o[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,o,t){return o&&_defineProperties(e.prototype,o),t&&_defineProperties(e,t),e}import{AbsoluteCellRange}from"./AbsoluteCellRange";import{invalidSimpleCellAddress,simpleCellAddress}from"./Cell";import{CellContent,isMatrix}from"./CellContentParser";import{ClipboardOperations}from"./ClipboardOperations";import{AddColumnsCommand,AddRowsCommand,Operations,RemoveColumnsCommand,RemoveRowsCommand}from"./Operations";import{doesContainRelativeReferences}from"./NamedExpressions";import{InvalidAddressError,InvalidArgumentsError,MatrixFormulasNotSupportedError,NamedExpressionDoesNotExistError,NamedExpressionNameIsAlreadyTakenError,NamedExpressionNameIsInvalidError,NoOperationToRedoError,NoOperationToUndoError,NoRelativeAddressesAllowedError,NoSheetWithIdError,NoSheetWithNameError,NothingToPasteError,SheetNameAlreadyTakenError,SheetSizeLimitExceededError,SourceLocationHasMatrixError,TargetLocationHasMatrixError}from"./errors";import{ColumnsSpan,RowsSpan}from"./Span";import{AddColumnsUndoEntry,AddNamedExpressionUndoEntry,AddRowsUndoEntry,AddSheetUndoEntry,ChangeNamedExpressionUndoEntry,ClearSheetUndoEntry,MoveCellsUndoEntry,MoveColumnsUndoEntry,MoveRowsUndoEntry,PasteUndoEntry,RemoveColumnsUndoEntry,RemoveNamedExpressionUndoEntry,RemoveRowsUndoEntry,RemoveSheetUndoEntry,RenameSheetUndoEntry,SetCellContentsUndoEntry,SetSheetContentUndoEntry,UndoRedo}from"./UndoRedo";import{findBoundaries,validateAsSheet}from"./Sheet";export var CrudOperations=function(){function e(o,t,r,n,s,i,a,d){_classCallCheck(this,e),this.config=o,this.stats=t,this.dependencyGraph=r,this.columnSearch=n,this.parser=s,this.cellContentParser=i,this.lazilyTransformingAstService=a,this.namedExpressions=d,this.operations=new Operations(this.dependencyGraph,this.columnSearch,this.cellContentParser,this.parser,this.stats,this.lazilyTransformingAstService,this.namedExpressions,this.config),this.clipboardOperations=new ClipboardOperations(this.dependencyGraph,this.operations,this.parser,this.lazilyTransformingAstService,this.config),this.undoRedo=new UndoRedo(this.config,this.operations)}return _createClass(e,[{key:"addRows",value:function(e){for(var o=arguments.length,t=new Array(o>1?o-1:0),r=1;r<o;r++)t[r-1]=arguments[r];var n=new AddRowsCommand(e,t);this.ensureItIsPossibleToAddRows.apply(this,[e].concat(t)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(n),this.undoRedo.saveOperation(new AddRowsUndoEntry(n))}},{key:"removeRows",value:function(e){for(var o=arguments.length,t=new Array(o>1?o-1:0),r=1;r<o;r++)t[r-1]=arguments[r];var n=new RemoveRowsCommand(e,t);this.ensureItIsPossibleToRemoveRows.apply(this,[e].concat(t)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var s=this.operations.removeRows(n);this.undoRedo.saveOperation(new RemoveRowsUndoEntry(n,s))}},{key:"addColumns",value:function(e){for(var o=arguments.length,t=new Array(o>1?o-1:0),r=1;r<o;r++)t[r-1]=arguments[r];var n=new AddColumnsCommand(e,t);this.ensureItIsPossibleToAddColumns.apply(this,[e].concat(t)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(n),this.undoRedo.saveOperation(new AddColumnsUndoEntry(n))}},{key:"removeColumns",value:function(e){for(var o=arguments.length,t=new Array(o>1?o-1:0),r=1;r<o;r++)t[r-1]=arguments[r];var n=new RemoveColumnsCommand(e,t);this.ensureItIsPossibleToRemoveColumns.apply(this,[e].concat(t)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var s=this.operations.removeColumns(n);this.undoRedo.saveOperation(new RemoveColumnsUndoEntry(n,s))}},{key:"moveCells",value:function(e,o,t,r){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var n=this.operations.moveCells(e,o,t,r),s=n.version,i=n.overwrittenCellsData,a=n.addedGlobalNamedExpressions;this.undoRedo.saveOperation(new MoveCellsUndoEntry(e,o,t,r,i,a,s))}},{key:"moveRows",value:function(e,o,t,r){this.ensureItIsPossibleToMoveRows(e,o,t,r),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.moveRows(e,o,t,r),this.undoRedo.saveOperation(new MoveRowsUndoEntry(e,o,t,r))}},{key:"moveColumns",value:function(e,o,t,r){this.ensureItIsPossibleToMoveColumns(e,o,t,r),this.undoRedo.clearRedoStack(),this.operations.moveColumns(e,o,t,r),this.undoRedo.saveOperation(new MoveColumnsUndoEntry(e,o,t,r))}},{key:"cut",value:function(e,o,t){this.clipboardOperations.cut(e,o,t)}},{key:"ensureItIsPossibleToCopy",value:function(e,o,t){if(!isPositiveInteger(o))throw new InvalidArgumentsError("width to be positive integer.");if(!isPositiveInteger(t))throw new InvalidArgumentsError("height to be positive integer.")}},{key:"copy",value:function(e,o,t){this.ensureItIsPossibleToCopy(e,o,t),this.clipboardOperations.copy(e,o,t)}},{key:"paste",value:function(e){var o=this.clipboardOperations.clipboard;if(void 0===o)throw new NothingToPasteError;if(this.clipboardOperations.isCutClipboard())this.moveCells(o.sourceLeftCorner,o.width,o.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);var t=AbsoluteCellRange.spanFrom(e,o.width,o.height),r=this.operations.getRangeClipboardCells(t);this.undoRedo.clearRedoStack(),this.dependencyGraph.breakNumericMatricesInRange(t);var n=this.operations.restoreClipboardCells(o.sourceLeftCorner.sheet,o.getContent(e));this.undoRedo.saveOperation(new PasteUndoEntry(e,r,o.content,n))}}},{key:"beginUndoRedoBatchMode",value:function(){this.undoRedo.beginBatchMode()}},{key:"commitUndoRedoBatchMode",value:function(){this.undoRedo.commitBatchMode()}},{key:"isClipboardEmpty",value:function(){return void 0===this.clipboardOperations.clipboard}},{key:"clearClipboard",value:function(){this.clipboardOperations.clear()}},{key:"addSheet",value:function(e){e&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();var o=this.operations.addSheet(e);return this.undoRedo.saveOperation(new AddSheetUndoEntry(o)),o}},{key:"removeSheet",value:function(e){this.ensureSheetExists(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var o=this.sheetMapping.fetch(e),t=this.sheetMapping.fetchDisplayName(o),r=this.operations.getSheetClipboardCells(o),n=this.operations.removeSheet(e);this.undoRedo.saveOperation(new RemoveSheetUndoEntry(t,o,r,n))}},{key:"renameSheet",value:function(e,o){this.ensureItIsPossibleToRenameSheet(e,o);var t=this.operations.renameSheet(e,o);return void 0!==t&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new RenameSheetUndoEntry(e,t,o))),t}},{key:"clearSheet",value:function(e){this.ensureSheetExists(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var o=this.sheetMapping.fetch(e),t=this.operations.getSheetClipboardCells(o);this.operations.clearSheet(o),this.undoRedo.saveOperation(new ClearSheetUndoEntry(o,t))}},{key:"setCellContents",value:function(e,o){if(o instanceof Array)for(var t=0;t<o.length;t++){if(!(o[t]instanceof Array))throw new InvalidArgumentsError("an array of arrays or a raw cell value.");for(var r=0;r<o[t].length;r++)if(isMatrix(o[t][r]))throw new Error("Cant change matrices in batch operation")}else o=[[o]];this.ensureItIsPossibleToChangeCellContents(e,o),this.undoRedo.clearRedoStack();for(var n=[],s=0;s<o.length;s++)for(var i=0;i<o[s].length;i++){var a={sheet:e.sheet,row:e.row+s,col:e.col+i};this.clipboardOperations.abortCut();var d=this.operations.getClipboardCell(a);this.operations.setCellContent(a,o[s][i]),n.push({address:a,newContent:o[s][i],oldContent:d})}this.undoRedo.saveOperation(new SetCellContentsUndoEntry(n))}},{key:"setSheetContent",value:function(e,o){this.ensureSheetExists(e);var t=this.sheetMapping.fetch(e);this.ensureItIsPossibleToChangeSheetContents(t,o),validateAsSheet(o),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var r=this.operations.getSheetClipboardCells(t);this.operations.setSheetContent(t,o),this.undoRedo.saveOperation(new SetSheetContentUndoEntry(t,r,o))}},{key:"undo",value:function(){if(this.undoRedo.isUndoStackEmpty())throw new NoOperationToUndoError;this.clipboardOperations.abortCut(),this.undoRedo.undo()}},{key:"redo",value:function(){if(this.undoRedo.isRedoStackEmpty())throw new NoOperationToRedoError;this.clipboardOperations.abortCut(),this.undoRedo.redo()}},{key:"addNamedExpression",value:function(e,o,t,r){var n=this.scopeId(t);this.ensureNamedExpressionNameIsValid(e,n),this.operations.addNamedExpression(e,o,n,r),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new AddNamedExpressionUndoEntry(e,o,n,r))}},{key:"changeNamedExpressionExpression",value:function(e,o,t,r){var n=this.scopeId(o),s=_slicedToArray(this.operations.changeNamedExpressionExpression(e,t,n,r),2),i=s[0],a=s[1];this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new ChangeNamedExpressionUndoEntry(i,t,a,n,r))}},{key:"removeNamedExpression",value:function(e,o){var t=this.scopeId(o),r=_slicedToArray(this.operations.removeNamedExpression(e,t),2),n=r[0],s=r[1];return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new RemoveNamedExpressionUndoEntry(n,s,t)),n}},{key:"ensureItIsPossibleToAddNamedExpression",value:function(e,o,t){var r=this.scopeId(t);this.ensureNamedExpressionNameIsValid(e,r),this.ensureNamedExpressionIsValid(o)}},{key:"ensureItIsPossibleToChangeNamedExpression",value:function(e,o,t){var r=this.scopeId(t);if(void 0===this.namedExpressions.namedExpressionForScope(e,r))throw new NamedExpressionDoesNotExistError(e);this.ensureNamedExpressionIsValid(o)}},{key:"isItPossibleToRemoveNamedExpression",value:function(e,o){var t=this.scopeId(o);if(void 0===this.namedExpressions.namedExpressionForScope(e,t))throw new NamedExpressionDoesNotExistError(e)}},{key:"ensureItIsPossibleToAddRows",value:function(e){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);for(var o=this.dependencyGraph.getSheetHeight(e),t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(o+r.map(function(e){return e[1]}).reduce(function(e,o){return e+o},0)>this.config.maxRows)throw new SheetSizeLimitExceededError;for(var s=0,i=r;s<i.length;s++){var a=_slicedToArray(i[s],2),d=a[0],l=a[1];if(!isNonnegativeInteger(d)||!isPositiveInteger(l))throw new InvalidArgumentsError("row number to be nonnegative and number of rows to add to be positive.");if(isPositiveInteger(d)&&this.dependencyGraph.matrixMapping.isFormulaMatrixInRow(e,d-1)&&this.dependencyGraph.matrixMapping.isFormulaMatrixInRow(e,d))throw new TargetLocationHasMatrixError}}},{key:"ensureItIsPossibleToRemoveRows",value:function(e){for(var o=arguments.length,t=new Array(o>1?o-1:0),r=1;r<o;r++)t[r-1]=arguments[r];for(var n=0,s=t;n<s.length;n++){var i=_slicedToArray(s[n],2),a=i[0],d=a+i[1]-1;if(!isNonnegativeInteger(a)||!isNonnegativeInteger(d))throw new InvalidArgumentsError("starting and ending row to be nonnegative.");if(d<a)throw new InvalidArgumentsError("starting row to be smaller than the ending row.");var l=RowsSpan.fromRowStartAndEnd(e,a,d);if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);if(this.dependencyGraph.matrixMapping.isFormulaMatrixInRows(l))throw new SourceLocationHasMatrixError}}},{key:"ensureItIsPossibleToAddColumns",value:function(e){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);for(var o=this.dependencyGraph.getSheetWidth(e),t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(o+r.map(function(e){return e[1]}).reduce(function(e,o){return e+o},0)>this.config.maxColumns)throw new SheetSizeLimitExceededError;for(var s=0,i=r;s<i.length;s++){var a=_slicedToArray(i[s],2),d=a[0],l=a[1];if(!isNonnegativeInteger(d)||!isPositiveInteger(l))throw new InvalidArgumentsError("column number to be nonnegative and number of columns to add to be positive.");if(isPositiveInteger(d)&&this.dependencyGraph.matrixMapping.isFormulaMatrixInColumn(e,d-1)&&this.dependencyGraph.matrixMapping.isFormulaMatrixInColumn(e,d))throw new TargetLocationHasMatrixError}}},{key:"ensureItIsPossibleToRemoveColumns",value:function(e){for(var o=arguments.length,t=new Array(o>1?o-1:0),r=1;r<o;r++)t[r-1]=arguments[r];for(var n=0,s=t;n<s.length;n++){var i=_slicedToArray(s[n],2),a=i[0],d=a+i[1]-1;if(!isNonnegativeInteger(a)||!isNonnegativeInteger(d))throw new InvalidArgumentsError("starting and ending column to be nonnegative.");if(d<a)throw new InvalidArgumentsError("starting column to be smaller than the ending column.");var l=ColumnsSpan.fromColumnStartAndEnd(e,a,d);if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);if(this.dependencyGraph.matrixMapping.isFormulaMatrixInColumns(l))throw new SourceLocationHasMatrixError}}},{key:"ensureItIsPossibleToMoveRows",value:function(e,o,t,r){this.ensureItIsPossibleToAddRows(e,[r,t]);var n=simpleCellAddress(e,0,o),s=simpleCellAddress(e,0,r);if(!this.sheetMapping.hasSheetWithId(e)||invalidSimpleCellAddress(n)||invalidSimpleCellAddress(s)||!isPositiveInteger(t)||r<=o+t&&r>=o)throw new InvalidArgumentsError("a valid range of rows to move.");var i=this.dependencyGraph.getSheetWidth(e),a=AbsoluteCellRange.spanFrom(n,i,t);if(this.dependencyGraph.matrixMapping.isFormulaMatrixInRange(a))throw new SourceLocationHasMatrixError}},{key:"ensureItIsPossibleToMoveColumns",value:function(e,o,t,r){this.ensureItIsPossibleToAddColumns(e,[r,t]);var n=simpleCellAddress(e,o,0),s=simpleCellAddress(e,r,0);if(!this.sheetMapping.hasSheetWithId(e)||invalidSimpleCellAddress(n)||invalidSimpleCellAddress(s)||!isPositiveInteger(t)||r<=o+t&&r>=o)throw new InvalidArgumentsError("a valid range of columns to move.");var i=this.dependencyGraph.getSheetHeight(e),a=AbsoluteCellRange.spanFrom(n,t,i);if(this.dependencyGraph.matrixMapping.isFormulaMatrixInRange(a))throw new SourceLocationHasMatrixError}},{key:"ensureItIsPossibleToAddSheet",value:function(e){if(this.sheetMapping.hasSheetWithName(e))throw new SheetNameAlreadyTakenError(e)}},{key:"ensureItIsPossibleToRenameSheet",value:function(e,o){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);var t=this.sheetMapping.get(o);if(void 0!==t&&t!==e)throw new SheetNameAlreadyTakenError(o)}},{key:"ensureItIsPossibleToChangeContent",value:function(e){if(invalidSimpleCellAddress(e))throw new InvalidAddressError(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new NoSheetWithIdError(e.sheet);if(this.dependencyGraph.matrixMapping.isFormulaMatrixAtAddress(e))throw new SourceLocationHasMatrixError}},{key:"ensureItIsPossibleToChangeCellContents",value:function(e,o){var t=findBoundaries(o),r=AbsoluteCellRange.spanFrom(e,t.width,t.height);this.ensureRangeInSizeLimits(r);var n,s=_createForOfIteratorHelper(r.addresses(this.dependencyGraph));try{for(s.s();!(n=s.n()).done;){var i=n.value;this.ensureItIsPossibleToChangeContent(i)}}catch(e){s.e(e)}finally{s.f()}}},{key:"ensureItIsPossibleToChangeSheetContents",value:function(e,o){var t=findBoundaries(o),r=AbsoluteCellRange.spanFrom(simpleCellAddress(e,0,0),t.width,t.height);this.ensureRangeInSizeLimits(r)}},{key:"ensureRangeInSizeLimits",value:function(e){if(e.exceedsSheetSizeLimits(this.config.maxColumns,this.config.maxRows))throw new SheetSizeLimitExceededError}},{key:"isThereSomethingToUndo",value:function(){return!this.undoRedo.isUndoStackEmpty()}},{key:"isThereSomethingToRedo",value:function(){return!this.undoRedo.isRedoStackEmpty()}},{key:"getAndClearContentChanges",value:function(){return this.operations.getAndClearContentChanges()}},{key:"ensureSheetExists",value:function(e){if(!this.sheetMapping.hasSheetWithName(e))throw new NoSheetWithNameError(e)}},{key:"scopeId",value:function(e){if(void 0!==e)return this.ensureSheetExists(e),this.sheetMapping.fetch(e)}},{key:"ensureNamedExpressionNameIsValid",value:function(e,o){if(!this.namedExpressions.isNameValid(e))throw new NamedExpressionNameIsInvalidError(e);if(!this.namedExpressions.isNameAvailable(e,o))throw new NamedExpressionNameIsAlreadyTakenError(e)}},{key:"ensureNamedExpressionIsValid",value:function(e){var o=this.cellContentParser.parse(e);if(o instanceof CellContent.MatrixFormula)throw new MatrixFormulasNotSupportedError;if(o instanceof CellContent.Formula){var t=this.parser.parse(o.formula,simpleCellAddress(-1,0,0));if(doesContainRelativeReferences(t.ast))throw new NoRelativeAddressesAllowedError}}},{key:"sheetMapping",get:function(){return this.dependencyGraph.sheetMapping}}]),e}();function isPositiveInteger(e){return Number.isInteger(e)&&e>0}function isNonnegativeInteger(e){return Number.isInteger(e)&&e>=0}
//# sourceMappingURL=/sm/faeec704f705e94795de84a15f0de1f99037ec002b292470541ed433c37625c8.map