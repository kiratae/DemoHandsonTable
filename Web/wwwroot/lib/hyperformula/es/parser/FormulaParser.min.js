/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/parser/FormulaParser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.iterator";import"core-js/modules/es.array.concat";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.map";import"core-js/modules/es.array.slice";import"core-js/modules/es.function.name";import"core-js/modules/es.number.constructor";import"core-js/modules/es.number.is-integer";import"core-js/modules/es.object.get-own-property-descriptor";import"core-js/modules/es.object.get-prototype-of";import"core-js/modules/es.object.to-string";import"core-js/modules/es.reflect.construct";import"core-js/modules/es.reflect.get";import"core-js/modules/es.regexp.exec";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.string.iterator";import"core-js/modules/es.string.replace";import"core-js/modules/es.string.split";import"core-js/modules/web.dom-collections.iterator";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(t.push(s.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}function _get(e,r,t){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,r,t){var n=_superPropBase(e,r);if(n){var o=Object.getOwnPropertyDescriptor(n,r);return o.get?o.get.call(t):o.value}})(e,r,t||e)}function _superPropBase(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&_setPrototypeOf(e,r)}function _setPrototypeOf(e,r){return(_setPrototypeOf=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function _createSuper(e){var r=_isNativeReflectConstruct();return function(){var t,n=_getPrototypeOf(e);if(r){var o=_getPrototypeOf(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(e,r){return!r||"object"!==_typeof(r)&&"function"!=typeof r?_assertThisInitialized(e):r}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}import{EmbeddedActionsParser,EMPTY_ALT,Lexer,tokenMatcher}from"chevrotain";import{CellError,ErrorType,simpleCellAddress}from"../Cell";import{cellAddressFromString,columnAddressFromString,rowAddressFromString}from"./addressRepresentationConverters";import{AstNodeType,buildCellErrorAst,buildCellRangeAst,buildCellReferenceAst,buildColumnRangeAst,buildConcatenateOpAst,buildDivOpAst,buildEmptyArgAst,buildEqualsOpAst,buildErrorWithRawInputAst,buildGreaterThanOpAst,buildGreaterThanOrEqualOpAst,buildLessThanOpAst,buildLessThanOrEqualOpAst,buildMinusOpAst,buildMinusUnaryOpAst,buildNamedExpressionAst,buildNotEqualOpAst,buildNumberAst,buildParenthesisAst,buildParsingErrorAst,buildPercentOpAst,buildPlusOpAst,buildPlusUnaryOpAst,buildPowerOpAst,buildProcedureAst,buildRowRangeAst,buildStringAst,buildTimesOpAst,parsingError as _parsingError,ParsingErrorType,RangeSheetReferenceType}from"./Ast";import{CellAddress,CellReferenceType}from"./CellAddress";import{AdditionOp,BooleanOp,CellReference,ColumnRange,ConcatenateOp,DivOp,EqualsOp,ErrorLiteral,GreaterThanOp,GreaterThanOrEqualOp,LessThanOp,LessThanOrEqualOp,LParen,MinusOp,MultiplicationOp,NamedExpression,NotEqualOp,PercentOp,PlusOp,PowerOp,ProcedureName,RangeSeparator,RowRange,RParen,StringLiteral,TimesOp,WhiteSpace}from"./LexerConfig";export var FormulaParser=function(e){_inherits(t,EmbeddedActionsParser);var r=_createSuper(t);function t(e,n){var o;return _classCallCheck(this,t),(o=r.call(this,e.allTokens,{outputCst:!1,maxLookahead:7})).formula=o.RULE("formula",function(){return o.CONSUME(EqualsOp),o.SUBRULE(o.booleanExpression)}),o.booleanExpression=o.RULE("booleanExpression",function(){var e=o.SUBRULE(o.concatenateExpression);return o.MANY(function(){var r=o.CONSUME(BooleanOp),t=o.SUBRULE2(o.concatenateExpression);tokenMatcher(r,EqualsOp)?e=buildEqualsOpAst(e,t,r.leadingWhitespace):tokenMatcher(r,NotEqualOp)?e=buildNotEqualOpAst(e,t,r.leadingWhitespace):tokenMatcher(r,GreaterThanOp)?e=buildGreaterThanOpAst(e,t,r.leadingWhitespace):tokenMatcher(r,LessThanOp)?e=buildLessThanOpAst(e,t,r.leadingWhitespace):tokenMatcher(r,GreaterThanOrEqualOp)?e=buildGreaterThanOrEqualOpAst(e,t,r.leadingWhitespace):tokenMatcher(r,LessThanOrEqualOp)?e=buildLessThanOrEqualOpAst(e,t,r.leadingWhitespace):o.ACTION(function(){throw Error("Operator not supported")})}),e}),o.booleanExpressionOrEmpty=o.RULE("booleanExpressionOrEmpty",function(){return o.OR([{ALT:function(){return o.SUBRULE(o.booleanExpression)}},{ALT:EMPTY_ALT(buildEmptyArgAst())}])}),o.concatenateExpression=o.RULE("concatenateExpression",function(){var e=o.SUBRULE(o.additionExpression);return o.MANY(function(){var r=o.CONSUME(ConcatenateOp),t=o.SUBRULE2(o.additionExpression);e=buildConcatenateOpAst(e,t,r.leadingWhitespace)}),e}),o.additionExpression=o.RULE("additionExpression",function(){var e=o.SUBRULE(o.multiplicationExpression);return o.MANY(function(){var r=o.CONSUME(AdditionOp),t=o.SUBRULE2(o.multiplicationExpression);tokenMatcher(r,PlusOp)?e=buildPlusOpAst(e,t,r.leadingWhitespace):tokenMatcher(r,MinusOp)?e=buildMinusOpAst(e,t,r.leadingWhitespace):o.ACTION(function(){throw Error("Operator not supported")})}),e}),o.multiplicationExpression=o.RULE("multiplicationExpression",function(){var e=o.SUBRULE(o.powerExpression);return o.MANY(function(){var r=o.CONSUME(MultiplicationOp),t=o.SUBRULE2(o.powerExpression);tokenMatcher(r,TimesOp)?e=buildTimesOpAst(e,t,r.leadingWhitespace):tokenMatcher(r,DivOp)?e=buildDivOpAst(e,t,r.leadingWhitespace):o.ACTION(function(){throw Error("Operator not supported")})}),e}),o.powerExpression=o.RULE("powerExpression",function(){var e=o.SUBRULE(o.atomicExpression);return o.MANY(function(){var r=o.CONSUME(PowerOp),t=o.SUBRULE2(o.atomicExpression);tokenMatcher(r,PowerOp)?e=buildPowerOpAst(e,t,r.leadingWhitespace):o.ACTION(function(){throw Error("Operator not supported")})}),e}),o.atomicExpression=o.RULE("atomicExpression",function(){return o.OR([{ALT:function(){var e=o.CONSUME(AdditionOp),r=o.SUBRULE(o.atomicExpression);return tokenMatcher(e,PlusOp)?buildPlusUnaryOpAst(r,e.leadingWhitespace):tokenMatcher(e,MinusOp)?buildMinusUnaryOpAst(r,e.leadingWhitespace):(o.customParsingError=_parsingError(ParsingErrorType.ParserError,"Mismatched token type"),o.customParsingError)}},{ALT:function(){return o.SUBRULE2(o.rightUnaryOpAtomicExpression)}}])}),o.rightUnaryOpAtomicExpression=o.RULE("rightUnaryOpAtomicExpression",function(){var e=o.SUBRULE(o.positiveAtomicExpression),r=o.OPTION(function(){return o.CONSUME(PercentOp)});return r?buildPercentOpAst(e,r.leadingWhitespace):e}),o.positiveAtomicExpression=o.RULE("positiveAtomicExpression",function(){return o.OR(o.atomicExpCache||(o.atomicExpCache=[{ALT:function(){return o.SUBRULE(o.parenthesisExpression)}},{ALT:function(){return o.SUBRULE(o.cellRangeExpression)}},{ALT:function(){return o.SUBRULE(o.columnRangeExpression)}},{ALT:function(){return o.SUBRULE(o.rowRangeExpression)}},{ALT:function(){return o.SUBRULE(o.offsetExpression)}},{ALT:function(){return o.SUBRULE(o.cellReference)}},{ALT:function(){return o.SUBRULE(o.procedureExpression)}},{ALT:function(){return o.SUBRULE(o.namedExpressionExpression)}},{ALT:function(){var e=o.CONSUME(o.lexerConfig.NumberLiteral);return buildNumberAst(o.numericStringToNumber(e.image),e.leadingWhitespace)}},{ALT:function(){var e=o.CONSUME(StringLiteral);return buildStringAst(e)}},{ALT:function(){var e=o.CONSUME(ErrorLiteral),r=e.image.toUpperCase(),t=o.lexerConfig.errorMapping[r];return t?buildCellErrorAst(new CellError(t),e.leadingWhitespace):o.parsingError(ParsingErrorType.ParserError,"Unknown error literal")}}]))}),o.procedureExpression=o.RULE("procedureExpression",function(){var e,r=o.CONSUME(ProcedureName),t=r.image.toUpperCase().slice(0,-1),n=null!==(e=o.lexerConfig.functionMapping[t])&&void 0!==e?e:t,i=[],s=o.SUBRULE(o.booleanExpressionOrEmpty);o.MANY(function(){var e,r=o.CONSUME(o.lexerConfig.ArgSeparator);s.type===AstNodeType.EMPTY&&(s.leadingWhitespace=null===(e=r.leadingWhitespace)||void 0===e?void 0:e.image),i.push(s),s=o.SUBRULE2(o.booleanExpressionOrEmpty)}),i.push(s),1===i.length&&i[0].type===AstNodeType.EMPTY&&(i.length=0);var a=o.CONSUME(RParen);return buildProcedureAst(n,i,r.leadingWhitespace,a.leadingWhitespace)}),o.namedExpressionExpression=o.RULE("namedExpressionExpression",function(){var e=o.CONSUME(NamedExpression);return buildNamedExpressionAst(e.image,e.leadingWhitespace)}),o.offsetExpression=o.RULE("offsetExpression",function(){var e,r=o.SUBRULE(o.offsetProcedureExpression);return o.OPTION(function(){o.CONSUME(RangeSeparator),e=r.type===AstNodeType.CELL_RANGE?o.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here"):o.SUBRULE(o.endOfRangeWithOffsetStartExpression,{ARGS:[r]})}),void 0!==e?e:r}),o.offsetProcedureExpression=o.RULE("offsetProcedureExpression",function(){var e=[];return o.CONSUME(o.lexerConfig.OffsetProcedureName),o.CONSUME(LParen),o.MANY_SEP({SEP:o.lexerConfig.ArgSeparator,DEF:function(){e.push(o.SUBRULE(o.booleanExpression))}}),o.CONSUME(RParen),o.handleOffsetHeuristic(e)}),o.cellRangeExpression=o.RULE("cellRangeExpression",function(){var e=o.CONSUME(CellReference);return o.CONSUME2(RangeSeparator),o.SUBRULE(o.endOfRangeExpression,{ARGS:[e]})}),o.columnRangeExpression=o.RULE("columnRangeExpression",function(){var e=o.CONSUME(ColumnRange),r=_slicedToArray(e.image.split(":"),2),t=r[0],n=r[1],i=o.ACTION(function(){return columnAddressFromString(o.sheetMapping,t,o.formulaAddress)}),s=o.ACTION(function(){return columnAddressFromString(o.sheetMapping,n,o.formulaAddress)});if(void 0===i||void 0===s)return buildCellErrorAst(new CellError(ErrorType.REF));if(i.exceedsSheetSizeLimits(o.lexerConfig.maxColumns)||s.exceedsSheetSizeLimits(o.lexerConfig.maxColumns))return buildErrorWithRawInputAst(e.image,new CellError(ErrorType.NAME),e.leadingWhitespace);if(null===i.sheet&&null!==s.sheet)return o.parsingError(ParsingErrorType.ParserError,"Malformed range expression");var a=o.rangeSheetReferenceType(i.sheet,s.sheet);return null!==i.sheet&&null===s.sheet&&(s=s.withAbsoluteSheet(i.sheet)),buildColumnRangeAst(i,s,a,e.leadingWhitespace)}),o.rowRangeExpression=o.RULE("rowRangeExpression",function(){var e=o.CONSUME(RowRange),r=_slicedToArray(e.image.split(":"),2),t=r[0],n=r[1],i=o.ACTION(function(){return rowAddressFromString(o.sheetMapping,t,o.formulaAddress)}),s=o.ACTION(function(){return rowAddressFromString(o.sheetMapping,n,o.formulaAddress)});if(void 0===i||void 0===s)return buildCellErrorAst(new CellError(ErrorType.REF));if(i.exceedsSheetSizeLimits(o.lexerConfig.maxRows)||s.exceedsSheetSizeLimits(o.lexerConfig.maxRows))return buildErrorWithRawInputAst(e.image,new CellError(ErrorType.NAME),e.leadingWhitespace);if(null===i.sheet&&null!==s.sheet)return o.parsingError(ParsingErrorType.ParserError,"Malformed range expression");var a=o.rangeSheetReferenceType(i.sheet,s.sheet);return null!==i.sheet&&null===s.sheet&&(s=s.withAbsoluteSheet(i.sheet)),buildRowRangeAst(i,s,a,e.leadingWhitespace)}),o.cellReference=o.RULE("cellReference",function(){var e=o.CONSUME(CellReference),r=o.ACTION(function(){return cellAddressFromString(o.sheetMapping,e.image,o.formulaAddress)});return void 0===r?buildErrorWithRawInputAst(e.image,new CellError(ErrorType.REF),e.leadingWhitespace):r.exceedsSheetSizeLimits(o.lexerConfig.maxColumns,o.lexerConfig.maxRows)?buildErrorWithRawInputAst(e.image,new CellError(ErrorType.NAME),e.leadingWhitespace):buildCellReferenceAst(r,e.leadingWhitespace)}),o.endOfRangeExpression=o.RULE("endOfRangeExpression",function(e){return o.OR([{ALT:function(){return o.SUBRULE(o.endRangeReference,{ARGS:[e]})}},{ALT:function(){var r,t=o.SUBRULE(o.offsetProcedureExpression),n=o.ACTION(function(){return cellAddressFromString(o.sheetMapping,e.image,o.formulaAddress)});if(void 0===n)return buildCellErrorAst(new CellError(ErrorType.REF));if(t.type===AstNodeType.CELL_REFERENCE){var i=t.reference,s=RangeSheetReferenceType.RELATIVE;return null!==n.sheet&&(s=RangeSheetReferenceType.START_ABSOLUTE,i=i.withAbsoluteSheet(n.sheet)),buildCellRangeAst(n,i,s,null===(r=e.leadingWhitespace)||void 0===r?void 0:r.image)}return o.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])}),o.endOfRangeWithOffsetStartExpression=o.RULE("endOfRangeWithOffsetStartExpression",function(e){return o.OR([{ALT:function(){return o.SUBRULE(o.endRangeWithOffsetStartReference,{ARGS:[e]})}},{ALT:function(){var r=o.SUBRULE(o.offsetProcedureExpression);if(r.type===AstNodeType.CELL_REFERENCE){var t=r.reference,n=RangeSheetReferenceType.RELATIVE;return null!==e.reference.sheet&&(n=RangeSheetReferenceType.START_ABSOLUTE,t=t.withAbsoluteSheet(e.reference.sheet)),buildCellRangeAst(e.reference,t,n,e.leadingWhitespace)}return o.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])}),o.endRangeReference=o.RULE("endRangeReference",function(e){var r,t=o.CONSUME(CellReference),n=o.ACTION(function(){return cellAddressFromString(o.sheetMapping,e.image,o.formulaAddress)}),i=o.ACTION(function(){return cellAddressFromString(o.sheetMapping,t.image,o.formulaAddress)});return void 0===n||void 0===i?o.ACTION(function(){return buildErrorWithRawInputAst("".concat(e.image,":").concat(t.image),new CellError(ErrorType.REF),e.leadingWhitespace)}):n.exceedsSheetSizeLimits(o.lexerConfig.maxColumns,o.lexerConfig.maxRows)||i.exceedsSheetSizeLimits(o.lexerConfig.maxColumns,o.lexerConfig.maxRows)?o.ACTION(function(){return buildErrorWithRawInputAst("".concat(e.image,":").concat(t.image),new CellError(ErrorType.NAME),e.leadingWhitespace)}):o.buildCellRange(n,i,null===(r=e.leadingWhitespace)||void 0===r?void 0:r.image)}),o.endRangeWithOffsetStartReference=o.RULE("endRangeWithOffsetStartReference",function(e){var r=o.CONSUME(CellReference),t=o.ACTION(function(){return cellAddressFromString(o.sheetMapping,r.image,o.formulaAddress)});return void 0===t?o.ACTION(function(){return buildCellErrorAst(new CellError(ErrorType.REF))}):o.buildCellRange(e.reference,t,e.leadingWhitespace)}),o.parenthesisExpression=o.RULE("parenthesisExpression",function(){var e=o.CONSUME(LParen),r=o.SUBRULE(o.booleanExpression),t=o.CONSUME(RParen);return buildParenthesisAst(r,e.leadingWhitespace,t.leadingWhitespace)}),o.numericStringToNumber=function(e){var r=e.replace(o.lexerConfig.decimalSeparator,".");return Number(r)},o.lexerConfig=e,o.sheetMapping=n,o.formulaAddress=simpleCellAddress(0,0,0),o.performSelfAnalysis(),o}return _createClass(t,[{key:"parseFromTokens",value:function(e,r){this.input=e;var t=this.formulaWithContext(r),n=[];return this.customParsingError&&n.push(this.customParsingError),(n=n.concat(this.errors.map(function(e){return{type:ParsingErrorType.ParserError,message:e.message}}))).length>0&&(t=buildParsingErrorAst()),{ast:t,errors:n}}},{key:"formulaWithContext",value:function(e){return this.formulaAddress=e,this.formula()}},{key:"reset",value:function(){_get(_getPrototypeOf(t.prototype),"reset",this).call(this),this.customParsingError=void 0}},{key:"buildCellRange",value:function(e,r,t){if(null===e.sheet&&null!==r.sheet)return this.parsingError(ParsingErrorType.ParserError,"Malformed range expression");var n=this.rangeSheetReferenceType(e.sheet,r.sheet);return null!==e.sheet&&null===r.sheet&&(r=r.withAbsoluteSheet(e.sheet)),buildCellRangeAst(e,r,n,t)}},{key:"handleOffsetHeuristic",value:function(e){var r=e[0];if(r.type!==AstNodeType.CELL_REFERENCE)return this.parsingError(ParsingErrorType.StaticOffsetError,"First argument to OFFSET is not a reference");var t,n=e[1];if(n.type===AstNodeType.NUMBER&&Number.isInteger(n.value))t=n.value;else if(n.type===AstNodeType.PLUS_UNARY_OP&&n.value.type===AstNodeType.NUMBER&&Number.isInteger(n.value.value))t=n.value.value;else{if(n.type!==AstNodeType.MINUS_UNARY_OP||n.value.type!==AstNodeType.NUMBER||!Number.isInteger(n.value.value))return this.parsingError(ParsingErrorType.StaticOffsetError,"Second argument to OFFSET is not a static number");t=-n.value.value}var o,i=e[2];if(i.type===AstNodeType.NUMBER&&Number.isInteger(i.value))o=i.value;else if(i.type===AstNodeType.PLUS_UNARY_OP&&i.value.type===AstNodeType.NUMBER&&Number.isInteger(i.value.value))o=i.value.value;else{if(i.type!==AstNodeType.MINUS_UNARY_OP||i.value.type!==AstNodeType.NUMBER||!Number.isInteger(i.value.value))return this.parsingError(ParsingErrorType.StaticOffsetError,"Third argument to OFFSET is not a static number");o=-i.value.value}var s,a=e[3];if(void 0===a)s=1;else{if(a.type!==AstNodeType.NUMBER)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not a static number");if((s=a.value)<1)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(s))return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not integer")}var l,u=e[4];if(void 0===u)l=1;else{if(u.type!==AstNodeType.NUMBER)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not a static number");if((l=u.value)<1)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(l))return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not integer")}var p=new CellAddress(null,r.reference.col+o,r.reference.row+t,r.reference.type),c=p.col,f=p.row;if(r.reference.type!==CellReferenceType.CELL_REFERENCE_RELATIVE&&r.reference.type!==CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL||(f+=this.formulaAddress.row),r.reference.type!==CellReferenceType.CELL_REFERENCE_RELATIVE&&r.reference.type!==CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW||(c+=this.formulaAddress.col),c<0||f<0)return buildCellErrorAst(new CellError(ErrorType.REF,"Resulting reference is out of the sheet"));if(1===l&&1===s)return buildCellReferenceAst(p);var E=new CellAddress(null,p.col+l-1,p.row+s-1,p.type);return buildCellRangeAst(p,E,RangeSheetReferenceType.RELATIVE)}},{key:"parsingError",value:function(e,r){return this.customParsingError=_parsingError(e,r),buildParsingErrorAst()}},{key:"rangeSheetReferenceType",value:function(e,r){return null===e?RangeSheetReferenceType.RELATIVE:null===r?RangeSheetReferenceType.START_ABSOLUTE:RangeSheetReferenceType.BOTH_ABSOLUTE}}]),t}();export var FormulaLexer=function(){function e(r){_classCallCheck(this,e),this.lexerConfig=r,this.lexer=new Lexer(r.allTokens,{ensureOptimizations:!0})}return _createClass(e,[{key:"tokenizeFormula",value:function(e){var r=this.lexer.tokenize(e),t=r.tokens;return t=this.trimTrailingWhitespaces(t),t=this.skipWhitespacesInsideRanges(t),t=this.skipWhitespacesBeforeArgSeparators(t),r.tokens=t,r}},{key:"skipWhitespacesInsideRanges",value:function(e){return this.filterTokensByNeighbors(e,function(e,r,t){return(tokenMatcher(e,CellReference)||tokenMatcher(e,RangeSeparator))&&tokenMatcher(r,WhiteSpace)&&(tokenMatcher(t,CellReference)||tokenMatcher(t,RangeSeparator))})}},{key:"skipWhitespacesBeforeArgSeparators",value:function(e){var r=this;return this.filterTokensByNeighbors(e,function(e,t,n){return!tokenMatcher(e,r.lexerConfig.ArgSeparator)&&tokenMatcher(t,WhiteSpace)&&tokenMatcher(n,r.lexerConfig.ArgSeparator)})}},{key:"filterTokensByNeighbors",value:function(e,r){if(e.length<3)return e;for(var t=0,n=[e[t++]];t<e.length-1;)r(e[t-1],e[t],e[t+1])||n.push(e[t]),++t;return n.push(e[t]),n}},{key:"trimTrailingWhitespaces",value:function(e){return e.length>0&&tokenMatcher(e[e.length-1],WhiteSpace)&&e.pop(),e}}]),e}();
//# sourceMappingURL=/sm/95ffb4d2b5288d9e010bd4668b13981e0cbcec6b9a5269a9f074b097ce53fd3b.map