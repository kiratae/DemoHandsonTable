/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/interpreter/CriterionFunctionCompute.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.iterator";import"core-js/modules/es.array.every";import"core-js/modules/es.array.for-each";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.join";import"core-js/modules/es.array.map";import"core-js/modules/es.array.slice";import"core-js/modules/es.function.name";import"core-js/modules/es.map";import"core-js/modules/es.object.to-string";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.for-each";import"core-js/modules/web.dom-collections.iterator";import"regenerator-runtime/runtime";var _marked=regeneratorRuntime.mark(getRangeValues),_marked2=regeneratorRuntime.mark(ifFilter);function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}import{CellError,ErrorType,simpleCellAddress}from"../Cell";import{split}from"../generatorUtils";var findSmallerRangeForMany=function(e,r,t){if(t.end.row>t.start.row){var n=simpleCellAddress(t.end.sheet,t.end.col,t.end.row-1),a=e.getRange(t.start,n);if(void 0!==a)return{smallerRangeVertex:a,restValuesRange:t.withStart(simpleCellAddress(t.start.sheet,t.start.col,t.end.row)),restConditionRanges:r.map(function(e){return e.withStart(simpleCellAddress(e.start.sheet,e.start.col,e.end.row))})}}return{smallerRangeVertex:null,restValuesRange:t,restConditionRanges:r}};export var CriterionFunctionCompute=function(){function e(r,t,n,a,o){_classCallCheck(this,e),this.interpreter=r,this.cacheKey=t,this.reduceInitialValue=n,this.composeFunction=a,this.mapFunction=o,this.dependencyGraph=this.interpreter.dependencyGraph}return _createClass(e,[{key:"compute",value:function(e,r){var t,n=this,a=_createForOfIteratorHelper(r);try{for(a.s();!(t=a.n()).done;){if(!t.value.conditionRange.sameDimensionsAs(e))return new CellError(ErrorType.VALUE)}}catch(e){a.e(e)}finally{a.f()}var o=this.tryToGetRangeVertexForRangeValue(e),i=r.map(function(e){return n.tryToGetRangeVertexForRangeValue(e.conditionRange)});if(o&&i.every(function(e){return void 0!==e})){var s=r.map(function(e){return e.criterionPackage.raw}).join(","),u=this.findAlreadyComputedValueInCache(o,this.cacheKey(r),s);if(u)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),u;var c=this.buildNewCriterionCache(this.cacheKey(r),r.map(function(e){return e.conditionRange.range()}),e.range());return c.has(s)||c.set(s,[this.evaluateRangeValue(e,r),r.map(function(e){return e.criterionPackage.lambda})]),o.setCriterionFunctionValues(this.cacheKey(r),c),i.forEach(function(e){void 0!==e&&e.addDependentCacheRange(o)}),c.get(s)[0]}return this.evaluateRangeValue(e,r)}},{key:"tryToGetRangeVertexForRangeValue",value:function(e){var r=e.range();return void 0===r?void 0:this.dependencyGraph.getRange(r.start,r.end)}},{key:"reduceFunction",value:function(e){var r,t=this.reduceInitialValue,n=_createForOfIteratorHelper(e);try{for(n.s();!(r=n.n()).done;){var a=r.value;t=this.composeFunction(t,a)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"findAlreadyComputedValueInCache",value:function(e,r,t){return e.getCriterionFunctionValue(r,t)}},{key:"evaluateRangeValue",value:function(e,r){var t=r.map(function(e){return e.criterionPackage.lambda}),n=Array.from(e.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),a=ifFilter(t,r.map(function(e){return e.conditionRange.valuesFromTopLeftCorner()}),n);return this.reduceFunction(a)}},{key:"buildNewCriterionCache",value:function(e,r,t){var n,a=this,o=this.dependencyGraph.getRange(t.start,t.end),i=findSmallerRangeForMany(this.dependencyGraph,r,t),s=i.smallerRangeVertex,u=i.restConditionRanges,c=i.restValuesRange;n=s&&this.dependencyGraph.existsEdge(s,o)?s.getCriterionFunctionValues(e):new Map;var l=new Map;return n.forEach(function(e,r){var t=_slicedToArray(e,2),n=t[0],o=t[1],i=ifFilter(o,u.map(function(e){return getRangeValues(a.dependencyGraph,e)}),Array.from(getRangeValues(a.dependencyGraph,c)).map(a.mapFunction)[Symbol.iterator]()),s=a.composeFunction(n,a.reduceFunction(i));a.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),l.set(r,[s,o])}),l}}]),e}();export var Condition=function e(r,t){_classCallCheck(this,e),this.conditionRange=r,this.criterionPackage=t};function getRangeValues(e,r){var t,n,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t=_createForOfIteratorHelper(r.addresses(e)),o.prev=1,t.s();case 3:if((n=t.n()).done){o.next=9;break}return a=n.value,o.next=7,e.getScalarValue(a);case 7:o.next=3;break;case 9:o.next=14;break;case 11:o.prev=11,o.t0=o.catch(1),t.e(o.t0);case 14:return o.prev=14,t.f(),o.finish(14);case 17:case"end":return o.stop()}},_marked,null,[[1,11,14,17]])}function ifFilter(e,r,t){var n,a,o,i;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:n=_createForOfIteratorHelper(t),s.prev=1,n.s();case 3:if((a=n.n()).done){s.next=15;break}if(o=a.value,(i=r.map(function(e){return split(e)})).every(function(e){return Object.prototype.hasOwnProperty.call(e,"value")})){s.next=8;break}return s.abrupt("return");case 8:if(!zip(i.map(function(e){return e.value}),e).every(function(e){var r=_slicedToArray(e,2),t=r[0];return(0,r[1])(t)})){s.next=12;break}return s.next=12,o;case 12:r=i.map(function(e){return e.rest});case 13:s.next=3;break;case 15:s.next=20;break;case 17:s.prev=17,s.t0=s.catch(1),n.e(s.t0);case 20:return s.prev=20,n.f(),s.finish(20);case 23:case"end":return s.stop()}},_marked2,null,[[1,17,20,23]])}function zip(e,r){for(var t=[],n=0;n<Math.min(e.length,r.length);n++)t.push([e[n],r[n]]);return t}
//# sourceMappingURL=/sm/6d792735ff9ab9734d54a726bc7396eb83cb4133db114ad35b3731606752cba4.map