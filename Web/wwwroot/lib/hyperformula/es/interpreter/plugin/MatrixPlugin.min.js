/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/interpreter/plugin/MatrixPlugin.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.iterator";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.slice";import"core-js/modules/es.array.some";import"core-js/modules/es.function.name";import"core-js/modules/es.object.get-prototype-of";import"core-js/modules/es.object.to-string";import"core-js/modules/es.reflect.construct";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.iterator";function _typeof(r){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=r[t];return o}function _iterableToArrayLimit(r,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(r)){var t=[],o=!0,n=!1,i=void 0;try{for(var a,s=r[Symbol.iterator]();!(o=(a=s.next()).done)&&(t.push(a.value),!e||t.length!==e);o=!0);}catch(r){n=!0,i=r}finally{try{o||null==s.return||s.return()}finally{if(n)throw i}}return t}}function _arrayWithHoles(r){if(Array.isArray(r))return r}function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(r,o.key,o)}}function _createClass(r,e,t){return e&&_defineProperties(r.prototype,e),t&&_defineProperties(r,t),r}function _inherits(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&_setPrototypeOf(r,e)}function _setPrototypeOf(r,e){return(_setPrototypeOf=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r})(r,e)}function _createSuper(r){var e=_isNativeReflectConstruct();return function(){var t,o=_getPrototypeOf(r);if(e){var n=_getPrototypeOf(this).constructor;t=Reflect.construct(o,arguments,n)}else t=o.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(r,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(r):e}function _assertThisInitialized(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(r){return!1}}function _getPrototypeOf(r){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(r)}import{CellError,ErrorType}from"../../Cell";import{matrixSizeForMultiplication,matrixSizeForPoolFunction,matrixSizeForTranspose}from"../../Matrix";import{AstNodeType}from"../../parser";import{coerceToRangeNumbersOrError}from"../ArithmeticHelper";import{SimpleRangeValue}from"../InterpreterValue";import{FunctionPlugin}from"./FunctionPlugin";export var MatrixPlugin=function(r){_inherits(t,FunctionPlugin);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"mmult",value:function(r,e){if(2!==r.args.length)return new CellError(ErrorType.NA);if(r.args.some(function(r){return r.type===AstNodeType.EMPTY}))return new CellError(ErrorType.NUM);var t=_slicedToArray(r.args,2),o=t[0],n=t[1],i=coerceToRangeNumbersOrError(this.evaluateAst(o,e)),a=coerceToRangeNumbersOrError(this.evaluateAst(n,e));if(i instanceof CellError)return i;if(a instanceof CellError)return a;if(null===i||null===a)return new CellError(ErrorType.VALUE);var s=matrixSizeForMultiplication(i.size,a.size),u=this.interpreter.getGpuInstance().createKernel(function(r,e,t){for(var o=0,n=0;n<t;++n)o+=r[this.thread.y][n]*e[n][this.thread.x];return o}).setPrecision("unsigned").setOutput([s.width,s.height]);return SimpleRangeValue.onlyNumbersDataWithoutRange(u(i.rawNumbers(),a.rawNumbers(),i.width()),s)}},{key:"maxpool",value:function(r,e){var t=_slicedToArray(r.args,2),o=t[0],n=t[1],i=coerceToRangeNumbersOrError(this.evaluateAst(o,e)),a=n.value,s=a;if(r.args.some(function(r){return r.type===AstNodeType.EMPTY}))return new CellError(ErrorType.NUM);if(3===r.args.length){var u=r.args[2];if(u.type!==AstNodeType.NUMBER)return new CellError(ErrorType.VALUE);s=u.value}if(i instanceof CellError)return i;if(null===i)return new CellError(ErrorType.VALUE);var l=matrixSizeForPoolFunction(i.size,a,s),c=this.interpreter.getGpuInstance().createKernel(function(r,e,t){for(var o=this.thread.x*t,n=this.thread.y*t,i=r[n][o],a=0;a<e;a++)for(var s=0;s<e;s++)i=Math.max(i,r[n+a][o+s]);return i}).setPrecision("unsigned").setOutput([l.width,l.height]);return SimpleRangeValue.onlyNumbersDataWithoutRange(c(i.rawNumbers(),a,s),l)}},{key:"medianpool",value:function(r,e){var t=_slicedToArray(r.args,2),o=t[0],n=t[1];if(r.args.some(function(r){return r.type===AstNodeType.EMPTY}))return new CellError(ErrorType.NUM);var i=coerceToRangeNumbersOrError(this.evaluateAst(o,e)),a=n.value,s=a;if(3===r.args.length){var u=r.args[2];if(u.type!==AstNodeType.NUMBER)return new CellError(ErrorType.VALUE);s=u.value}if(i instanceof CellError)return i;if(null===i)return new CellError(ErrorType.VALUE);var l=matrixSizeForPoolFunction(i.size,a,s),c=this.interpreter.getGpuInstance().createKernel(function(r,e,t){for(var o=this.thread.x*t,n=this.thread.y*t,i=r[n][o],a=0;a<e;a++)for(var s=0;s<e;s++)i=Math.max(i,r[n+a][o+s]);for(var u=r[n][o],l=0;l<e;l++)for(var c=0;c<e;c++)u=Math.min(u,r[n+l][o+c]);for(var f=e*e,p=u,y=i,m=42,h=0;h<32;h++){for(var d=(p+y)/2,g=0,b=0;b<e;b++)for(var v=0;v<e;v++)r[n+b][o+v]>d&&g++;if(e%2==0){if(g===f/2){m=d;break}g>f/2?p=d:y=d}else{if(g===(f-1)/2){m=d;break}g>(f-1)/2?p=d:y=d}}return m}).setPrecision("unsigned").setOutput([l.width,l.height]);return SimpleRangeValue.onlyNumbersDataWithoutRange(c(i.rawNumbers(),a,s),l)}},{key:"transpose",value:function(r,e){if(1!==r.args.length)return new CellError(ErrorType.NA);if(r.args.some(function(r){return r.type===AstNodeType.EMPTY}))return new CellError(ErrorType.NUM);var t=coerceToRangeNumbersOrError(this.evaluateAst(r.args[0],e));if(t instanceof CellError)return t;if(null===t)return new CellError(ErrorType.VALUE);for(var o=t.rawNumbers(),n=t.size,i=[],a=0;a<n.width;++a){i[a]=[];for(var s=0;s<n.height;++s)i[a][s]=o[s][a]}return SimpleRangeValue.onlyNumbersDataWithoutRange(i,matrixSizeForTranspose(n))}}]),t}();MatrixPlugin.implementedFunctions={MMULT:{method:"mmult"},TRANSPOSE:{method:"transpose"},MAXPOOL:{method:"maxpool"},MEDIANPOOL:{method:"medianpool"}};
//# sourceMappingURL=/sm/3a5cc879ab8a39c91cf5ec936344c962541c56d5e48f1dc7381843bdef212844.map