/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/interpreter/plugin/SumifPlugin.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.iterator";import"core-js/modules/es.array.concat";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.join";import"core-js/modules/es.array.map";import"core-js/modules/es.array.slice";import"core-js/modules/es.array.some";import"core-js/modules/es.function.name";import"core-js/modules/es.object.get-prototype-of";import"core-js/modules/es.object.to-string";import"core-js/modules/es.reflect.construct";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.iterator";function _typeof(r){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}function _inherits(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&_setPrototypeOf(r,e)}function _setPrototypeOf(r,e){return(_setPrototypeOf=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r})(r,e)}function _createSuper(r){var e=_isNativeReflectConstruct();return function(){var t,n=_getPrototypeOf(r);if(e){var o=_getPrototypeOf(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(r,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(r):e}function _assertThisInitialized(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(r){return!1}}function _getPrototypeOf(r){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(r)}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(r))return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function _createClass(r,e,t){return e&&_defineProperties(r.prototype,e),t&&_defineProperties(r,t),r}import{CellError,ErrorType}from"../../Cell";import{AstNodeType}from"../../parser";import{coerceToRange}from"../ArithmeticHelper";import{Condition,CriterionFunctionCompute}from"../CriterionFunctionCompute";import{SimpleRangeValue}from"../InterpreterValue";import{FunctionPlugin}from"./FunctionPlugin";var AverageResult=function(){function r(e,t){_classCallCheck(this,r),this.sum=e,this.count=t}return _createClass(r,[{key:"compose",value:function(e){return new r(this.sum+e.sum,this.count+e.count)}},{key:"averageValue",value:function(){return this.count>0?this.sum/this.count:void 0}}],[{key:"single",value:function(e){return new r(e,1)}}]),r}();function sumifCacheKey(r){var e=r.map(function(r){return"".concat(r.conditionRange.range().sheet,",").concat(r.conditionRange.range().start.col,",").concat(r.conditionRange.range().start.row)});return["SUMIF"].concat(_toConsumableArray(e)).join(",")}function averageifCacheKey(r){var e=r.map(function(r){return"".concat(r.conditionRange.range().sheet,",").concat(r.conditionRange.range().start.col,",").concat(r.conditionRange.range().start.row)});return["AVERAGEIF"].concat(_toConsumableArray(e)).join(",")}function countifsCacheKey(r){var e=r.map(function(r){return"".concat(r.conditionRange.range().sheet,",").concat(r.conditionRange.range().start.col,",").concat(r.conditionRange.range().start.row)});return["COUNTIFS"].concat(_toConsumableArray(e)).join(",")}AverageResult.empty=new AverageResult(0,0);export var SumifPlugin=function(r){_inherits(t,FunctionPlugin);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"sumif",value:function(r,e){var t=this;if(r.args.length<2||r.args.length>3)return new CellError(ErrorType.NA);if(r.args.some(function(r){return r.type===AstNodeType.EMPTY}))return new CellError(ErrorType.NUM);var n=this.evaluateAst(r.args[0],e);if(n instanceof CellError)return n;var o=coerceToRange(n),i=this.evaluateAst(r.args[1],e);if(i instanceof SimpleRangeValue)return new CellError(ErrorType.VALUE);if(i instanceof CellError)return i;var a,u=this.interpreter.criterionBuilder.fromCellValue(i,this.interpreter.arithmeticHelper);if(void 0===u)return new CellError(ErrorType.VALUE);if(2==r.args.length)a=o;else{var s=this.evaluateAst(r.args[2],e);if(s instanceof CellError)return s;a=coerceToRange(s)}return new CriterionFunctionCompute(this.interpreter,sumifCacheKey,0,function(r,e){return t.interpreter.arithmeticHelper.nonstrictadd(r,e)},function(r){return r}).compute(a,[new Condition(o,u)])}},{key:"sumifs",value:function(r,e){var t=this;if(r.args.length<3||r.args.length%2==0)return new CellError(ErrorType.NA);if(r.args.some(function(r){return r.type===AstNodeType.EMPTY}))return new CellError(ErrorType.NUM);var n=this.evaluateAst(r.args[0],e);if(n instanceof CellError)return n;for(var o=coerceToRange(n),i=[],a=1;a<r.args.length;a+=2){var u=this.evaluateAst(r.args[a],e);if(u instanceof CellError)return u;var s=coerceToRange(u),c=this.evaluateAst(r.args[a+1],e);if(c instanceof SimpleRangeValue)return new CellError(ErrorType.VALUE);if(c instanceof CellError)return c;var l=this.interpreter.criterionBuilder.fromCellValue(c,this.interpreter.arithmeticHelper);if(void 0===l)return new CellError(ErrorType.VALUE);i.push(new Condition(s,l))}return new CriterionFunctionCompute(this.interpreter,sumifCacheKey,0,function(r,e){return t.interpreter.arithmeticHelper.nonstrictadd(r,e)},function(r){return r}).compute(o,i)}},{key:"averageif",value:function(r,e){if(r.args.length<2||r.args.length>3)return new CellError(ErrorType.NA);if(r.args.some(function(r){return r.type===AstNodeType.EMPTY}))return new CellError(ErrorType.NUM);var t=this.evaluateAst(r.args[0],e);if(t instanceof CellError)return t;var n=coerceToRange(t),o=this.evaluateAst(r.args[1],e);if(o instanceof SimpleRangeValue)return new CellError(ErrorType.VALUE);if(o instanceof CellError)return o;var i,a=this.interpreter.criterionBuilder.fromCellValue(o,this.interpreter.arithmeticHelper);if(void 0===a)return new CellError(ErrorType.VALUE);if(2==r.args.length)i=n;else{var u=this.evaluateAst(r.args[2],e);if(u instanceof CellError)return u;i=coerceToRange(u)}var s=new CriterionFunctionCompute(this.interpreter,averageifCacheKey,AverageResult.empty,function(r,e){return r.compose(e)},function(r){return"number"==typeof r?AverageResult.single(r):AverageResult.empty}).compute(i,[new Condition(n,a)]);return s instanceof CellError?s:s.averageValue()||new CellError(ErrorType.DIV_BY_ZERO)}},{key:"countif",value:function(r,e){if(2!==r.args.length)return new CellError(ErrorType.NA);if(r.args.some(function(r){return r.type===AstNodeType.EMPTY}))return new CellError(ErrorType.NUM);var t=this.evaluateAst(r.args[0],e);if(t instanceof CellError)return t;var n=coerceToRange(t),o=this.evaluateAst(r.args[1],e);if(o instanceof SimpleRangeValue)return new CellError(ErrorType.VALUE);if(o instanceof CellError)return o;var i=this.interpreter.criterionBuilder.fromCellValue(o,this.interpreter.arithmeticHelper);return void 0===i?new CellError(ErrorType.VALUE):new CriterionFunctionCompute(this.interpreter,function(){return"COUNTIF"},0,function(r,e){return r+e},function(){return 1}).compute(n,[new Condition(n,i)])}},{key:"countifs",value:function(r,e){if(r.args.length<2||r.args.length%2==1)return new CellError(ErrorType.NA);if(r.args.some(function(r){return r.type===AstNodeType.EMPTY}))return new CellError(ErrorType.NUM);for(var t=[],n=0;n<r.args.length;n+=2){var o=this.evaluateAst(r.args[n],e);if(o instanceof CellError)return o;var i=coerceToRange(o),a=this.evaluateAst(r.args[n+1],e);if(a instanceof SimpleRangeValue)return new CellError(ErrorType.VALUE);if(a instanceof CellError)return a;var u=this.interpreter.criterionBuilder.fromCellValue(a,this.interpreter.arithmeticHelper);if(void 0===u)return new CellError(ErrorType.VALUE);t.push(new Condition(i,u))}return new CriterionFunctionCompute(this.interpreter,countifsCacheKey,0,function(r,e){return r+e},function(){return 1}).compute(t[0].conditionRange,t)}}]),t}();SumifPlugin.implementedFunctions={SUMIF:{method:"sumif"},COUNTIF:{method:"countif"},AVERAGEIF:{method:"averageif"},SUMIFS:{method:"sumifs"},COUNTIFS:{method:"countifs"}};
//# sourceMappingURL=/sm/0942bb0061bc6226e18dc47475a5d849fdf8833e10604966b336c48aaba0b659.map