/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/interpreter/Interpreter.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.iterator";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.slice";import"core-js/modules/es.function.name";import"core-js/modules/es.object.to-string";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.iterator";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],a=!0,s=!1,i=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(t.push(o.value),!r||t.length!==r);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}import GPU from"gpu.js";import{AbsoluteCellRange,AbsoluteColumnRange,AbsoluteRowRange}from"../AbsoluteCellRange";import{CellError,ErrorType,invalidSimpleCellAddress}from"../Cell";import{Matrix,NotComputedMatrix}from"../Matrix";import{AstNodeType}from"../parser/Ast";import{ArithmeticHelper,divide,multiply,percent,power,unaryminus}from"./ArithmeticHelper";import{CriterionBuilder}from"./Criterion";import{SimpleRangeValue}from"./InterpreterValue";import{concatenate}from"./text";export var Interpreter=function(){function e(r,t,a,s,i,o,n,l){_classCallCheck(this,e),this.dependencyGraph=r,this.columnSearch=t,this.config=a,this.stats=s,this.dateHelper=i,this.numberLiteralsHelper=o,this.functionRegistry=n,this.namedExpressions=l,this.functionRegistry.initializePlugins(this),this.arithmeticHelper=new ArithmeticHelper(a,i,o),this.criterionBuilder=new CriterionBuilder(a)}return _createClass(e,[{key:"evaluateAst",value:function(e,r){var t,a,s,i,o,n,l,u,c,p,h;switch(e.type){case AstNodeType.EMPTY:throw new Error("Empty argument should not be evaluated.");case AstNodeType.CELL_REFERENCE:var m=e.reference.toSimpleCellAddress(r);return invalidSimpleCellAddress(m)?new CellError(ErrorType.REF):this.dependencyGraph.getCellValue(m);case AstNodeType.NUMBER:case AstNodeType.STRING:return e.value;case AstNodeType.CONCATENATE_OP:var d=this.evaluateAst(e.left,r),A=this.evaluateAst(e.right,r);return concatenate([d,A]);case AstNodeType.EQUALS_OP:var y=this.evaluateAst(e.left,r),E=this.evaluateAst(e.right,r);return null!==(t=this.passErrors(y,E))&&void 0!==t?t:0===this.arithmeticHelper.compare(y,E);case AstNodeType.NOT_EQUAL_OP:var v=this.evaluateAst(e.left,r),f=this.evaluateAst(e.right,r);return null!==(a=this.passErrors(v,f))&&void 0!==a?a:0!==this.arithmeticHelper.compare(v,f);case AstNodeType.GREATER_THAN_OP:var T=this.evaluateAst(e.left,r),N=this.evaluateAst(e.right,r);return null!==(s=this.passErrors(T,N))&&void 0!==s?s:this.arithmeticHelper.compare(T,N)>0;case AstNodeType.LESS_THAN_OP:var g=this.evaluateAst(e.left,r),R=this.evaluateAst(e.right,r);return null!==(i=this.passErrors(g,R))&&void 0!==i?i:this.arithmeticHelper.compare(g,R)<0;case AstNodeType.GREATER_THAN_OR_EQUAL_OP:var S=this.evaluateAst(e.left,r),_=this.evaluateAst(e.right,r);return null!==(o=this.passErrors(S,_))&&void 0!==o?o:this.arithmeticHelper.compare(S,_)>=0;case AstNodeType.LESS_THAN_OR_EQUAL_OP:var b=this.evaluateAst(e.left,r),C=this.evaluateAst(e.right,r);return null!==(n=this.passErrors(b,C))&&void 0!==n?n:this.arithmeticHelper.compare(b,C)<=0;case AstNodeType.PLUS_OP:var O=this.evaluateAst(e.left,r),w=this.evaluateAst(e.right,r);return null!==(l=this.passErrors(O,w))&&void 0!==l?l:this.arithmeticHelper.add(this.arithmeticHelper.coerceScalarToNumberOrError(O),this.arithmeticHelper.coerceScalarToNumberOrError(w));case AstNodeType.MINUS_OP:var H=this.evaluateAst(e.left,r),P=this.evaluateAst(e.right,r);return null!==(u=this.passErrors(H,P))&&void 0!==u?u:this.arithmeticHelper.subtract(this.arithmeticHelper.coerceScalarToNumberOrError(H),this.arithmeticHelper.coerceScalarToNumberOrError(P));case AstNodeType.TIMES_OP:var L=this.evaluateAst(e.left,r),U=this.evaluateAst(e.right,r);return null!==(c=this.passErrors(L,U))&&void 0!==c?c:multiply(this.arithmeticHelper.coerceScalarToNumberOrError(L),this.arithmeticHelper.coerceScalarToNumberOrError(U));case AstNodeType.POWER_OP:var I=this.evaluateAst(e.left,r),V=this.evaluateAst(e.right,r);return null!==(p=this.passErrors(I,V))&&void 0!==p?p:power(this.arithmeticHelper.coerceScalarToNumberOrError(I),this.arithmeticHelper.coerceScalarToNumberOrError(V));case AstNodeType.DIV_OP:var j=this.evaluateAst(e.left,r),x=this.evaluateAst(e.right,r);return null!==(h=this.passErrors(j,x))&&void 0!==h?h:divide(this.arithmeticHelper.coerceScalarToNumberOrError(j),this.arithmeticHelper.coerceScalarToNumberOrError(x));case AstNodeType.PLUS_UNARY_OP:var G=this.evaluateAst(e.value,r);return G instanceof SimpleRangeValue?new CellError(ErrorType.VALUE):G;case AstNodeType.MINUS_UNARY_OP:var M=this.evaluateAst(e.value,r);return M instanceof SimpleRangeValue?new CellError(ErrorType.VALUE):unaryminus(this.arithmeticHelper.coerceScalarToNumberOrError(M));case AstNodeType.PERCENT_OP:var k=this.evaluateAst(e.value,r);return k instanceof SimpleRangeValue?new CellError(ErrorType.VALUE):percent(this.arithmeticHelper.coerceScalarToNumberOrError(k));case AstNodeType.FUNCTION_CALL:var F=this.functionRegistry.getFunction(e.procedureName);if(F&&this.config.translationPackage.isFunctionTranslated(e.procedureName)){var W=_slicedToArray(F,2),B=W[0];return W[1][B](e,r)}return new CellError(ErrorType.NAME);case AstNodeType.NAMED_EXPRESSION:var Q=this.namedExpressions.nearestNamedExpression(e.expressionName,r.sheet);return Q?this.dependencyGraph.getCellValue(Q.address):new CellError(ErrorType.NAME);case AstNodeType.CELL_RANGE:if(!this.rangeSpansOneSheet(e))return new CellError(ErrorType.REF);var D=AbsoluteCellRange.fromCellRange(e,r),Y=this.dependencyGraph.getMatrix(D);if(Y){var z=Y.matrix;if(z instanceof NotComputedMatrix)throw new Error("Matrix should be already computed");if(z instanceof CellError)return z;if(z instanceof Matrix)return SimpleRangeValue.onlyNumbersDataWithRange(z.raw(),z.size,D);throw new Error("Unknown matrix")}return SimpleRangeValue.onlyRange(D,this.dependencyGraph);case AstNodeType.COLUMN_RANGE:if(!this.rangeSpansOneSheet(e))return new CellError(ErrorType.REF);var X=AbsoluteColumnRange.fromColumnRange(e,r);return SimpleRangeValue.onlyRange(X,this.dependencyGraph);case AstNodeType.ROW_RANGE:if(!this.rangeSpansOneSheet(e))return new CellError(ErrorType.REF);var $=AbsoluteRowRange.fromRowRange(e,r);return SimpleRangeValue.onlyRange($,this.dependencyGraph);case AstNodeType.PARENTHESIS:return this.evaluateAst(e.expression,r);case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.ERROR:return e.error}}},{key:"getGpuInstance",value:function(){if(!this.gpu){var e=GPU.GPU||GPU;this.gpu=new e({mode:this.config.gpuMode})}return this.gpu}},{key:"destroy",value:function(){this.gpu&&this.gpu.destroy()}},{key:"rangeSpansOneSheet",value:function(e){return e.start.sheet===e.end.sheet}},{key:"passErrors",value:function(e,r){return e instanceof CellError?e:e instanceof SimpleRangeValue?new CellError(ErrorType.VALUE):r instanceof CellError?r:r instanceof SimpleRangeValue?new CellError(ErrorType.VALUE):void 0}}]),e}();
//# sourceMappingURL=/sm/a410ff2141715f28ac59efb4e1ca68ef2acec800ecc6b2d69a2b4ec94e54e23b.map