/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/Operations.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.iterator";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.map";import"core-js/modules/es.array.reduce";import"core-js/modules/es.array.slice";import"core-js/modules/es.array.sort";import"core-js/modules/es.function.name";import"core-js/modules/es.number.constructor";import"core-js/modules/es.number.is-integer";import"core-js/modules/es.object.to-string";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.iterator";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,s=!1,a=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(t.push(o.value),!r||t.length!==r);n=!0);}catch(e){s=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(s)throw a}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==t.return||t.return()}finally{if(i)throw a}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}import{StatType}from"./statistics";import{ClipboardCellType}from"./ClipboardOperations";import{EmptyValue,invalidSimpleCellAddress,simpleCellAddress}from"./Cell";import{CellContent}from"./CellContentParser";import{ColumnsSpan,RowsSpan}from"./Span";import{ContentChanges}from"./ContentChanges";import{absolutizeDependencies}from"./absolutizeDependencies";import{buildMatrixVertex}from"./GraphBuilder";import{EmptyCellVertex,FormulaCellVertex,MatrixVertex,ParsingErrorVertex,SparseStrategy,ValueCellVertex}from"./DependencyGraph";import{InvalidArgumentsError,NamedExpressionDoesNotExistError,NoRelativeAddressesAllowedError,SheetSizeLimitExceededError,SourceLocationHasMatrixError,TargetLocationHasMatrixError}from"./errors";import{NamedExpressionDependency}from"./parser";import{AddRowsTransformer}from"./dependencyTransformers/AddRowsTransformer";import{RemoveRowsTransformer}from"./dependencyTransformers/RemoveRowsTransformer";import{AddColumnsTransformer}from"./dependencyTransformers/AddColumnsTransformer";import{MoveCellsTransformer}from"./dependencyTransformers/MoveCellsTransformer";import{RemoveSheetTransformer}from"./dependencyTransformers/RemoveSheetTransformer";import{RemoveColumnsTransformer}from"./dependencyTransformers/RemoveColumnsTransformer";import{AbsoluteCellRange}from"./AbsoluteCellRange";import{findBoundaries}from"./Sheet";import{doesContainRelativeReferences}from"./NamedExpressions";export var RemoveRowsCommand=function(){function e(r,t){_classCallCheck(this,e),this.sheet=r,this.indexes=t}return _createClass(e,[{key:"normalizedIndexes",value:function(){return normalizeRemovedIndexes(this.indexes)}},{key:"rowsSpans",value:function(){var e=this;return this.normalizedIndexes().map(function(r){return RowsSpan.fromNumberOfRows(e.sheet,r[0],r[1])})}}]),e}();export var AddRowsCommand=function(){function e(r,t){_classCallCheck(this,e),this.sheet=r,this.indexes=t}return _createClass(e,[{key:"normalizedIndexes",value:function(){return normalizeAddedIndexes(this.indexes)}},{key:"rowsSpans",value:function(){var e=this;return this.normalizedIndexes().map(function(r){return RowsSpan.fromNumberOfRows(e.sheet,r[0],r[1])})}}]),e}();export var AddColumnsCommand=function(){function e(r,t){_classCallCheck(this,e),this.sheet=r,this.indexes=t}return _createClass(e,[{key:"normalizedIndexes",value:function(){return normalizeAddedIndexes(this.indexes)}},{key:"columnsSpans",value:function(){var e=this;return this.normalizedIndexes().map(function(r){return ColumnsSpan.fromNumberOfColumns(e.sheet,r[0],r[1])})}}]),e}();export var RemoveColumnsCommand=function(){function e(r,t){_classCallCheck(this,e),this.sheet=r,this.indexes=t}return _createClass(e,[{key:"normalizedIndexes",value:function(){return normalizeRemovedIndexes(this.indexes)}},{key:"columnsSpans",value:function(){var e=this;return this.normalizedIndexes().map(function(r){return ColumnsSpan.fromNumberOfColumns(e.sheet,r[0],r[1])})}}]),e}();export var Operations=function(){function e(r,t,n,s,a,o,i,l){_classCallCheck(this,e),this.dependencyGraph=r,this.columnSearch=t,this.cellContentParser=n,this.parser=s,this.stats=a,this.lazilyTransformingAstService=o,this.namedExpressions=i,this.config=l,this.changes=ContentChanges.empty(),this.allocateNamedExpressionAddressSpace()}return _createClass(e,[{key:"removeRows",value:function(e){var r,t=[],n=_createForOfIteratorHelper(e.rowsSpans());try{for(n.s();!(r=n.n()).done;){var s=r.value,a=this.doRemoveRows(s);a&&t.push(a)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"addRows",value:function(e){var r,t=_createForOfIteratorHelper(e.rowsSpans());try{for(t.s();!(r=t.n()).done;){var n=r.value;this.doAddRows(n)}}catch(e){t.e(e)}finally{t.f()}}},{key:"addColumns",value:function(e){var r,t=_createForOfIteratorHelper(e.columnsSpans());try{for(t.s();!(r=t.n()).done;){var n=r.value;this.doAddColumns(n)}}catch(e){t.e(e)}finally{t.f()}}},{key:"removeColumns",value:function(e){var r,t=[],n=_createForOfIteratorHelper(e.columnsSpans());try{for(n.s();!(r=n.n()).done;){var s=r.value,a=this.doRemoveColumns(s);a&&t.push(a)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"removeSheet",value:function(e){var r,t=this,n=this.sheetMapping.fetch(e);return this.dependencyGraph.removeSheet(n),this.stats.measure(StatType.TRANSFORM_ASTS,function(){var e=new RemoveSheetTransformer(n);e.performEagerTransformations(t.dependencyGraph,t.parser),r=t.lazilyTransformingAstService.addTransformation(e)}),this.sheetMapping.removeSheet(n),this.columnSearch.removeSheet(n),r}},{key:"clearSheet",value:function(e){this.dependencyGraph.clearSheet(e),this.columnSearch.removeSheet(e)}},{key:"addSheet",value:function(e){var r=this.sheetMapping.addSheet(e),t=[];return this.dependencyGraph.addressMapping.autoAddSheet(r,t,findBoundaries(t)),this.sheetMapping.fetchDisplayName(r)}},{key:"renameSheet",value:function(e,r){return this.sheetMapping.renameSheet(e,r)}},{key:"moveRows",value:function(e,r,t,n){var s=RowsSpan.fromNumberOfRows(e,n,t);this.doAddRows(s),n<r&&(r+=t);var a=simpleCellAddress(e,0,r),o=simpleCellAddress(e,0,n);this.moveCells(a,Number.POSITIVE_INFINITY,t,o);var i=RowsSpan.fromNumberOfRows(e,r,t);this.doRemoveRows(i)}},{key:"moveColumns",value:function(e,r,t,n){var s=ColumnsSpan.fromNumberOfColumns(e,n,t);this.doAddColumns(s),n<r&&(r+=t);var a=simpleCellAddress(e,r,0),o=simpleCellAddress(e,n,0);this.moveCells(a,t,Number.POSITIVE_INFINITY,o);var i=ColumnsSpan.fromNumberOfColumns(e,r,t);this.doRemoveColumns(i)}},{key:"moveCells",value:function(e,r,t,n){var s=this;this.ensureItIsPossibleToMoveCells(e,r,t,n);var a=AbsoluteCellRange.spanFrom(e,r,t),o=AbsoluteCellRange.spanFrom(n,r,t);this.dependencyGraph.breakNumericMatricesInRange(a),this.dependencyGraph.breakNumericMatricesInRange(o);var i=n.col-e.col,l=n.row-e.row,d=n.sheet,p=this.getRangeClipboardCells(o),u=this.dependencyGraph.valuesFromRange(o);this.columnSearch.removeValues(u);var h,c=this.dependencyGraph.valuesFromRange(a);this.columnSearch.moveValues(c,i,l,d),this.stats.measure(StatType.TRANSFORM_ASTS,function(){var e=new MoveCellsTransformer(a,i,l,d);e.performEagerTransformations(s.dependencyGraph,s.parser),h=s.lazilyTransformingAstService.addTransformation(e)}),this.dependencyGraph.moveCells(a,i,l,d);var m=this.updateNamedExpressionsForMovedCells(e,r,t,n);return{version:h,overwrittenCellsData:p,addedGlobalNamedExpressions:m}}},{key:"addNamedExpression",value:function(e,r,t,n){this.storeNamedExpressionInCell(this.namedExpressions.lookupNextAddress(e,t),r);var s=this.namedExpressions.addNamedExpression(e,t,n);this.adjustNamedExpressionEdges(s,e,t)}},{key:"restoreNamedExpression",value:function(e,r,t){var n=e.displayName,s=e.options;this.restoreCell(e.address,r);var a=this.namedExpressions.addNamedExpression(n,t,s);this.adjustNamedExpressionEdges(a,n,t)}},{key:"changeNamedExpressionExpression",value:function(e,r,t,n){var s=this.namedExpressions.namedExpressionForScope(e,t);if(!s)throw new NamedExpressionDoesNotExistError(e);var a=s.copy();s.options=n;var o=this.getClipboardCell(s.address);return this.storeNamedExpressionInCell(s.address,r),[a,o]}},{key:"removeNamedExpression",value:function(e,r){var t=this.namedExpressions.namedExpressionForScope(e,r);if(!t)throw new NamedExpressionDoesNotExistError(e);this.namedExpressions.remove(t.displayName,r);var n=this.getClipboardCell(t.address);if(void 0!==r){var s=this.namedExpressions.workbookNamedExpressionOrPlaceholder(e);this.dependencyGraph.exchangeNode(t.address,s.address)}else this.dependencyGraph.setCellEmpty(t.address);return[t,n]}},{key:"ensureItIsPossibleToMoveCells",value:function(e,r,t,n){if(invalidSimpleCellAddress(e)||!(isPositiveInteger(r)&&isPositiveInteger(t)||isRowOrColumnRange(e,r,t))||invalidSimpleCellAddress(n)||!this.sheetMapping.hasSheetWithId(e.sheet)||!this.sheetMapping.hasSheetWithId(n.sheet))throw new InvalidArgumentsError("a valid range of cells to move.");var s=AbsoluteCellRange.spanFrom(e,r,t),a=AbsoluteCellRange.spanFrom(n,r,t);if(a.exceedsSheetSizeLimits(this.config.maxColumns,this.config.maxRows))throw new SheetSizeLimitExceededError;if(this.dependencyGraph.matrixMapping.isFormulaMatrixInRange(s))throw new SourceLocationHasMatrixError;if(this.dependencyGraph.matrixMapping.isFormulaMatrixInRange(a))throw new TargetLocationHasMatrixError}},{key:"restoreClipboardCells",value:function(e,r){var t,n=[],s=_createForOfIteratorHelper(r);try{for(s.s();!(t=s.n()).done;){var a=_slicedToArray(t.value,2),o=a[0],i=a[1];if(this.restoreCell(o,i),i.type===ClipboardCellType.FORMULA){var l=this.parser.fetchCachedResult(i.hash).dependencies;n.push.apply(n,_toConsumableArray(this.updateNamedExpressionsForTargetAddress(e,o,l)))}}}catch(e){s.e(e)}finally{s.f()}return n}},{key:"restoreCell",value:function(e,r){switch(r.type){case ClipboardCellType.VALUE:this.setValueToCell(r.value,e);break;case ClipboardCellType.FORMULA:this.setFormulaToCellFromCache(r.hash,e);break;case ClipboardCellType.EMPTY:this.setCellEmpty(e);break;case ClipboardCellType.PARSING_ERROR:this.setParsingErrorToCell(r.rawInput,r.errors,e)}}},{key:"doRemoveRows",value:function(e){var r=this;if(!this.rowEffectivelyNotInSheet(e.rowStart,e.sheet)){var t,n,s=[],a=_createForOfIteratorHelper(this.dependencyGraph.entriesFromRowsSpan(e));try{for(a.s();!(t=a.n()).done;){var o=_slicedToArray(t.value,1)[0];s.push({address:o,cellType:this.getClipboardCell(o)})}}catch(e){a.e(e)}finally{a.f()}return this.dependencyGraph.removeRows(e),this.stats.measure(StatType.TRANSFORM_ASTS,function(){var t=new RemoveRowsTransformer(e);t.performEagerTransformations(r.dependencyGraph,r.parser),n=r.lazilyTransformingAstService.addTransformation(t)}),{version:n,removedCells:s,rowFrom:e.rowStart,rowCount:e.numberOfRows}}}},{key:"doRemoveColumns",value:function(e){var r=this;if(!this.columnEffectivelyNotInSheet(e.columnStart,e.sheet)){var t,n,s=[],a=_createForOfIteratorHelper(this.dependencyGraph.entriesFromColumnsSpan(e));try{for(a.s();!(t=a.n()).done;){var o=_slicedToArray(t.value,1)[0];s.push({address:o,cellType:this.getClipboardCell(o)})}}catch(e){a.e(e)}finally{a.f()}return this.dependencyGraph.removeColumns(e),this.columnSearch.removeColumns(e),this.stats.measure(StatType.TRANSFORM_ASTS,function(){var t=new RemoveColumnsTransformer(e);t.performEagerTransformations(r.dependencyGraph,r.parser),n=r.lazilyTransformingAstService.addTransformation(t)}),{version:n,removedCells:s,columnFrom:e.columnStart,columnCount:e.numberOfColumns}}}},{key:"doAddRows",value:function(e){var r=this;this.rowEffectivelyNotInSheet(e.rowStart,e.sheet)||(this.dependencyGraph.addRows(e),this.stats.measure(StatType.TRANSFORM_ASTS,function(){var t=new AddRowsTransformer(e);t.performEagerTransformations(r.dependencyGraph,r.parser),r.lazilyTransformingAstService.addTransformation(t)}))}},{key:"doAddColumns",value:function(e){var r=this;this.columnEffectivelyNotInSheet(e.columnStart,e.sheet)||(this.dependencyGraph.addColumns(e),this.columnSearch.addColumns(e),this.stats.measure(StatType.TRANSFORM_ASTS,function(){var t=new AddColumnsTransformer(e);t.performEagerTransformations(r.dependencyGraph,r.parser),r.lazilyTransformingAstService.addTransformation(t)}))}},{key:"getClipboardCell",value:function(e){var r=this.dependencyGraph.getCell(e);if(null===r||r instanceof EmptyCellVertex)return{type:ClipboardCellType.EMPTY};if(r instanceof ValueCellVertex)return{type:ClipboardCellType.VALUE,value:r.getCellValue()};if(r instanceof MatrixVertex)return{type:ClipboardCellType.VALUE,value:r.getMatrixCellValue(e)};if(r instanceof FormulaCellVertex)return{type:ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(r.getFormula(this.lazilyTransformingAstService))};if(r instanceof ParsingErrorVertex)return{type:ClipboardCellType.PARSING_ERROR,rawInput:r.rawInput,errors:r.errors};throw Error("Trying to copy unsupported type")}},{key:"getSheetClipboardCells",value:function(e){for(var r=this.dependencyGraph.getSheetHeight(e),t=this.dependencyGraph.getSheetWidth(e),n=new Array(r),s=0;s<r;s++){n[s]=new Array(t);for(var a=0;a<t;a++){var o=simpleCellAddress(e,a,s);n[s][a]=this.getClipboardCell(o)}}return n}},{key:"getRangeClipboardCells",value:function(e){var r,t=[],n=_createForOfIteratorHelper(e.addresses(this.dependencyGraph));try{for(n.s();!(r=n.n()).done;){var s=r.value;t.push([s,this.getClipboardCell(s)])}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"setCellContent",value:function(e,r){var t=this.cellContentParser.parse(r),n=this.dependencyGraph.getCell(e);if(!(n instanceof MatrixVertex)||n.isFormula()||t instanceof CellContent.Number||(this.dependencyGraph.breakNumericMatrix(n),n=this.dependencyGraph.getCell(e)),n instanceof MatrixVertex&&!n.isFormula()&&t instanceof CellContent.Number){var s=t.value,a=this.dependencyGraph.getCellValue(e);this.dependencyGraph.graph.markNodeAsSpecialRecentlyChanged(n),n.setMatrixCellValue(e,s),this.columnSearch.change(a,s,e),this.changes.addChange(s,e)}else if(!(n instanceof MatrixVertex)&&t instanceof CellContent.MatrixFormula){var o=this.parser.parse(t.formula,e),i=o.ast,l=o.errors,d=o.dependencies;if(l.length>0)this.dependencyGraph.setParsingErrorToCell(e,new ParsingErrorVertex(l,t.formulaWithBraces()));else{var p=buildMatrixVertex(i,e);if(p instanceof ValueCellVertex)throw Error("What if new matrix vertex is not properly constructed?");this.dependencyGraph.addNewMatrixVertex(p),this.dependencyGraph.processCellDependencies(absolutizeDependencies(d,e),p),this.dependencyGraph.graph.markNodeAsSpecialRecentlyChanged(p)}}else{if(n instanceof MatrixVertex)throw new Error("Illegal operation");if(t instanceof CellContent.Formula){var u=this.parser.parse(t.formula,e),h=u.ast,c=u.errors,m=u.hasVolatileFunction,f=u.hasStructuralChangeFunction,y=u.dependencies;c.length>0?this.dependencyGraph.setParsingErrorToCell(e,new ParsingErrorVertex(c,t.formula)):this.dependencyGraph.setFormulaToCell(e,h,absolutizeDependencies(y,e),m,f)}else if(t instanceof CellContent.Empty)this.setCellEmpty(e);else{if(t instanceof CellContent.MatrixFormula)throw new Error("Cant happen");this.setValueToCell(t.value,e)}}}},{key:"setSheetContent",value:function(e,r){this.clearSheet(e);for(var t=0;t<r.length;t++)for(var n=0;n<r[t].length;n++){var s=simpleCellAddress(e,n,t);this.setCellContent(s,r[t][n])}}},{key:"setValueToCell",value:function(e,r){var t=this.dependencyGraph.getCellValue(r);this.dependencyGraph.setValueToCell(r,e),this.columnSearch.change(t,e,r),this.changes.addChange(e,r)}},{key:"setCellEmpty",value:function(e){var r=this.dependencyGraph.getCellValue(e);this.columnSearch.remove(r,e),this.changes.addChange(EmptyValue,e),this.dependencyGraph.setCellEmpty(e)}},{key:"setFormulaToCellFromCache",value:function(e,r){var t=this.parser.fetchCachedResult(e),n=t.ast,s=t.hasVolatileFunction,a=t.hasStructuralChangeFunction,o=t.dependencies;this.dependencyGraph.setFormulaToCell(r,n,absolutizeDependencies(o,r),s,a)}},{key:"setParsingErrorToCell",value:function(e,r,t){this.dependencyGraph.setParsingErrorToCell(t,new ParsingErrorVertex(r,e))}},{key:"rowEffectivelyNotInSheet",value:function(e,r){return e>=this.dependencyGraph.addressMapping.getHeight(r)}},{key:"getAndClearContentChanges",value:function(){var e=this.changes;return this.changes=ContentChanges.empty(),e}},{key:"forceApplyPostponedTransformations",value:function(){this.dependencyGraph.forceApplyPostponedTransformations()}},{key:"columnEffectivelyNotInSheet",value:function(e,r){return e>=this.dependencyGraph.addressMapping.getWidth(r)}},{key:"adjustNamedExpressionEdges",value:function(e,r,t){if(void 0!==t){var n,s=this.dependencyGraph.fetchCellOrCreateEmpty(e.address),a=this.namedExpressions.workbookNamedExpressionOrPlaceholder(r),o=this.dependencyGraph.fetchCellOrCreateEmpty(a.address),i=_createForOfIteratorHelper(this.dependencyGraph.graph.adjacentNodes(o));try{for(i.s();!(n=i.n()).done;){var l=n.value;if((l instanceof FormulaCellVertex||l instanceof MatrixVertex)&&l.cellAddress.sheet===t){var d=l.getFormula(this.lazilyTransformingAstService);if(d){var p,u=l.getAddress(this.lazilyTransformingAstService),h=this.parser.fetchCachedResultForAst(d).dependencies,c=_createForOfIteratorHelper(absolutizeDependencies(h,u));try{for(c.s();!(p=c.n()).done;){var m=p.value;m instanceof NamedExpressionDependency&&m.name.toLowerCase()===e.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdge(o,l),this.dependencyGraph.graph.addEdge(s,l))}}catch(e){c.e(e)}finally{c.f()}}}}}catch(e){i.e(e)}finally{i.f()}}}},{key:"storeNamedExpressionInCell",value:function(e,r){var t=this.cellContentParser.parse(r);if(t instanceof CellContent.MatrixFormula)throw new Error("Matrix formulas are not supported");if(t instanceof CellContent.Formula){var n=this.parser.parse(t.formula,simpleCellAddress(-1,0,0));if(doesContainRelativeReferences(n.ast))throw new NoRelativeAddressesAllowedError;var s=n.ast,a=n.hasVolatileFunction,o=n.hasStructuralChangeFunction,i=n.dependencies;this.dependencyGraph.setFormulaToCell(e,s,absolutizeDependencies(i,e),a,o)}else t instanceof CellContent.Empty?this.setCellEmpty(e):this.setValueToCell(t.value,e)}},{key:"updateNamedExpressionsForMovedCells",value:function(e,r,t,n){if(e.sheet===n.sheet)return[];var s,a=[],o=_createForOfIteratorHelper(AbsoluteCellRange.spanFrom(n,r,t).addresses(this.dependencyGraph));try{for(o.s();!(s=o.n()).done;){var i=s.value,l=this.addressMapping.fetchCell(i);if(l instanceof FormulaCellVertex&&i.sheet!==e.sheet){var d=l.getFormula(this.lazilyTransformingAstService),p=this.parser.fetchCachedResultForAst(d).dependencies;a.push.apply(a,_toConsumableArray(this.updateNamedExpressionsForTargetAddress(e.sheet,i,p)))}}}catch(e){o.e(e)}finally{o.f()}return a}},{key:"updateNamedExpressionsForTargetAddress",value:function(e,r,t){if(e===r.sheet)return[];var n,s=[],a=this.addressMapping.fetchCell(r),o=_createForOfIteratorHelper(absolutizeDependencies(t,r));try{for(o.s();!(n=o.n()).done;){var i=n.value;if(i instanceof NamedExpressionDependency){var l=i.name,d=this.dependencyGraph.fetchNamedExpressionVertex(l,e),p=this.namedExpressions.isExpressionInScope(l,r.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(l,r.sheet):this.copyOrFetchGlobalNamedExpressionVertex(l,d,s);p!==d&&(this.dependencyGraph.graph.softRemoveEdge(d,a),this.dependencyGraph.graph.addEdge(p,a))}}}catch(e){o.e(e)}finally{o.f()}return s}},{key:"allocateNamedExpressionAddressSpace",value:function(){this.dependencyGraph.addressMapping.addSheet(-1,new SparseStrategy(0,0))}},{key:"copyOrFetchGlobalNamedExpressionVertex",value:function(e,r,t){var n=this.namedExpressions.namedExpressionForScope(e);if(void 0===n)if(n=this.namedExpressions.addNamedExpression(e),t.push(n.normalizeExpressionName()),r instanceof FormulaCellVertex){var s=this.parser.fetchCachedResultForAst(r.getFormula(this.lazilyTransformingAstService)),a=s.ast,o=s.hasVolatileFunction,i=s.hasStructuralChangeFunction,l=s.dependencies;this.dependencyGraph.setFormulaToCell(n.address,a,absolutizeDependencies(l,n.address),o,i)}else r instanceof EmptyCellVertex?this.setCellEmpty(n.address):r instanceof ValueCellVertex&&this.setValueToCell(r.getCellValue(),n.address);return this.dependencyGraph.fetchCellOrCreateEmpty(n.address)}},{key:"sheetMapping",get:function(){return this.dependencyGraph.sheetMapping}},{key:"addressMapping",get:function(){return this.dependencyGraph.addressMapping}}]),e}();export function normalizeRemovedIndexes(e){if(e.length<=1)return e;for(var r=e.sort(function(e,r){var t=_slicedToArray(e,1)[0],n=_slicedToArray(r,1)[0];return t<n?-1:t>n?1:0}),t=r.reduce(function(e,r){var t=_slicedToArray(r,2),n=t[0],s=t[1],a=e[e.length-1],o=a[0]+a[1];return n<=o?a[1]+=Math.max(0,s-(o-n)):e.push([n,s]),e},[r[0]]),n=0,s=0;s<t.length;++s)t[s][0]-=n,n+=t[s][1];return t}export function normalizeAddedIndexes(e){if(e.length<=1)return e;for(var r=e.sort(function(e,r){var t=_slicedToArray(e,1)[0],n=_slicedToArray(r,1)[0];return t<n?-1:t>n?1:0}),t=r.reduce(function(e,r){var t=_slicedToArray(r,2),n=t[0],s=t[1],a=e[e.length-1];return n===a[0]?a[1]=Math.max(a[1],s):e.push([n,s]),e},[r[0]]),n=0,s=0;s<t.length;++s)t[s][0]+=n,n+=t[s][1];return t}function isPositiveInteger(e){return Number.isInteger(e)&&e>0}function isRowOrColumnRange(e,r,t){return 0===e.row&&isPositiveInteger(r)&&t===Number.POSITIVE_INFINITY||0===e.col&&isPositiveInteger(t)&&r===Number.POSITIVE_INFINITY}
//# sourceMappingURL=/sm/31ce9b7b77f0c160eda26f5404439e8043f5cbe91361ddc5e5e1ffdd2dd20c6a.map