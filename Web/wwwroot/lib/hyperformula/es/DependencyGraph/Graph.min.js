/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/DependencyGraph/Graph.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.iterator";import"core-js/modules/es.array.for-each";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.reverse";import"core-js/modules/es.array.slice";import"core-js/modules/es.function.name";import"core-js/modules/es.map";import"core-js/modules/es.object.to-string";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.set";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.for-each";import"core-js/modules/web.dom-collections.iterator";function _createForOfIteratorHelper(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw s}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var NodeVisitStatus;!function(e){e[e.ON_STACK=0]="ON_STACK",e[e.PROCESSED=1]="PROCESSED",e[e.POPPED=2]="POPPED"}(NodeVisitStatus||(NodeVisitStatus={}));export var Graph=function(){function e(t){_classCallCheck(this,e),this.dependencyQuery=t,this.nodes=new Set,this.specialNodes=new Set,this.specialNodesStructuralChanges=new Set,this.specialNodesRecentlyChanged=new Set,this.infiniteRanges=new Set,this.edges=new Map}return _createClass(e,[{key:"addNode",value:function(e){this.nodes.add(e),this.edges.has(e)||this.edges.set(e,new Set)}},{key:"addEdge",value:function(e,t){if(!this.nodes.has(e))throw new Error("Unknown node ".concat(e));if(!this.nodes.has(t))throw new Error("Unknown node ".concat(t));this.edges.get(e).add(t)}},{key:"removeEdge",value:function(e,t){if(!this.existsEdge(e,t))throw new Error("Edge does not exist");this.edges.get(e).delete(t)}},{key:"softRemoveEdge",value:function(e,t){var r;null===(r=this.edges.get(e))||void 0===r||r.delete(t)}},{key:"removeIncomingEdges",value:function(e){this.edges.forEach(function(t){t.delete(e)})}},{key:"adjacentNodes",value:function(e){return this.edges.get(e)}},{key:"adjacentNodesCount",value:function(e){return this.adjacentNodes(e).size}},{key:"hasNode",value:function(e){return this.nodes.has(e)}},{key:"nodesCount",value:function(){return this.nodes.size}},{key:"edgesCount",value:function(){var e=0;return this.edges.forEach(function(t){return e+=t.size}),e}},{key:"removeNode",value:function(e){var t,r=_createForOfIteratorHelper(this.adjacentNodes(e).values());try{for(r.s();!(t=r.n()).done;){var n=t.value;this.markNodeAsSpecialRecentlyChanged(n)}}catch(e){r.e(e)}finally{r.f()}return this.edges.delete(e),this.nodes.delete(e),this.specialNodes.delete(e),this.specialNodesRecentlyChanged.delete(e),this.specialNodesStructuralChanges.delete(e),this.infiniteRanges.delete(e),this.removeDependencies(e)}},{key:"markNodeAsSpecial",value:function(e){this.specialNodes.add(e)}},{key:"markNodeAsSpecialRecentlyChanged",value:function(e){this.nodes.has(e)&&this.specialNodesRecentlyChanged.add(e)}},{key:"markNodeAsChangingWithStructure",value:function(e){this.specialNodesStructuralChanges.add(e)}},{key:"clearSpecialNodesRecentlyChanged",value:function(){this.specialNodesRecentlyChanged.clear()}},{key:"markNodeAsInfiniteRange",value:function(e){this.infiniteRanges.add(e)}},{key:"existsEdge",value:function(e,t){var r,n;return null!==(n=null===(r=this.edges.get(e))||void 0===r?void 0:r.has(t))&&void 0!==n&&n}},{key:"topSortWithScc",value:function(){return this.getTopSortedWithSccSubgraphFrom(Array.from(this.nodes),function(e){return!0},function(e){})}},{key:"getTopSortedWithSccSubgraphFrom",value:function(e,t,r){var n=this,o=new Map,s=new Map,a=new Map,i=new Map,c=[],d=0;e.reverse().forEach(function(e){if(void 0===i.get(e)){d++;var t=[e];i.set(e,NodeVisitStatus.ON_STACK);for(var r=function(){var e=t[t.length-1];switch(i.get(e)){case NodeVisitStatus.ON_STACK:i.set(e,NodeVisitStatus.PROCESSED),o.set(e,d),s.set(e,d),n.adjacentNodes(e).forEach(function(r){switch(i.get(r)){case NodeVisitStatus.POPPED:break;case NodeVisitStatus.PROCESSED:s.set(e,Math.min(s.get(e),o.get(r)));break;case void 0:case NodeVisitStatus.ON_STACK:a.set(r,e),t.push(r),i.set(r,NodeVisitStatus.ON_STACK),d++}});break;case NodeVisitStatus.PROCESSED:var r=a.get(e);null!==r&&s.set(r,Math.min(s.get(r),s.get(e))),i.set(e,NodeVisitStatus.POPPED),c.push(e),t.pop();break;case NodeVisitStatus.POPPED:t.pop()}};t.length>0;)r()}});var u=new Map,l=new Set;c.reverse(),c.forEach(function(e){o.get(e)===s.get(e)?u.set(e,e):u.set(e,u.get(a.get(e)))}),this.edges.forEach(function(e,t){e.forEach(function(e){var r=u.get(e);r===u.get(t)&&l.add(r)})});var h=new Set(e),f=[],p=[];return c.forEach(function(e){l.has(u.get(e))?(p.push(e),r(e),n.adjacentNodes(e).forEach(function(e){return h.add(e)})):(f.push(e),h.has(e)&&t(e)&&n.adjacentNodes(e).forEach(function(e){return h.add(e)}))}),{sorted:f,cycled:p}}},{key:"getDependencies",value:function(e){var t=[];return this.edges.forEach(function(r,n){r.has(e)&&t.push(n)}),t}},{key:"destroy",value:function(){this.edges.clear(),this.nodes.clear(),this.specialNodes.clear(),this.specialNodesStructuralChanges.clear(),this.clearSpecialNodesRecentlyChanged()}},{key:"removeDependencies",value:function(e){var t=this.dependencyQuery(e);if(!t)return new Set;var r,n=_createForOfIteratorHelper(t);try{for(n.s();!(r=n.n()).done;){var o=r.value;this.softRemoveEdge(o,e)}}catch(e){n.e(e)}finally{n.f()}return t}}]),e}();
//# sourceMappingURL=/sm/78d7caea5bbdcff2f3c62cfd97e1fca37924857a39e4f2b26f2345547f8eb77b.map