/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/NamedExpressions.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.array.filter";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.map";import"core-js/modules/es.array.some";import"core-js/modules/es.map";import"core-js/modules/es.object.to-string";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.iterator";function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,s,t){return s&&_defineProperties(e.prototype,s),t&&_defineProperties(e,t),e}import{simpleCellAddress}from"./Cell";import{AstNodeType}from"./parser";export var InternalNamedExpression=function(){function e(s,t,r,o){_classCallCheck(this,e),this.displayName=s,this.address=t,this.added=r,this.options=o}return _createClass(e,[{key:"normalizeExpressionName",value:function(){return this.displayName.toLowerCase()}},{key:"copy",value:function(){return new e(this.displayName,this.address,this.added,this.options)}}]),e}();var WorkbookStore=function(){function e(){_classCallCheck(this,e),this.mapping=new Map}return _createClass(e,[{key:"has",value:function(e){return this.mapping.has(this.normalizeExpressionName(e))}},{key:"isNameAvailable",value:function(e){var s=this.normalizeExpressionName(e),t=this.mapping.get(s);return!(t&&t.added)}},{key:"add",value:function(e){this.mapping.set(e.normalizeExpressionName(),e)}},{key:"get",value:function(e){return this.mapping.get(this.normalizeExpressionName(e))}},{key:"getExisting",value:function(e){var s=this.mapping.get(this.normalizeExpressionName(e));return s&&s.added?s:void 0}},{key:"remove",value:function(e){var s=this.normalizeExpressionName(e),t=this.mapping.get(s);t&&(t.added=!1)}},{key:"getAllNamedExpressions",value:function(){return Array.from(this.mapping.values()).filter(function(e){return e.added})}},{key:"normalizeExpressionName",value:function(e){return e.toLowerCase()}}]),e}(),WorksheetStore=function(){function e(){_classCallCheck(this,e),this.mapping=new Map}return _createClass(e,[{key:"add",value:function(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}},{key:"get",value:function(e){return this.mapping.get(this.normalizeExpressionName(e))}},{key:"has",value:function(e){return this.mapping.has(this.normalizeExpressionName(e))}},{key:"normalizeExpressionName",value:function(e){return e.toLowerCase()}},{key:"isNameAvailable",value:function(e){var s=this.normalizeExpressionName(e);return!this.mapping.has(s)}},{key:"remove",value:function(e){var s=this.normalizeExpressionName(e);this.mapping.get(s)&&this.mapping.delete(s)}}]),e}();export var NamedExpressions=function(){function e(){_classCallCheck(this,e),this.nextNamedExpressionRow=0,this.workbookStore=new WorkbookStore,this.worksheetStores=new Map,this.addressCache=new Map}return _createClass(e,[{key:"isNameAvailable",value:function(e,s){return void 0===s?this.workbookStore.isNameAvailable(e):this.worksheetStore(s).isNameAvailable(e)}},{key:"namedExpressionInAddress",value:function(e){var s=this.addressCache.get(e);return s&&s.added?s:void 0}},{key:"namedExpressionForScope",value:function(e,s){return void 0===s?this.workbookStore.getExisting(e):this.worksheetStore(s).get(e)}},{key:"nearestNamedExpression",value:function(e,s){return this.worksheetStore(s).get(e)||this.workbookStore.getExisting(e)}},{key:"isExpressionInScope",value:function(e,s){return this.worksheetStore(s).has(e)}},{key:"isNameValid",value:function(e){return!/^[A-Za-z]+[0-9]+$/.test(e)&&/^[A-Za-z\u00C0-\u02AF_][A-Za-z0-9\u00C0-\u02AF\._]*$/.test(e)}},{key:"addNamedExpression",value:function(e,s,t){if(void 0===s){var r=this.workbookStore.get(e);return r?(r.added=!0,r.displayName=e,r.options=t):(r=new InternalNamedExpression(e,this.nextAddress(),!0,t),this.workbookStore.add(r)),this.addressCache.set(r.address.row,r),r}var o=this.worksheetStore(s),a=new InternalNamedExpression(e,this.nextAddress(),!0,t);return o.add(a),this.addressCache.set(a.address.row,a),a}},{key:"worksheetStore",value:function(e){var s=this.worksheetStores.get(e);return s||(s=new WorksheetStore,this.worksheetStores.set(e,s)),s}},{key:"namedExpressionOrPlaceholder",value:function(e,s){var t=this.worksheetStore(s).get(e);if(t)return t;var r=this.workbookStore.get(e);return void 0===r&&(r=new InternalNamedExpression(e,this.nextAddress(),!1),this.workbookStore.add(r)),r}},{key:"workbookNamedExpressionOrPlaceholder",value:function(e){var s=this.workbookStore.get(e);return void 0===s&&(s=new InternalNamedExpression(e,this.nextAddress(),!1),this.workbookStore.add(s)),s}},{key:"remove",value:function(e,s){var t,r=(t=void 0===s?this.workbookStore:this.worksheetStore(s)).get(e);if(void 0===r||!r.added)throw"Named expression does not exist";t.remove(e),this.addressCache.delete(r.address.row)}},{key:"getAllNamedExpressionsNames",value:function(){return this.workbookStore.getAllNamedExpressions().map(function(e){return e.displayName})}},{key:"nextAddress",value:function(){return simpleCellAddress(e.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}},{key:"lookupNextAddress",value:function(s,t){if(void 0===t){var r=this.workbookStore.get(s);if(r)return r.address}return simpleCellAddress(e.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow)}}]),e}();NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;export var doesContainRelativeReferences=function e(s){switch(s.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:case AstNodeType.ERROR_WITH_RAW_INPUT:return!1;case AstNodeType.CELL_REFERENCE:return!s.reference.isAbsolute();case AstNodeType.CELL_RANGE:case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:return!s.start.isAbsolute();case AstNodeType.NAMED_EXPRESSION:return!1;case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:return e(s.value);case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:return e(s.left)||e(s.right);case AstNodeType.PARENTHESIS:return e(s.expression);case AstNodeType.FUNCTION_CALL:return s.args.some(function(s){return e(s)})}};
//# sourceMappingURL=/sm/48edb54d4abc2b25ef686899db4cd9ce86c28981667102091522176a28387dd7.map