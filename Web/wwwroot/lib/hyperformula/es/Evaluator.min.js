/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/es/Evaluator.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.iterator";import"core-js/modules/es.array.for-each";import"core-js/modules/es.array.from";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.slice";import"core-js/modules/es.function.name";import"core-js/modules/es.object.to-string";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.for-each";import"core-js/modules/web.dom-collections.iterator";function _createForOfIteratorHelper(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==t.return||t.return()}finally{if(l)throw o}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}import{AbsoluteCellRange}from"./AbsoluteCellRange";import{absolutizeDependencies}from"./absolutizeDependencies";import{CellError,ErrorType}from"./Cell";import{ContentChanges}from"./ContentChanges";import{FormulaCellVertex,MatrixVertex,RangeVertex}from"./DependencyGraph";import{fixNegativeZero,isNumberOverflow}from"./interpreter/ArithmeticHelper";import{Interpreter}from"./interpreter/Interpreter";import{SimpleRangeValue}from"./interpreter/InterpreterValue";import{Matrix}from"./Matrix";import{StatType}from"./statistics";export var Evaluator=function(){function e(r,t,a,n,o,i,l,s){_classCallCheck(this,e),this.dependencyGraph=r,this.columnSearch=t,this.config=a,this.stats=n,this.dateHelper=o,this.numberLiteralsHelper=i,this.functionRegistry=l,this.namedExpressions=s,this.interpreter=new Interpreter(this.dependencyGraph,this.columnSearch,this.config,this.stats,this.dateHelper,this.numberLiteralsHelper,this.functionRegistry,this.namedExpressions)}return _createClass(e,[{key:"run",value:function(){var e=this;this.stats.start(StatType.TOP_SORT);var r=this.dependencyGraph.topSortWithScc(),t=r.sorted,a=r.cycled;this.stats.end(StatType.TOP_SORT),this.stats.measure(StatType.EVALUATION,function(){e.recomputeFormulas(a,t)})}},{key:"partialRun",value:function(e){var r=this,t=new ContentChanges;return this.stats.measure(StatType.EVALUATION,function(){r.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,function(e){if(e instanceof FormulaCellVertex){var a=e.getAddress(r.dependencyGraph.lazilyTransformingAstService),n=e.getFormula(r.dependencyGraph.lazilyTransformingAstService),o=e.isComputed()?e.getCellValue():null,i=r.evaluateAstToCellValue(n,a);return e.setCellValue(i),i!==o&&(t.addChange(i,a),r.columnSearch.change(o,i,a),!0)}if(e instanceof MatrixVertex&&e.isFormula()){var l=e.getAddress(),s=e.getFormula(),u=e.isComputed()?e.getCellValue():null,c=r.evaluateAstToRangeValue(s,l);if(c instanceof SimpleRangeValue){var p=new Matrix(c.rawNumbers());e.setCellValue(p),t.addMatrixChange(p,l),r.columnSearch.change(u,p,l)}else e.setErrorValue(c),t.addChange(c,l),r.columnSearch.change(u,c,l);return!0}return!(e instanceof RangeVertex)||(e.clearCache(),!0)},function(e){if(e instanceof RangeVertex)e.clearCache();else if(e instanceof FormulaCellVertex){var r=new CellError(ErrorType.CYCLE);e.setCellValue(r),t.addChange(r,e.address)}})}),t}},{key:"destroy",value:function(){this.interpreter.destroy()}},{key:"runAndForget",value:function(e,r,t){var a,n=this,o=[],i=_createForOfIteratorHelper(absolutizeDependencies(t,r));try{for(i.s();!(a=i.n()).done;){var l=a.value;if(l instanceof AbsoluteCellRange){var s=l;if(void 0===this.dependencyGraph.getRange(s.start,s.end)){var u=new RangeVertex(s);this.dependencyGraph.rangeMapping.setRange(u),o.push(u)}}}}catch(e){i.e(e)}finally{i.f()}var c=this.evaluateAstToCellValue(e,r);return o.forEach(function(e){n.dependencyGraph.rangeMapping.removeRange(e)}),c}},{key:"recomputeFormulas",value:function(e,r){var t=this;e.forEach(function(e){e instanceof FormulaCellVertex&&e.setCellValue(new CellError(ErrorType.CYCLE))}),r.forEach(function(e){if(e instanceof FormulaCellVertex){var r=e.getAddress(t.dependencyGraph.lazilyTransformingAstService),a=e.getFormula(t.dependencyGraph.lazilyTransformingAstService),n=t.evaluateAstToCellValue(a,r);e.setCellValue(n),t.columnSearch.add(n,r)}else if(e instanceof MatrixVertex&&e.isFormula()){var o=e.getAddress(),i=e.getFormula(),l=t.evaluateAstToRangeValue(i,o);if(l instanceof SimpleRangeValue){var s=new Matrix(l.rawNumbers());e.setCellValue(s),t.columnSearch.add(s,o)}else e.setErrorValue(l),t.columnSearch.add(l,o)}else e instanceof RangeVertex&&e.clearCache()})}},{key:"evaluateAstToCellValue",value:function(e,r){var t=this.interpreter.evaluateAst(e,r);return t instanceof SimpleRangeValue?t:"number"==typeof t?isNumberOverflow(t)?new CellError(ErrorType.NUM):fixNegativeZero(t):t}},{key:"evaluateAstToRangeValue",value:function(e,r){var t=this.interpreter.evaluateAst(e,r);return t instanceof CellError?t:t instanceof SimpleRangeValue&&t.hasOnlyNumbers()?t:new CellError(ErrorType.VALUE)}}]),e}();
//# sourceMappingURL=/sm/99dd6f603f84ce1a4b8557e23f4e8e4db087f491b0ee3ab90999b3b20d0bc439.map