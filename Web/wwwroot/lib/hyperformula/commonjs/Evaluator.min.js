/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/commonjs/Evaluator.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";require("core-js/modules/es.symbol"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.symbol.iterator"),require("core-js/modules/es.array.for-each"),require("core-js/modules/es.array.from"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.array.slice"),require("core-js/modules/es.function.name"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/es.string.iterator"),require("core-js/modules/web.dom-collections.for-each"),require("core-js/modules/web.dom-collections.iterator"),exports.__esModule=!0,exports.Evaluator=void 0;var _AbsoluteCellRange=require("./AbsoluteCellRange"),_absolutizeDependencies=require("./absolutizeDependencies"),_Cell=require("./Cell"),_ContentChanges=require("./ContentChanges"),_DependencyGraph=require("./DependencyGraph"),_ArithmeticHelper=require("./interpreter/ArithmeticHelper"),_Interpreter=require("./interpreter/Interpreter"),_InterpreterValue=require("./interpreter/InterpreterValue"),_Matrix=require("./Matrix"),_statistics=require("./statistics");function _createForOfIteratorHelper(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,s=!0,i=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return s=e.done,e},e:function(e){i=!0,l=e},f:function(){try{s||null==t.return||t.return()}finally{if(i)throw l}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var Evaluator=function(){function e(r,t,a,n,l,s,i,o){_classCallCheck(this,e),this.dependencyGraph=r,this.columnSearch=t,this.config=a,this.stats=n,this.dateHelper=l,this.numberLiteralsHelper=s,this.functionRegistry=i,this.namedExpressions=o,this.interpreter=new _Interpreter.Interpreter(this.dependencyGraph,this.columnSearch,this.config,this.stats,this.dateHelper,this.numberLiteralsHelper,this.functionRegistry,this.namedExpressions)}return _createClass(e,[{key:"run",value:function(){var e=this;this.stats.start(_statistics.StatType.TOP_SORT);var r=this.dependencyGraph.topSortWithScc(),t=r.sorted,a=r.cycled;this.stats.end(_statistics.StatType.TOP_SORT),this.stats.measure(_statistics.StatType.EVALUATION,function(){e.recomputeFormulas(a,t)})}},{key:"partialRun",value:function(e){var r=this,t=new _ContentChanges.ContentChanges;return this.stats.measure(_statistics.StatType.EVALUATION,function(){r.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,function(e){if(e instanceof _DependencyGraph.FormulaCellVertex){var a=e.getAddress(r.dependencyGraph.lazilyTransformingAstService),n=e.getFormula(r.dependencyGraph.lazilyTransformingAstService),l=e.isComputed()?e.getCellValue():null,s=r.evaluateAstToCellValue(n,a);return e.setCellValue(s),s!==l&&(t.addChange(s,a),r.columnSearch.change(l,s,a),!0)}if(e instanceof _DependencyGraph.MatrixVertex&&e.isFormula()){var i=e.getAddress(),o=e.getFormula(),u=e.isComputed()?e.getCellValue():null,c=r.evaluateAstToRangeValue(o,i);if(c instanceof _InterpreterValue.SimpleRangeValue){var p=new _Matrix.Matrix(c.rawNumbers());e.setCellValue(p),t.addMatrixChange(p,i),r.columnSearch.change(u,p,i)}else e.setErrorValue(c),t.addChange(c,i),r.columnSearch.change(u,c,i);return!0}return!(e instanceof _DependencyGraph.RangeVertex)||(e.clearCache(),!0)},function(e){if(e instanceof _DependencyGraph.RangeVertex)e.clearCache();else if(e instanceof _DependencyGraph.FormulaCellVertex){var r=new _Cell.CellError(_Cell.ErrorType.CYCLE);e.setCellValue(r),t.addChange(r,e.address)}})}),t}},{key:"destroy",value:function(){this.interpreter.destroy()}},{key:"runAndForget",value:function(e,r,t){var a,n=this,l=[],s=_createForOfIteratorHelper((0,_absolutizeDependencies.absolutizeDependencies)(t,r));try{for(s.s();!(a=s.n()).done;){var i=a.value;if(i instanceof _AbsoluteCellRange.AbsoluteCellRange){var o=i;if(void 0===this.dependencyGraph.getRange(o.start,o.end)){var u=new _DependencyGraph.RangeVertex(o);this.dependencyGraph.rangeMapping.setRange(u),l.push(u)}}}}catch(e){s.e(e)}finally{s.f()}var c=this.evaluateAstToCellValue(e,r);return l.forEach(function(e){n.dependencyGraph.rangeMapping.removeRange(e)}),c}},{key:"recomputeFormulas",value:function(e,r){var t=this;e.forEach(function(e){e instanceof _DependencyGraph.FormulaCellVertex&&e.setCellValue(new _Cell.CellError(_Cell.ErrorType.CYCLE))}),r.forEach(function(e){if(e instanceof _DependencyGraph.FormulaCellVertex){var r=e.getAddress(t.dependencyGraph.lazilyTransformingAstService),a=e.getFormula(t.dependencyGraph.lazilyTransformingAstService),n=t.evaluateAstToCellValue(a,r);e.setCellValue(n),t.columnSearch.add(n,r)}else if(e instanceof _DependencyGraph.MatrixVertex&&e.isFormula()){var l=e.getAddress(),s=e.getFormula(),i=t.evaluateAstToRangeValue(s,l);if(i instanceof _InterpreterValue.SimpleRangeValue){var o=new _Matrix.Matrix(i.rawNumbers());e.setCellValue(o),t.columnSearch.add(o,l)}else e.setErrorValue(i),t.columnSearch.add(i,l)}else e instanceof _DependencyGraph.RangeVertex&&e.clearCache()})}},{key:"evaluateAstToCellValue",value:function(e,r){var t=this.interpreter.evaluateAst(e,r);return t instanceof _InterpreterValue.SimpleRangeValue?t:"number"==typeof t?(0,_ArithmeticHelper.isNumberOverflow)(t)?new _Cell.CellError(_Cell.ErrorType.NUM):(0,_ArithmeticHelper.fixNegativeZero)(t):t}},{key:"evaluateAstToRangeValue",value:function(e,r){var t=this.interpreter.evaluateAst(e,r);return t instanceof _Cell.CellError?t:t instanceof _InterpreterValue.SimpleRangeValue&&t.hasOnlyNumbers()?t:new _Cell.CellError(_Cell.ErrorType.VALUE)}}]),e}();exports.Evaluator=Evaluator;
//# sourceMappingURL=/sm/a53e10c73f602e6b12ea8f743e21d64138ae1dd8fa511c9d172f6eebfd63955e.map