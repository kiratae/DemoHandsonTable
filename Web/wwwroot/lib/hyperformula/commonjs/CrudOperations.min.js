/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/commonjs/CrudOperations.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";require("core-js/modules/es.symbol"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.symbol.iterator"),require("core-js/modules/es.array.concat"),require("core-js/modules/es.array.from"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.array.map"),require("core-js/modules/es.array.reduce"),require("core-js/modules/es.array.slice"),require("core-js/modules/es.function.name"),require("core-js/modules/es.number.constructor"),require("core-js/modules/es.number.is-integer"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/es.string.iterator"),require("core-js/modules/web.dom-collections.iterator"),exports.__esModule=!0,exports.CrudOperations=void 0;var _AbsoluteCellRange=require("./AbsoluteCellRange"),_Cell=require("./Cell"),_CellContentParser=require("./CellContentParser"),_ClipboardOperations=require("./ClipboardOperations"),_Operations=require("./Operations"),_NamedExpressions=require("./NamedExpressions"),_errors=require("./errors"),_Span=require("./Span"),_UndoRedo=require("./UndoRedo"),_Sheet=require("./Sheet");function _createForOfIteratorHelper(e,r){var o;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){o&&(e=o);var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw s}}}}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var o=0,t=new Array(r);o<r;o++)t[o]=e[o];return t}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var o=[],t=!0,n=!1,s=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done)&&(o.push(i.value),!r||o.length!==r);t=!0);}catch(e){n=!0,s=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw s}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var o=0;o<r.length;o++){var t=r[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,r,o){return r&&_defineProperties(e.prototype,r),o&&_defineProperties(e,o),e}var CrudOperations=function(){function e(r,o,t,n,s,i,a,d){_classCallCheck(this,e),this.config=r,this.stats=o,this.dependencyGraph=t,this.columnSearch=n,this.parser=s,this.cellContentParser=i,this.lazilyTransformingAstService=a,this.namedExpressions=d,this.operations=new _Operations.Operations(this.dependencyGraph,this.columnSearch,this.cellContentParser,this.parser,this.stats,this.lazilyTransformingAstService,this.namedExpressions,this.config),this.clipboardOperations=new _ClipboardOperations.ClipboardOperations(this.dependencyGraph,this.operations,this.parser,this.lazilyTransformingAstService,this.config),this.undoRedo=new _UndoRedo.UndoRedo(this.config,this.operations)}return _createClass(e,[{key:"addRows",value:function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),t=1;t<r;t++)o[t-1]=arguments[t];var n=new _Operations.AddRowsCommand(e,o);this.ensureItIsPossibleToAddRows.apply(this,[e].concat(o)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(n),this.undoRedo.saveOperation(new _UndoRedo.AddRowsUndoEntry(n))}},{key:"removeRows",value:function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),t=1;t<r;t++)o[t-1]=arguments[t];var n=new _Operations.RemoveRowsCommand(e,o);this.ensureItIsPossibleToRemoveRows.apply(this,[e].concat(o)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var s=this.operations.removeRows(n);this.undoRedo.saveOperation(new _UndoRedo.RemoveRowsUndoEntry(n,s))}},{key:"addColumns",value:function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),t=1;t<r;t++)o[t-1]=arguments[t];var n=new _Operations.AddColumnsCommand(e,o);this.ensureItIsPossibleToAddColumns.apply(this,[e].concat(o)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(n),this.undoRedo.saveOperation(new _UndoRedo.AddColumnsUndoEntry(n))}},{key:"removeColumns",value:function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),t=1;t<r;t++)o[t-1]=arguments[t];var n=new _Operations.RemoveColumnsCommand(e,o);this.ensureItIsPossibleToRemoveColumns.apply(this,[e].concat(o)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var s=this.operations.removeColumns(n);this.undoRedo.saveOperation(new _UndoRedo.RemoveColumnsUndoEntry(n,s))}},{key:"moveCells",value:function(e,r,o,t){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var n=this.operations.moveCells(e,r,o,t),s=n.version,i=n.overwrittenCellsData,a=n.addedGlobalNamedExpressions;this.undoRedo.saveOperation(new _UndoRedo.MoveCellsUndoEntry(e,r,o,t,i,a,s))}},{key:"moveRows",value:function(e,r,o,t){this.ensureItIsPossibleToMoveRows(e,r,o,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.moveRows(e,r,o,t),this.undoRedo.saveOperation(new _UndoRedo.MoveRowsUndoEntry(e,r,o,t))}},{key:"moveColumns",value:function(e,r,o,t){this.ensureItIsPossibleToMoveColumns(e,r,o,t),this.undoRedo.clearRedoStack(),this.operations.moveColumns(e,r,o,t),this.undoRedo.saveOperation(new _UndoRedo.MoveColumnsUndoEntry(e,r,o,t))}},{key:"cut",value:function(e,r,o){this.clipboardOperations.cut(e,r,o)}},{key:"ensureItIsPossibleToCopy",value:function(e,r,o){if(!isPositiveInteger(r))throw new _errors.InvalidArgumentsError("width to be positive integer.");if(!isPositiveInteger(o))throw new _errors.InvalidArgumentsError("height to be positive integer.")}},{key:"copy",value:function(e,r,o){this.ensureItIsPossibleToCopy(e,r,o),this.clipboardOperations.copy(e,r,o)}},{key:"paste",value:function(e){var r=this.clipboardOperations.clipboard;if(void 0===r)throw new _errors.NothingToPasteError;if(this.clipboardOperations.isCutClipboard())this.moveCells(r.sourceLeftCorner,r.width,r.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);var o=_AbsoluteCellRange.AbsoluteCellRange.spanFrom(e,r.width,r.height),t=this.operations.getRangeClipboardCells(o);this.undoRedo.clearRedoStack(),this.dependencyGraph.breakNumericMatricesInRange(o);var n=this.operations.restoreClipboardCells(r.sourceLeftCorner.sheet,r.getContent(e));this.undoRedo.saveOperation(new _UndoRedo.PasteUndoEntry(e,t,r.content,n))}}},{key:"beginUndoRedoBatchMode",value:function(){this.undoRedo.beginBatchMode()}},{key:"commitUndoRedoBatchMode",value:function(){this.undoRedo.commitBatchMode()}},{key:"isClipboardEmpty",value:function(){return void 0===this.clipboardOperations.clipboard}},{key:"clearClipboard",value:function(){this.clipboardOperations.clear()}},{key:"addSheet",value:function(e){e&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();var r=this.operations.addSheet(e);return this.undoRedo.saveOperation(new _UndoRedo.AddSheetUndoEntry(r)),r}},{key:"removeSheet",value:function(e){this.ensureSheetExists(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var r=this.sheetMapping.fetch(e),o=this.sheetMapping.fetchDisplayName(r),t=this.operations.getSheetClipboardCells(r),n=this.operations.removeSheet(e);this.undoRedo.saveOperation(new _UndoRedo.RemoveSheetUndoEntry(o,r,t,n))}},{key:"renameSheet",value:function(e,r){this.ensureItIsPossibleToRenameSheet(e,r);var o=this.operations.renameSheet(e,r);return void 0!==o&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new _UndoRedo.RenameSheetUndoEntry(e,o,r))),o}},{key:"clearSheet",value:function(e){this.ensureSheetExists(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var r=this.sheetMapping.fetch(e),o=this.operations.getSheetClipboardCells(r);this.operations.clearSheet(r),this.undoRedo.saveOperation(new _UndoRedo.ClearSheetUndoEntry(r,o))}},{key:"setCellContents",value:function(e,r){if(r instanceof Array)for(var o=0;o<r.length;o++){if(!(r[o]instanceof Array))throw new _errors.InvalidArgumentsError("an array of arrays or a raw cell value.");for(var t=0;t<r[o].length;t++)if((0,_CellContentParser.isMatrix)(r[o][t]))throw new Error("Cant change matrices in batch operation")}else r=[[r]];this.ensureItIsPossibleToChangeCellContents(e,r),this.undoRedo.clearRedoStack();for(var n=[],s=0;s<r.length;s++)for(var i=0;i<r[s].length;i++){var a={sheet:e.sheet,row:e.row+s,col:e.col+i};this.clipboardOperations.abortCut();var d=this.operations.getClipboardCell(a);this.operations.setCellContent(a,r[s][i]),n.push({address:a,newContent:r[s][i],oldContent:d})}this.undoRedo.saveOperation(new _UndoRedo.SetCellContentsUndoEntry(n))}},{key:"setSheetContent",value:function(e,r){this.ensureSheetExists(e);var o=this.sheetMapping.fetch(e);this.ensureItIsPossibleToChangeSheetContents(o,r),(0,_Sheet.validateAsSheet)(r),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var t=this.operations.getSheetClipboardCells(o);this.operations.setSheetContent(o,r),this.undoRedo.saveOperation(new _UndoRedo.SetSheetContentUndoEntry(o,t,r))}},{key:"undo",value:function(){if(this.undoRedo.isUndoStackEmpty())throw new _errors.NoOperationToUndoError;this.clipboardOperations.abortCut(),this.undoRedo.undo()}},{key:"redo",value:function(){if(this.undoRedo.isRedoStackEmpty())throw new _errors.NoOperationToRedoError;this.clipboardOperations.abortCut(),this.undoRedo.redo()}},{key:"addNamedExpression",value:function(e,r,o,t){var n=this.scopeId(o);this.ensureNamedExpressionNameIsValid(e,n),this.operations.addNamedExpression(e,r,n,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new _UndoRedo.AddNamedExpressionUndoEntry(e,r,n,t))}},{key:"changeNamedExpressionExpression",value:function(e,r,o,t){var n=this.scopeId(r),s=_slicedToArray(this.operations.changeNamedExpressionExpression(e,o,n,t),2),i=s[0],a=s[1];this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new _UndoRedo.ChangeNamedExpressionUndoEntry(i,o,a,n,t))}},{key:"removeNamedExpression",value:function(e,r){var o=this.scopeId(r),t=_slicedToArray(this.operations.removeNamedExpression(e,o),2),n=t[0],s=t[1];return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new _UndoRedo.RemoveNamedExpressionUndoEntry(n,s,o)),n}},{key:"ensureItIsPossibleToAddNamedExpression",value:function(e,r,o){var t=this.scopeId(o);this.ensureNamedExpressionNameIsValid(e,t),this.ensureNamedExpressionIsValid(r)}},{key:"ensureItIsPossibleToChangeNamedExpression",value:function(e,r,o){var t=this.scopeId(o);if(void 0===this.namedExpressions.namedExpressionForScope(e,t))throw new _errors.NamedExpressionDoesNotExistError(e);this.ensureNamedExpressionIsValid(r)}},{key:"isItPossibleToRemoveNamedExpression",value:function(e,r){var o=this.scopeId(r);if(void 0===this.namedExpressions.namedExpressionForScope(e,o))throw new _errors.NamedExpressionDoesNotExistError(e)}},{key:"ensureItIsPossibleToAddRows",value:function(e){if(!this.sheetMapping.hasSheetWithId(e))throw new _errors.NoSheetWithIdError(e);for(var r=this.dependencyGraph.getSheetHeight(e),o=arguments.length,t=new Array(o>1?o-1:0),n=1;n<o;n++)t[n-1]=arguments[n];if(r+t.map(function(e){return e[1]}).reduce(function(e,r){return e+r},0)>this.config.maxRows)throw new _errors.SheetSizeLimitExceededError;for(var s=0,i=t;s<i.length;s++){var a=_slicedToArray(i[s],2),d=a[0],l=a[1];if(!isNonnegativeInteger(d)||!isPositiveInteger(l))throw new _errors.InvalidArgumentsError("row number to be nonnegative and number of rows to add to be positive.");if(isPositiveInteger(d)&&this.dependencyGraph.matrixMapping.isFormulaMatrixInRow(e,d-1)&&this.dependencyGraph.matrixMapping.isFormulaMatrixInRow(e,d))throw new _errors.TargetLocationHasMatrixError}}},{key:"ensureItIsPossibleToRemoveRows",value:function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),t=1;t<r;t++)o[t-1]=arguments[t];for(var n=0,s=o;n<s.length;n++){var i=_slicedToArray(s[n],2),a=i[0],d=a+i[1]-1;if(!isNonnegativeInteger(a)||!isNonnegativeInteger(d))throw new _errors.InvalidArgumentsError("starting and ending row to be nonnegative.");if(d<a)throw new _errors.InvalidArgumentsError("starting row to be smaller than the ending row.");var l=_Span.RowsSpan.fromRowStartAndEnd(e,a,d);if(!this.sheetMapping.hasSheetWithId(e))throw new _errors.NoSheetWithIdError(e);if(this.dependencyGraph.matrixMapping.isFormulaMatrixInRows(l))throw new _errors.SourceLocationHasMatrixError}}},{key:"ensureItIsPossibleToAddColumns",value:function(e){if(!this.sheetMapping.hasSheetWithId(e))throw new _errors.NoSheetWithIdError(e);for(var r=this.dependencyGraph.getSheetWidth(e),o=arguments.length,t=new Array(o>1?o-1:0),n=1;n<o;n++)t[n-1]=arguments[n];if(r+t.map(function(e){return e[1]}).reduce(function(e,r){return e+r},0)>this.config.maxColumns)throw new _errors.SheetSizeLimitExceededError;for(var s=0,i=t;s<i.length;s++){var a=_slicedToArray(i[s],2),d=a[0],l=a[1];if(!isNonnegativeInteger(d)||!isPositiveInteger(l))throw new _errors.InvalidArgumentsError("column number to be nonnegative and number of columns to add to be positive.");if(isPositiveInteger(d)&&this.dependencyGraph.matrixMapping.isFormulaMatrixInColumn(e,d-1)&&this.dependencyGraph.matrixMapping.isFormulaMatrixInColumn(e,d))throw new _errors.TargetLocationHasMatrixError}}},{key:"ensureItIsPossibleToRemoveColumns",value:function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),t=1;t<r;t++)o[t-1]=arguments[t];for(var n=0,s=o;n<s.length;n++){var i=_slicedToArray(s[n],2),a=i[0],d=a+i[1]-1;if(!isNonnegativeInteger(a)||!isNonnegativeInteger(d))throw new _errors.InvalidArgumentsError("starting and ending column to be nonnegative.");if(d<a)throw new _errors.InvalidArgumentsError("starting column to be smaller than the ending column.");var l=_Span.ColumnsSpan.fromColumnStartAndEnd(e,a,d);if(!this.sheetMapping.hasSheetWithId(e))throw new _errors.NoSheetWithIdError(e);if(this.dependencyGraph.matrixMapping.isFormulaMatrixInColumns(l))throw new _errors.SourceLocationHasMatrixError}}},{key:"ensureItIsPossibleToMoveRows",value:function(e,r,o,t){this.ensureItIsPossibleToAddRows(e,[t,o]);var n=(0,_Cell.simpleCellAddress)(e,0,r),s=(0,_Cell.simpleCellAddress)(e,0,t);if(!this.sheetMapping.hasSheetWithId(e)||(0,_Cell.invalidSimpleCellAddress)(n)||(0,_Cell.invalidSimpleCellAddress)(s)||!isPositiveInteger(o)||t<=r+o&&t>=r)throw new _errors.InvalidArgumentsError("a valid range of rows to move.");var i=this.dependencyGraph.getSheetWidth(e),a=_AbsoluteCellRange.AbsoluteCellRange.spanFrom(n,i,o);if(this.dependencyGraph.matrixMapping.isFormulaMatrixInRange(a))throw new _errors.SourceLocationHasMatrixError}},{key:"ensureItIsPossibleToMoveColumns",value:function(e,r,o,t){this.ensureItIsPossibleToAddColumns(e,[t,o]);var n=(0,_Cell.simpleCellAddress)(e,r,0),s=(0,_Cell.simpleCellAddress)(e,t,0);if(!this.sheetMapping.hasSheetWithId(e)||(0,_Cell.invalidSimpleCellAddress)(n)||(0,_Cell.invalidSimpleCellAddress)(s)||!isPositiveInteger(o)||t<=r+o&&t>=r)throw new _errors.InvalidArgumentsError("a valid range of columns to move.");var i=this.dependencyGraph.getSheetHeight(e),a=_AbsoluteCellRange.AbsoluteCellRange.spanFrom(n,o,i);if(this.dependencyGraph.matrixMapping.isFormulaMatrixInRange(a))throw new _errors.SourceLocationHasMatrixError}},{key:"ensureItIsPossibleToAddSheet",value:function(e){if(this.sheetMapping.hasSheetWithName(e))throw new _errors.SheetNameAlreadyTakenError(e)}},{key:"ensureItIsPossibleToRenameSheet",value:function(e,r){if(!this.sheetMapping.hasSheetWithId(e))throw new _errors.NoSheetWithIdError(e);var o=this.sheetMapping.get(r);if(void 0!==o&&o!==e)throw new _errors.SheetNameAlreadyTakenError(r)}},{key:"ensureItIsPossibleToChangeContent",value:function(e){if((0,_Cell.invalidSimpleCellAddress)(e))throw new _errors.InvalidAddressError(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new _errors.NoSheetWithIdError(e.sheet);if(this.dependencyGraph.matrixMapping.isFormulaMatrixAtAddress(e))throw new _errors.SourceLocationHasMatrixError}},{key:"ensureItIsPossibleToChangeCellContents",value:function(e,r){var o=(0,_Sheet.findBoundaries)(r),t=_AbsoluteCellRange.AbsoluteCellRange.spanFrom(e,o.width,o.height);this.ensureRangeInSizeLimits(t);var n,s=_createForOfIteratorHelper(t.addresses(this.dependencyGraph));try{for(s.s();!(n=s.n()).done;){var i=n.value;this.ensureItIsPossibleToChangeContent(i)}}catch(e){s.e(e)}finally{s.f()}}},{key:"ensureItIsPossibleToChangeSheetContents",value:function(e,r){var o=(0,_Sheet.findBoundaries)(r),t=_AbsoluteCellRange.AbsoluteCellRange.spanFrom((0,_Cell.simpleCellAddress)(e,0,0),o.width,o.height);this.ensureRangeInSizeLimits(t)}},{key:"ensureRangeInSizeLimits",value:function(e){if(e.exceedsSheetSizeLimits(this.config.maxColumns,this.config.maxRows))throw new _errors.SheetSizeLimitExceededError}},{key:"isThereSomethingToUndo",value:function(){return!this.undoRedo.isUndoStackEmpty()}},{key:"isThereSomethingToRedo",value:function(){return!this.undoRedo.isRedoStackEmpty()}},{key:"getAndClearContentChanges",value:function(){return this.operations.getAndClearContentChanges()}},{key:"ensureSheetExists",value:function(e){if(!this.sheetMapping.hasSheetWithName(e))throw new _errors.NoSheetWithNameError(e)}},{key:"scopeId",value:function(e){if(void 0!==e)return this.ensureSheetExists(e),this.sheetMapping.fetch(e)}},{key:"ensureNamedExpressionNameIsValid",value:function(e,r){if(!this.namedExpressions.isNameValid(e))throw new _errors.NamedExpressionNameIsInvalidError(e);if(!this.namedExpressions.isNameAvailable(e,r))throw new _errors.NamedExpressionNameIsAlreadyTakenError(e)}},{key:"ensureNamedExpressionIsValid",value:function(e){var r=this.cellContentParser.parse(e);if(r instanceof _CellContentParser.CellContent.MatrixFormula)throw new _errors.MatrixFormulasNotSupportedError;if(r instanceof _CellContentParser.CellContent.Formula){var o=this.parser.parse(r.formula,(0,_Cell.simpleCellAddress)(-1,0,0));if((0,_NamedExpressions.doesContainRelativeReferences)(o.ast))throw new _errors.NoRelativeAddressesAllowedError}}},{key:"sheetMapping",get:function(){return this.dependencyGraph.sheetMapping}}]),e}();function isPositiveInteger(e){return Number.isInteger(e)&&e>0}function isNonnegativeInteger(e){return Number.isInteger(e)&&e>=0}exports.CrudOperations=CrudOperations;
//# sourceMappingURL=/sm/a030d47a0a89296c8585ceb7bc7fcb98d65468e4f67d452685db26839b00b801.map