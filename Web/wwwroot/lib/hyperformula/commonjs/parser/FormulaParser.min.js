/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/commonjs/parser/FormulaParser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";require("core-js/modules/es.symbol"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.symbol.iterator"),require("core-js/modules/es.array.concat"),require("core-js/modules/es.array.from"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.array.map"),require("core-js/modules/es.array.slice"),require("core-js/modules/es.function.name"),require("core-js/modules/es.number.constructor"),require("core-js/modules/es.number.is-integer"),require("core-js/modules/es.object.get-own-property-descriptor"),require("core-js/modules/es.object.get-prototype-of"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.reflect.construct"),require("core-js/modules/es.reflect.get"),require("core-js/modules/es.regexp.exec"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/es.string.iterator"),require("core-js/modules/es.string.replace"),require("core-js/modules/es.string.split"),require("core-js/modules/web.dom-collections.iterator"),exports.__esModule=!0,exports.FormulaLexer=exports.FormulaParser=void 0;var _chevrotain=require("chevrotain"),_Cell=require("../Cell"),_addressRepresentationConverters=require("./addressRepresentationConverters"),_Ast=require("./Ast"),_CellAddress=require("./CellAddress"),_LexerConfig=require("./LexerConfig");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,o=!1,s=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(e){o=!0,s=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw s}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}function _get(e,r,t){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,r,t){var n=_superPropBase(e,r);if(n){var o=Object.getOwnPropertyDescriptor(n,r);return o.get?o.get.call(t):o.value}})(e,r,t||e)}function _superPropBase(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&_setPrototypeOf(e,r)}function _setPrototypeOf(e,r){return(_setPrototypeOf=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function _createSuper(e){var r=_isNativeReflectConstruct();return function(){var t,n=_getPrototypeOf(e);if(r){var o=_getPrototypeOf(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(e,r){return!r||"object"!==_typeof(r)&&"function"!=typeof r?_assertThisInitialized(e):r}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var FormulaParser=function(e){_inherits(t,_chevrotain.EmbeddedActionsParser);var r=_createSuper(t);function t(e,n){var o;return _classCallCheck(this,t),(o=r.call(this,e.allTokens,{outputCst:!1,maxLookahead:7})).formula=o.RULE("formula",function(){return o.CONSUME(_LexerConfig.EqualsOp),o.SUBRULE(o.booleanExpression)}),o.booleanExpression=o.RULE("booleanExpression",function(){var e=o.SUBRULE(o.concatenateExpression);return o.MANY(function(){var r=o.CONSUME(_LexerConfig.BooleanOp),t=o.SUBRULE2(o.concatenateExpression);(0,_chevrotain.tokenMatcher)(r,_LexerConfig.EqualsOp)?e=(0,_Ast.buildEqualsOpAst)(e,t,r.leadingWhitespace):(0,_chevrotain.tokenMatcher)(r,_LexerConfig.NotEqualOp)?e=(0,_Ast.buildNotEqualOpAst)(e,t,r.leadingWhitespace):(0,_chevrotain.tokenMatcher)(r,_LexerConfig.GreaterThanOp)?e=(0,_Ast.buildGreaterThanOpAst)(e,t,r.leadingWhitespace):(0,_chevrotain.tokenMatcher)(r,_LexerConfig.LessThanOp)?e=(0,_Ast.buildLessThanOpAst)(e,t,r.leadingWhitespace):(0,_chevrotain.tokenMatcher)(r,_LexerConfig.GreaterThanOrEqualOp)?e=(0,_Ast.buildGreaterThanOrEqualOpAst)(e,t,r.leadingWhitespace):(0,_chevrotain.tokenMatcher)(r,_LexerConfig.LessThanOrEqualOp)?e=(0,_Ast.buildLessThanOrEqualOpAst)(e,t,r.leadingWhitespace):o.ACTION(function(){throw Error("Operator not supported")})}),e}),o.booleanExpressionOrEmpty=o.RULE("booleanExpressionOrEmpty",function(){return o.OR([{ALT:function(){return o.SUBRULE(o.booleanExpression)}},{ALT:(0,_chevrotain.EMPTY_ALT)((0,_Ast.buildEmptyArgAst)())}])}),o.concatenateExpression=o.RULE("concatenateExpression",function(){var e=o.SUBRULE(o.additionExpression);return o.MANY(function(){var r=o.CONSUME(_LexerConfig.ConcatenateOp),t=o.SUBRULE2(o.additionExpression);e=(0,_Ast.buildConcatenateOpAst)(e,t,r.leadingWhitespace)}),e}),o.additionExpression=o.RULE("additionExpression",function(){var e=o.SUBRULE(o.multiplicationExpression);return o.MANY(function(){var r=o.CONSUME(_LexerConfig.AdditionOp),t=o.SUBRULE2(o.multiplicationExpression);(0,_chevrotain.tokenMatcher)(r,_LexerConfig.PlusOp)?e=(0,_Ast.buildPlusOpAst)(e,t,r.leadingWhitespace):(0,_chevrotain.tokenMatcher)(r,_LexerConfig.MinusOp)?e=(0,_Ast.buildMinusOpAst)(e,t,r.leadingWhitespace):o.ACTION(function(){throw Error("Operator not supported")})}),e}),o.multiplicationExpression=o.RULE("multiplicationExpression",function(){var e=o.SUBRULE(o.powerExpression);return o.MANY(function(){var r=o.CONSUME(_LexerConfig.MultiplicationOp),t=o.SUBRULE2(o.powerExpression);(0,_chevrotain.tokenMatcher)(r,_LexerConfig.TimesOp)?e=(0,_Ast.buildTimesOpAst)(e,t,r.leadingWhitespace):(0,_chevrotain.tokenMatcher)(r,_LexerConfig.DivOp)?e=(0,_Ast.buildDivOpAst)(e,t,r.leadingWhitespace):o.ACTION(function(){throw Error("Operator not supported")})}),e}),o.powerExpression=o.RULE("powerExpression",function(){var e=o.SUBRULE(o.atomicExpression);return o.MANY(function(){var r=o.CONSUME(_LexerConfig.PowerOp),t=o.SUBRULE2(o.atomicExpression);(0,_chevrotain.tokenMatcher)(r,_LexerConfig.PowerOp)?e=(0,_Ast.buildPowerOpAst)(e,t,r.leadingWhitespace):o.ACTION(function(){throw Error("Operator not supported")})}),e}),o.atomicExpression=o.RULE("atomicExpression",function(){return o.OR([{ALT:function(){var e=o.CONSUME(_LexerConfig.AdditionOp),r=o.SUBRULE(o.atomicExpression);return(0,_chevrotain.tokenMatcher)(e,_LexerConfig.PlusOp)?(0,_Ast.buildPlusUnaryOpAst)(r,e.leadingWhitespace):(0,_chevrotain.tokenMatcher)(e,_LexerConfig.MinusOp)?(0,_Ast.buildMinusUnaryOpAst)(r,e.leadingWhitespace):(o.customParsingError=(0,_Ast.parsingError)(_Ast.ParsingErrorType.ParserError,"Mismatched token type"),o.customParsingError)}},{ALT:function(){return o.SUBRULE2(o.rightUnaryOpAtomicExpression)}}])}),o.rightUnaryOpAtomicExpression=o.RULE("rightUnaryOpAtomicExpression",function(){var e=o.SUBRULE(o.positiveAtomicExpression),r=o.OPTION(function(){return o.CONSUME(_LexerConfig.PercentOp)});return r?(0,_Ast.buildPercentOpAst)(e,r.leadingWhitespace):e}),o.positiveAtomicExpression=o.RULE("positiveAtomicExpression",function(){return o.OR(o.atomicExpCache||(o.atomicExpCache=[{ALT:function(){return o.SUBRULE(o.parenthesisExpression)}},{ALT:function(){return o.SUBRULE(o.cellRangeExpression)}},{ALT:function(){return o.SUBRULE(o.columnRangeExpression)}},{ALT:function(){return o.SUBRULE(o.rowRangeExpression)}},{ALT:function(){return o.SUBRULE(o.offsetExpression)}},{ALT:function(){return o.SUBRULE(o.cellReference)}},{ALT:function(){return o.SUBRULE(o.procedureExpression)}},{ALT:function(){return o.SUBRULE(o.namedExpressionExpression)}},{ALT:function(){var e=o.CONSUME(o.lexerConfig.NumberLiteral);return(0,_Ast.buildNumberAst)(o.numericStringToNumber(e.image),e.leadingWhitespace)}},{ALT:function(){var e=o.CONSUME(_LexerConfig.StringLiteral);return(0,_Ast.buildStringAst)(e)}},{ALT:function(){var e=o.CONSUME(_LexerConfig.ErrorLiteral),r=e.image.toUpperCase(),t=o.lexerConfig.errorMapping[r];return t?(0,_Ast.buildCellErrorAst)(new _Cell.CellError(t),e.leadingWhitespace):o.parsingError(_Ast.ParsingErrorType.ParserError,"Unknown error literal")}}]))}),o.procedureExpression=o.RULE("procedureExpression",function(){var e,r=o.CONSUME(_LexerConfig.ProcedureName),t=r.image.toUpperCase().slice(0,-1),n=null!==(e=o.lexerConfig.functionMapping[t])&&void 0!==e?e:t,s=[],i=o.SUBRULE(o.booleanExpressionOrEmpty);o.MANY(function(){var e,r=o.CONSUME(o.lexerConfig.ArgSeparator);i.type===_Ast.AstNodeType.EMPTY&&(i.leadingWhitespace=null===(e=r.leadingWhitespace)||void 0===e?void 0:e.image),s.push(i),i=o.SUBRULE2(o.booleanExpressionOrEmpty)}),s.push(i),1===s.length&&s[0].type===_Ast.AstNodeType.EMPTY&&(s.length=0);var a=o.CONSUME(_LexerConfig.RParen);return(0,_Ast.buildProcedureAst)(n,s,r.leadingWhitespace,a.leadingWhitespace)}),o.namedExpressionExpression=o.RULE("namedExpressionExpression",function(){var e=o.CONSUME(_LexerConfig.NamedExpression);return(0,_Ast.buildNamedExpressionAst)(e.image,e.leadingWhitespace)}),o.offsetExpression=o.RULE("offsetExpression",function(){var e,r=o.SUBRULE(o.offsetProcedureExpression);return o.OPTION(function(){o.CONSUME(_LexerConfig.RangeSeparator),e=r.type===_Ast.AstNodeType.CELL_RANGE?o.parsingError(_Ast.ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here"):o.SUBRULE(o.endOfRangeWithOffsetStartExpression,{ARGS:[r]})}),void 0!==e?e:r}),o.offsetProcedureExpression=o.RULE("offsetProcedureExpression",function(){var e=[];return o.CONSUME(o.lexerConfig.OffsetProcedureName),o.CONSUME(_LexerConfig.LParen),o.MANY_SEP({SEP:o.lexerConfig.ArgSeparator,DEF:function(){e.push(o.SUBRULE(o.booleanExpression))}}),o.CONSUME(_LexerConfig.RParen),o.handleOffsetHeuristic(e)}),o.cellRangeExpression=o.RULE("cellRangeExpression",function(){var e=o.CONSUME(_LexerConfig.CellReference);return o.CONSUME2(_LexerConfig.RangeSeparator),o.SUBRULE(o.endOfRangeExpression,{ARGS:[e]})}),o.columnRangeExpression=o.RULE("columnRangeExpression",function(){var e=o.CONSUME(_LexerConfig.ColumnRange),r=_slicedToArray(e.image.split(":"),2),t=r[0],n=r[1],s=o.ACTION(function(){return(0,_addressRepresentationConverters.columnAddressFromString)(o.sheetMapping,t,o.formulaAddress)}),i=o.ACTION(function(){return(0,_addressRepresentationConverters.columnAddressFromString)(o.sheetMapping,n,o.formulaAddress)});if(void 0===s||void 0===i)return(0,_Ast.buildCellErrorAst)(new _Cell.CellError(_Cell.ErrorType.REF));if(s.exceedsSheetSizeLimits(o.lexerConfig.maxColumns)||i.exceedsSheetSizeLimits(o.lexerConfig.maxColumns))return(0,_Ast.buildErrorWithRawInputAst)(e.image,new _Cell.CellError(_Cell.ErrorType.NAME),e.leadingWhitespace);if(null===s.sheet&&null!==i.sheet)return o.parsingError(_Ast.ParsingErrorType.ParserError,"Malformed range expression");var a=o.rangeSheetReferenceType(s.sheet,i.sheet);return null!==s.sheet&&null===i.sheet&&(i=i.withAbsoluteSheet(s.sheet)),(0,_Ast.buildColumnRangeAst)(s,i,a,e.leadingWhitespace)}),o.rowRangeExpression=o.RULE("rowRangeExpression",function(){var e=o.CONSUME(_LexerConfig.RowRange),r=_slicedToArray(e.image.split(":"),2),t=r[0],n=r[1],s=o.ACTION(function(){return(0,_addressRepresentationConverters.rowAddressFromString)(o.sheetMapping,t,o.formulaAddress)}),i=o.ACTION(function(){return(0,_addressRepresentationConverters.rowAddressFromString)(o.sheetMapping,n,o.formulaAddress)});if(void 0===s||void 0===i)return(0,_Ast.buildCellErrorAst)(new _Cell.CellError(_Cell.ErrorType.REF));if(s.exceedsSheetSizeLimits(o.lexerConfig.maxRows)||i.exceedsSheetSizeLimits(o.lexerConfig.maxRows))return(0,_Ast.buildErrorWithRawInputAst)(e.image,new _Cell.CellError(_Cell.ErrorType.NAME),e.leadingWhitespace);if(null===s.sheet&&null!==i.sheet)return o.parsingError(_Ast.ParsingErrorType.ParserError,"Malformed range expression");var a=o.rangeSheetReferenceType(s.sheet,i.sheet);return null!==s.sheet&&null===i.sheet&&(i=i.withAbsoluteSheet(s.sheet)),(0,_Ast.buildRowRangeAst)(s,i,a,e.leadingWhitespace)}),o.cellReference=o.RULE("cellReference",function(){var e=o.CONSUME(_LexerConfig.CellReference),r=o.ACTION(function(){return(0,_addressRepresentationConverters.cellAddressFromString)(o.sheetMapping,e.image,o.formulaAddress)});return void 0===r?(0,_Ast.buildErrorWithRawInputAst)(e.image,new _Cell.CellError(_Cell.ErrorType.REF),e.leadingWhitespace):r.exceedsSheetSizeLimits(o.lexerConfig.maxColumns,o.lexerConfig.maxRows)?(0,_Ast.buildErrorWithRawInputAst)(e.image,new _Cell.CellError(_Cell.ErrorType.NAME),e.leadingWhitespace):(0,_Ast.buildCellReferenceAst)(r,e.leadingWhitespace)}),o.endOfRangeExpression=o.RULE("endOfRangeExpression",function(e){return o.OR([{ALT:function(){return o.SUBRULE(o.endRangeReference,{ARGS:[e]})}},{ALT:function(){var r,t=o.SUBRULE(o.offsetProcedureExpression),n=o.ACTION(function(){return(0,_addressRepresentationConverters.cellAddressFromString)(o.sheetMapping,e.image,o.formulaAddress)});if(void 0===n)return(0,_Ast.buildCellErrorAst)(new _Cell.CellError(_Cell.ErrorType.REF));if(t.type===_Ast.AstNodeType.CELL_REFERENCE){var s=t.reference,i=_Ast.RangeSheetReferenceType.RELATIVE;return null!==n.sheet&&(i=_Ast.RangeSheetReferenceType.START_ABSOLUTE,s=s.withAbsoluteSheet(n.sheet)),(0,_Ast.buildCellRangeAst)(n,s,i,null===(r=e.leadingWhitespace)||void 0===r?void 0:r.image)}return o.parsingError(_Ast.ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])}),o.endOfRangeWithOffsetStartExpression=o.RULE("endOfRangeWithOffsetStartExpression",function(e){return o.OR([{ALT:function(){return o.SUBRULE(o.endRangeWithOffsetStartReference,{ARGS:[e]})}},{ALT:function(){var r=o.SUBRULE(o.offsetProcedureExpression);if(r.type===_Ast.AstNodeType.CELL_REFERENCE){var t=r.reference,n=_Ast.RangeSheetReferenceType.RELATIVE;return null!==e.reference.sheet&&(n=_Ast.RangeSheetReferenceType.START_ABSOLUTE,t=t.withAbsoluteSheet(e.reference.sheet)),(0,_Ast.buildCellRangeAst)(e.reference,t,n,e.leadingWhitespace)}return o.parsingError(_Ast.ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])}),o.endRangeReference=o.RULE("endRangeReference",function(e){var r,t=o.CONSUME(_LexerConfig.CellReference),n=o.ACTION(function(){return(0,_addressRepresentationConverters.cellAddressFromString)(o.sheetMapping,e.image,o.formulaAddress)}),s=o.ACTION(function(){return(0,_addressRepresentationConverters.cellAddressFromString)(o.sheetMapping,t.image,o.formulaAddress)});return void 0===n||void 0===s?o.ACTION(function(){return(0,_Ast.buildErrorWithRawInputAst)("".concat(e.image,":").concat(t.image),new _Cell.CellError(_Cell.ErrorType.REF),e.leadingWhitespace)}):n.exceedsSheetSizeLimits(o.lexerConfig.maxColumns,o.lexerConfig.maxRows)||s.exceedsSheetSizeLimits(o.lexerConfig.maxColumns,o.lexerConfig.maxRows)?o.ACTION(function(){return(0,_Ast.buildErrorWithRawInputAst)("".concat(e.image,":").concat(t.image),new _Cell.CellError(_Cell.ErrorType.NAME),e.leadingWhitespace)}):o.buildCellRange(n,s,null===(r=e.leadingWhitespace)||void 0===r?void 0:r.image)}),o.endRangeWithOffsetStartReference=o.RULE("endRangeWithOffsetStartReference",function(e){var r=o.CONSUME(_LexerConfig.CellReference),t=o.ACTION(function(){return(0,_addressRepresentationConverters.cellAddressFromString)(o.sheetMapping,r.image,o.formulaAddress)});return void 0===t?o.ACTION(function(){return(0,_Ast.buildCellErrorAst)(new _Cell.CellError(_Cell.ErrorType.REF))}):o.buildCellRange(e.reference,t,e.leadingWhitespace)}),o.parenthesisExpression=o.RULE("parenthesisExpression",function(){var e=o.CONSUME(_LexerConfig.LParen),r=o.SUBRULE(o.booleanExpression),t=o.CONSUME(_LexerConfig.RParen);return(0,_Ast.buildParenthesisAst)(r,e.leadingWhitespace,t.leadingWhitespace)}),o.numericStringToNumber=function(e){var r=e.replace(o.lexerConfig.decimalSeparator,".");return Number(r)},o.lexerConfig=e,o.sheetMapping=n,o.formulaAddress=(0,_Cell.simpleCellAddress)(0,0,0),o.performSelfAnalysis(),o}return _createClass(t,[{key:"parseFromTokens",value:function(e,r){this.input=e;var t=this.formulaWithContext(r),n=[];return this.customParsingError&&n.push(this.customParsingError),(n=n.concat(this.errors.map(function(e){return{type:_Ast.ParsingErrorType.ParserError,message:e.message}}))).length>0&&(t=(0,_Ast.buildParsingErrorAst)()),{ast:t,errors:n}}},{key:"formulaWithContext",value:function(e){return this.formulaAddress=e,this.formula()}},{key:"reset",value:function(){_get(_getPrototypeOf(t.prototype),"reset",this).call(this),this.customParsingError=void 0}},{key:"buildCellRange",value:function(e,r,t){if(null===e.sheet&&null!==r.sheet)return this.parsingError(_Ast.ParsingErrorType.ParserError,"Malformed range expression");var n=this.rangeSheetReferenceType(e.sheet,r.sheet);return null!==e.sheet&&null===r.sheet&&(r=r.withAbsoluteSheet(e.sheet)),(0,_Ast.buildCellRangeAst)(e,r,n,t)}},{key:"handleOffsetHeuristic",value:function(e){var r=e[0];if(r.type!==_Ast.AstNodeType.CELL_REFERENCE)return this.parsingError(_Ast.ParsingErrorType.StaticOffsetError,"First argument to OFFSET is not a reference");var t,n=e[1];if(n.type===_Ast.AstNodeType.NUMBER&&Number.isInteger(n.value))t=n.value;else if(n.type===_Ast.AstNodeType.PLUS_UNARY_OP&&n.value.type===_Ast.AstNodeType.NUMBER&&Number.isInteger(n.value.value))t=n.value.value;else{if(n.type!==_Ast.AstNodeType.MINUS_UNARY_OP||n.value.type!==_Ast.AstNodeType.NUMBER||!Number.isInteger(n.value.value))return this.parsingError(_Ast.ParsingErrorType.StaticOffsetError,"Second argument to OFFSET is not a static number");t=-n.value.value}var o,s=e[2];if(s.type===_Ast.AstNodeType.NUMBER&&Number.isInteger(s.value))o=s.value;else if(s.type===_Ast.AstNodeType.PLUS_UNARY_OP&&s.value.type===_Ast.AstNodeType.NUMBER&&Number.isInteger(s.value.value))o=s.value.value;else{if(s.type!==_Ast.AstNodeType.MINUS_UNARY_OP||s.value.type!==_Ast.AstNodeType.NUMBER||!Number.isInteger(s.value.value))return this.parsingError(_Ast.ParsingErrorType.StaticOffsetError,"Third argument to OFFSET is not a static number");o=-s.value.value}var i,a=e[3];if(void 0===a)i=1;else{if(a.type!==_Ast.AstNodeType.NUMBER)return this.parsingError(_Ast.ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not a static number");if((i=a.value)<1)return this.parsingError(_Ast.ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(i))return this.parsingError(_Ast.ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not integer")}var l,u=e[4];if(void 0===u)l=1;else{if(u.type!==_Ast.AstNodeType.NUMBER)return this.parsingError(_Ast.ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not a static number");if((l=u.value)<1)return this.parsingError(_Ast.ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(l))return this.parsingError(_Ast.ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not integer")}var c=new _CellAddress.CellAddress(null,r.reference.col+o,r.reference.row+t,r.reference.type),p=c.col,f=c.row;if(r.reference.type!==_CellAddress.CellReferenceType.CELL_REFERENCE_RELATIVE&&r.reference.type!==_CellAddress.CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL||(f+=this.formulaAddress.row),r.reference.type!==_CellAddress.CellReferenceType.CELL_REFERENCE_RELATIVE&&r.reference.type!==_CellAddress.CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW||(p+=this.formulaAddress.col),p<0||f<0)return(0,_Ast.buildCellErrorAst)(new _Cell.CellError(_Cell.ErrorType.REF,"Resulting reference is out of the sheet"));if(1===l&&1===i)return(0,_Ast.buildCellReferenceAst)(c);var E=new _CellAddress.CellAddress(null,c.col+l-1,c.row+i-1,c.type);return(0,_Ast.buildCellRangeAst)(c,E,_Ast.RangeSheetReferenceType.RELATIVE)}},{key:"parsingError",value:function(e,r){return this.customParsingError=(0,_Ast.parsingError)(e,r),(0,_Ast.buildParsingErrorAst)()}},{key:"rangeSheetReferenceType",value:function(e,r){return null===e?_Ast.RangeSheetReferenceType.RELATIVE:null===r?_Ast.RangeSheetReferenceType.START_ABSOLUTE:_Ast.RangeSheetReferenceType.BOTH_ABSOLUTE}}]),t}();exports.FormulaParser=FormulaParser;var FormulaLexer=function(){function e(r){_classCallCheck(this,e),this.lexerConfig=r,this.lexer=new _chevrotain.Lexer(r.allTokens,{ensureOptimizations:!0})}return _createClass(e,[{key:"tokenizeFormula",value:function(e){var r=this.lexer.tokenize(e),t=r.tokens;return t=this.trimTrailingWhitespaces(t),t=this.skipWhitespacesInsideRanges(t),t=this.skipWhitespacesBeforeArgSeparators(t),r.tokens=t,r}},{key:"skipWhitespacesInsideRanges",value:function(e){return this.filterTokensByNeighbors(e,function(e,r,t){return((0,_chevrotain.tokenMatcher)(e,_LexerConfig.CellReference)||(0,_chevrotain.tokenMatcher)(e,_LexerConfig.RangeSeparator))&&(0,_chevrotain.tokenMatcher)(r,_LexerConfig.WhiteSpace)&&((0,_chevrotain.tokenMatcher)(t,_LexerConfig.CellReference)||(0,_chevrotain.tokenMatcher)(t,_LexerConfig.RangeSeparator))})}},{key:"skipWhitespacesBeforeArgSeparators",value:function(e){var r=this;return this.filterTokensByNeighbors(e,function(e,t,n){return!(0,_chevrotain.tokenMatcher)(e,r.lexerConfig.ArgSeparator)&&(0,_chevrotain.tokenMatcher)(t,_LexerConfig.WhiteSpace)&&(0,_chevrotain.tokenMatcher)(n,r.lexerConfig.ArgSeparator)})}},{key:"filterTokensByNeighbors",value:function(e,r){if(e.length<3)return e;for(var t=0,n=[e[t++]];t<e.length-1;)r(e[t-1],e[t],e[t+1])||n.push(e[t]),++t;return n.push(e[t]),n}},{key:"trimTrailingWhitespaces",value:function(e){return e.length>0&&(0,_chevrotain.tokenMatcher)(e[e.length-1],_LexerConfig.WhiteSpace)&&e.pop(),e}}]),e}();exports.FormulaLexer=FormulaLexer;
//# sourceMappingURL=/sm/30de275bfc8e6d7bafcb5003f6d661b4d4182beb1b4210bfb47a2468d4d1add8.map