/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/commonjs/ColumnSearch/ColumnIndex.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";require("core-js/modules/es.symbol"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.symbol.iterator"),require("core-js/modules/es.array.concat"),require("core-js/modules/es.array.find"),require("core-js/modules/es.array.from"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.array.slice"),require("core-js/modules/es.array.splice"),require("core-js/modules/es.function.name"),require("core-js/modules/es.map"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/es.string.iterator"),require("core-js/modules/web.dom-collections.iterator"),exports.__esModule=!0,exports.upperBound=upperBound,exports.lowerBound=lowerBound,exports.ColumnIndex=void 0;var _Cell=require("../Cell"),_Matrix=require("../Matrix"),_statistics=require("../statistics"),_ColumnBinarySearch=require("./ColumnBinarySearch"),_AddRowsTransformer=require("../dependencyTransformers/AddRowsTransformer"),_RemoveRowsTransformer=require("../dependencyTransformers/RemoveRowsTransformer"),_InterpreterValue=require("../interpreter/InterpreterValue");function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var ColumnIndex=function(){function e(r,t,n){_classCallCheck(this,e),this.dependencyGraph=r,this.config=t,this.stats=n,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new _ColumnBinarySearch.ColumnBinarySearch(r,t)}return _createClass(e,[{key:"add",value:function(e,r){if(e instanceof _Matrix.Matrix){var t,n=_createForOfIteratorHelper(e.generateValues(r));try{for(n.s();!(t=n.n()).done;){var o=_slicedToArray(t.value,2),a=o[0],i=o[1];this.addSingleCellValue(a,i)}}catch(e){n.e(e)}finally{n.f()}}else e instanceof _Cell.CellError||e instanceof _InterpreterValue.SimpleRangeValue||this.addSingleCellValue(e,r)}},{key:"remove",value:function(e,r){if(e)if(e instanceof _Matrix.Matrix){var t,n=_createForOfIteratorHelper(e.generateValues(r));try{for(n.s();!(t=n.n()).done;){var o=_slicedToArray(t.value,2),a=o[0],i=o[1];this.removeSingleValue(a,i)}}catch(e){n.e(e)}finally{n.f()}}else this.removeSingleValue(e,r)}},{key:"change",value:function(e,r,t){e!==r&&(this.remove(e,t),this.add(r,t))}},{key:"moveValues",value:function(e,r,t,n){var o,a=_createForOfIteratorHelper(e);try{for(a.s();!(o=a.n()).done;){var i=_slicedToArray(o.value,2),s=i[0],l=i[1],u=(0,_Cell.movedSimpleCellAddress)(l,n,r,t);this.remove(s,l),this.add(s,u)}}catch(e){a.e(e)}finally{a.f()}}},{key:"removeValues",value:function(e){var r,t=_createForOfIteratorHelper(e);try{for(t.s();!(r=t.n()).done;){var n=_slicedToArray(r.value,2),o=n[0],a=n[1];this.remove(o,a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"find",value:function(e,r,t){this.ensureRecentData(r.sheet,r.start.col,e);var n=this.getColumnMap(r.sheet,r.start.col);if(!n)return-1;var o=n.get(e);if(!o)return this.binarySearchStrategy.find(e,r,t);var a=upperBound(o.index,r.start.row),i=o.index[a];return i<=r.end.row?i:this.binarySearchStrategy.find(e,r,t)}},{key:"advancedFind",value:function(e,r){return this.binarySearchStrategy.advancedFind(e,r)}},{key:"addColumns",value:function(e){var r=this.index.get(e.sheet);r&&r.splice.apply(r,[e.columnStart,0].concat(_toConsumableArray(Array(e.numberOfColumns))))}},{key:"removeColumns",value:function(e){var r=this.index.get(e.sheet);r&&r.splice(e.columnStart,e.numberOfColumns)}},{key:"removeSheet",value:function(e){this.index.delete(e)}},{key:"getColumnMap",value:function(e,r){this.index.has(e)||this.index.set(e,[]);var t=this.index.get(e),n=t[r];return n||(n=new Map,t[r]=n),n}},{key:"getValueIndex",value:function(e,r,t){var n=this.getColumnMap(e,r),o=this.getColumnMap(e,r).get(t);return o||(o={version:this.transformingService.version(),index:[]},n.set(t,o)),o}},{key:"ensureRecentData",value:function(e,r,t){var n=this.getValueIndex(e,r,t),o=this.transformingService.version();if(n.version!==o){var a,i=_createForOfIteratorHelper(this.transformingService.getTransformationsFrom(n.version,function(r){return r.sheet===e&&(r instanceof _AddRowsTransformer.AddRowsTransformer||r instanceof _RemoveRowsTransformer.RemoveRowsTransformer)}));try{for(i.s();!(a=i.n()).done;){var s=a.value;s instanceof _AddRowsTransformer.AddRowsTransformer?this.addRows(r,s.rowsSpan,t):s instanceof _RemoveRowsTransformer.RemoveRowsTransformer&&this.removeRows(r,s.rowsSpan,t)}}catch(e){i.e(e)}finally{i.f()}n.version=o}}},{key:"destroy",value:function(){this.index.clear()}},{key:"addSingleCellValue",value:function(e,r){var t=this;this.stats.measure(_statistics.StatType.BUILD_COLUMN_INDEX,function(){t.ensureRecentData(r.sheet,r.col,e);var n=t.getValueIndex(r.sheet,r.col,e);t.addValue(n,r.row)})}},{key:"removeSingleValue",value:function(e,r){var t=this;this.stats.measure(_statistics.StatType.BUILD_COLUMN_INDEX,function(){t.ensureRecentData(r.sheet,r.col,e);var n=t.getColumnMap(r.sheet,r.col),o=n.get(e);if(o){var a=upperBound(o.index,r.row);o.index.splice(a,1),0===o.index.length&&n.delete(e),0===n.size&&delete t.index.get(r.sheet)[r.col]}})}},{key:"addRows",value:function(e,r,t){var n=this.getValueIndex(r.sheet,e,t);this.shiftRows(n,r.rowStart,r.numberOfRows)}},{key:"removeRows",value:function(e,r,t){var n=this.getValueIndex(r.sheet,e,t);this.removeRowsFromValues(n,r),this.shiftRows(n,r.rowEnd+1,-r.numberOfRows)}},{key:"addValue",value:function(e,r){var t=lowerBound(e.index,r);e.index[t]!==r&&(t===e.index.length-1?e.index.push(r):e.index.splice(t+1,0,r))}},{key:"removeRowsFromValues",value:function(e,r){var t=upperBound(e.index,r.rowStart),n=lowerBound(e.index,r.rowEnd);e.index[t]<=r.rowEnd&&e.index.splice(t,n-t+1)}},{key:"shiftRows",value:function(e,r,t){for(var n=upperBound(e.index,r);n<e.index.length;++n)e.index[n]+=t}}]),e}();function upperBound(e,r){for(var t=0,n=e.length-1;t<=n;){var o=Math.floor((t+n)/2);if(r>e[o])t=o+1;else{if(!(r<e[o]))return o;n=o-1}}return t}function lowerBound(e,r){for(var t=0,n=e.length-1;t<=n;){var o=Math.floor((t+n)/2);if(r>e[o])t=o+1;else{if(!(r<e[o]))return o;n=o-1}}return n}exports.ColumnIndex=ColumnIndex;
//# sourceMappingURL=/sm/a1cb0d403108f34b904ae66ede5b220128c01141211a9f88a6ae3a203a4e02e6.map