/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/commonjs/NamedExpressions.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";require("core-js/modules/es.array.filter"),require("core-js/modules/es.array.from"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.array.map"),require("core-js/modules/es.array.some"),require("core-js/modules/es.map"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.string.iterator"),require("core-js/modules/web.dom-collections.iterator"),exports.__esModule=!0,exports.doesContainRelativeReferences=exports.NamedExpressions=exports.InternalNamedExpression=void 0;var _Cell=require("./Cell"),_parser=require("./parser");function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,s){for(var r=0;r<s.length;r++){var t=s[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,s,r){return s&&_defineProperties(e.prototype,s),r&&_defineProperties(e,r),e}var InternalNamedExpression=function(){function e(s,r,t,a){_classCallCheck(this,e),this.displayName=s,this.address=r,this.added=t,this.options=a}return _createClass(e,[{key:"normalizeExpressionName",value:function(){return this.displayName.toLowerCase()}},{key:"copy",value:function(){return new e(this.displayName,this.address,this.added,this.options)}}]),e}();exports.InternalNamedExpression=InternalNamedExpression;var WorkbookStore=function(){function e(){_classCallCheck(this,e),this.mapping=new Map}return _createClass(e,[{key:"has",value:function(e){return this.mapping.has(this.normalizeExpressionName(e))}},{key:"isNameAvailable",value:function(e){var s=this.normalizeExpressionName(e),r=this.mapping.get(s);return!(r&&r.added)}},{key:"add",value:function(e){this.mapping.set(e.normalizeExpressionName(),e)}},{key:"get",value:function(e){return this.mapping.get(this.normalizeExpressionName(e))}},{key:"getExisting",value:function(e){var s=this.mapping.get(this.normalizeExpressionName(e));return s&&s.added?s:void 0}},{key:"remove",value:function(e){var s=this.normalizeExpressionName(e),r=this.mapping.get(s);r&&(r.added=!1)}},{key:"getAllNamedExpressions",value:function(){return Array.from(this.mapping.values()).filter(function(e){return e.added})}},{key:"normalizeExpressionName",value:function(e){return e.toLowerCase()}}]),e}(),WorksheetStore=function(){function e(){_classCallCheck(this,e),this.mapping=new Map}return _createClass(e,[{key:"add",value:function(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}},{key:"get",value:function(e){return this.mapping.get(this.normalizeExpressionName(e))}},{key:"has",value:function(e){return this.mapping.has(this.normalizeExpressionName(e))}},{key:"normalizeExpressionName",value:function(e){return e.toLowerCase()}},{key:"isNameAvailable",value:function(e){var s=this.normalizeExpressionName(e);return!this.mapping.has(s)}},{key:"remove",value:function(e){var s=this.normalizeExpressionName(e);this.mapping.get(s)&&this.mapping.delete(s)}}]),e}(),NamedExpressions=function(){function e(){_classCallCheck(this,e),this.nextNamedExpressionRow=0,this.workbookStore=new WorkbookStore,this.worksheetStores=new Map,this.addressCache=new Map}return _createClass(e,[{key:"isNameAvailable",value:function(e,s){return void 0===s?this.workbookStore.isNameAvailable(e):this.worksheetStore(s).isNameAvailable(e)}},{key:"namedExpressionInAddress",value:function(e){var s=this.addressCache.get(e);return s&&s.added?s:void 0}},{key:"namedExpressionForScope",value:function(e,s){return void 0===s?this.workbookStore.getExisting(e):this.worksheetStore(s).get(e)}},{key:"nearestNamedExpression",value:function(e,s){return this.worksheetStore(s).get(e)||this.workbookStore.getExisting(e)}},{key:"isExpressionInScope",value:function(e,s){return this.worksheetStore(s).has(e)}},{key:"isNameValid",value:function(e){return!/^[A-Za-z]+[0-9]+$/.test(e)&&/^[A-Za-z\u00C0-\u02AF_][A-Za-z0-9\u00C0-\u02AF\._]*$/.test(e)}},{key:"addNamedExpression",value:function(e,s,r){if(void 0===s){var t=this.workbookStore.get(e);return t?(t.added=!0,t.displayName=e,t.options=r):(t=new InternalNamedExpression(e,this.nextAddress(),!0,r),this.workbookStore.add(t)),this.addressCache.set(t.address.row,t),t}var a=this.worksheetStore(s),o=new InternalNamedExpression(e,this.nextAddress(),!0,r);return a.add(o),this.addressCache.set(o.address.row,o),o}},{key:"worksheetStore",value:function(e){var s=this.worksheetStores.get(e);return s||(s=new WorksheetStore,this.worksheetStores.set(e,s)),s}},{key:"namedExpressionOrPlaceholder",value:function(e,s){var r=this.worksheetStore(s).get(e);if(r)return r;var t=this.workbookStore.get(e);return void 0===t&&(t=new InternalNamedExpression(e,this.nextAddress(),!1),this.workbookStore.add(t)),t}},{key:"workbookNamedExpressionOrPlaceholder",value:function(e){var s=this.workbookStore.get(e);return void 0===s&&(s=new InternalNamedExpression(e,this.nextAddress(),!1),this.workbookStore.add(s)),s}},{key:"remove",value:function(e,s){var r,t=(r=void 0===s?this.workbookStore:this.worksheetStore(s)).get(e);if(void 0===t||!t.added)throw"Named expression does not exist";r.remove(e),this.addressCache.delete(t.address.row)}},{key:"getAllNamedExpressionsNames",value:function(){return this.workbookStore.getAllNamedExpressions().map(function(e){return e.displayName})}},{key:"nextAddress",value:function(){return(0,_Cell.simpleCellAddress)(e.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}},{key:"lookupNextAddress",value:function(s,r){if(void 0===r){var t=this.workbookStore.get(s);if(t)return t.address}return(0,_Cell.simpleCellAddress)(e.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow)}}]),e}();exports.NamedExpressions=NamedExpressions,NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;var doesContainRelativeReferences=function e(s){switch(s.type){case _parser.AstNodeType.EMPTY:case _parser.AstNodeType.NUMBER:case _parser.AstNodeType.STRING:case _parser.AstNodeType.ERROR:case _parser.AstNodeType.ERROR_WITH_RAW_INPUT:return!1;case _parser.AstNodeType.CELL_REFERENCE:return!s.reference.isAbsolute();case _parser.AstNodeType.CELL_RANGE:case _parser.AstNodeType.COLUMN_RANGE:case _parser.AstNodeType.ROW_RANGE:return!s.start.isAbsolute();case _parser.AstNodeType.NAMED_EXPRESSION:return!1;case _parser.AstNodeType.PERCENT_OP:case _parser.AstNodeType.PLUS_UNARY_OP:case _parser.AstNodeType.MINUS_UNARY_OP:return e(s.value);case _parser.AstNodeType.CONCATENATE_OP:case _parser.AstNodeType.EQUALS_OP:case _parser.AstNodeType.NOT_EQUAL_OP:case _parser.AstNodeType.LESS_THAN_OP:case _parser.AstNodeType.GREATER_THAN_OP:case _parser.AstNodeType.LESS_THAN_OR_EQUAL_OP:case _parser.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case _parser.AstNodeType.MINUS_OP:case _parser.AstNodeType.PLUS_OP:case _parser.AstNodeType.TIMES_OP:case _parser.AstNodeType.DIV_OP:case _parser.AstNodeType.POWER_OP:return e(s.left)||e(s.right);case _parser.AstNodeType.PARENTHESIS:return e(s.expression);case _parser.AstNodeType.FUNCTION_CALL:return s.args.some(function(s){return e(s)})}};exports.doesContainRelativeReferences=doesContainRelativeReferences;
//# sourceMappingURL=/sm/7a6345d2d02324796984c58d2699ed199a656f093a4305ff984998b9bcfa902d.map