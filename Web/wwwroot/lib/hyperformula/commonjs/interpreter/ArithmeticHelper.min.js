/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/commonjs/interpreter/ArithmeticHelper.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";require("core-js/modules/es.array.includes"),require("core-js/modules/es.number.constructor"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.regexp.constructor"),require("core-js/modules/es.regexp.exec"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/es.string.replace"),require("core-js/modules/es.string.trim"),exports.__esModule=!0,exports.coerceToRange=coerceToRange,exports.coerceToRangeNumbersOrError=coerceToRangeNumbersOrError,exports.coerceBooleanToNumber=coerceBooleanToNumber,exports.coerceEmptyToValue=coerceEmptyToValue,exports.coerceScalarToBoolean=coerceScalarToBoolean,exports.coerceScalarToString=coerceScalarToString,exports.multiply=multiply,exports.power=power,exports.divide=divide,exports.unaryminus=unaryminus,exports.percent=percent,exports.max=max,exports.maxa=maxa,exports.min=min,exports.mina=mina,exports.numberCmp=numberCmp,exports.isNumberOverflow=isNumberOverflow,exports.fixNegativeZero=fixNegativeZero,exports.ArithmeticHelper=void 0;var _Cell=require("../Cell"),_StringHelper=require("../StringHelper"),_InterpreterValue=require("./InterpreterValue");function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var ArithmeticHelper=function(){function e(r,t,n){var o=this;_classCallCheck(this,e),this.config=r,this.dateTimeHelper=t,this.numberLiteralsHelper=n,this.nonstrictadd=function(e,r){return e instanceof _Cell.CellError?e:r instanceof _Cell.CellError?r:"number"==typeof e?"number"==typeof r?o.addWithEpsilon(e,r):e:"number"==typeof r?r:0},this.collator=(0,_StringHelper.collatorFromConfig)(r),this.actualEps=r.smartRounding?r.precisionEpsilon:0}return _createClass(e,[{key:"eqMatcherFunction",value:function(e){var r=this,t=this.buildRegex(e);return function(e){return"string"==typeof e&&t.test(r.normalizeString(e))}}},{key:"neqMatcherFunction",value:function(e){var r=this,t=this.buildRegex(e);return function(e){return"string"!=typeof e||!t.test(r.normalizeString(e))}}},{key:"requiresRegex",value:function(e){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(var r=0;r<e.length;r++){var t=e.charAt(r);if(isWildcard(t)||this.config.useRegularExpressions&&needsEscape(t))return!0}return!1}},{key:"buildRegex",value:function(e){var r;e=this.normalizeString(e);var t=this.config.useWildcards,n=this.config.useRegularExpressions;if(n)try{RegExp(e)}catch(e){n=!1,t=!1}return r=n?escapeNoCharacters(e,this.config.caseSensitive):t?escapeNonWildcards(e,this.config.caseSensitive):escapeAllCharacters(e,this.config.caseSensitive),this.config.matchWholeCell?RegExp("^("+r+")$"):RegExp(r)}},{key:"normalizeString",value:function(e){return this.config.caseSensitive||(e=e.toLowerCase()),this.config.accentSensitive||(e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")),e}},{key:"compare",value:function(e,r){if("string"==typeof e||"string"==typeof r){var t="string"==typeof e?this.dateTimeHelper.dateStringToDateNumber(e):e,n="string"==typeof r?this.dateTimeHelper.dateStringToDateNumber(r):r;if("number"==typeof t&&"number"==typeof n)return this.floatCmp(t,n)}return e===_Cell.EmptyValue?e=coerceEmptyToValue(r):r===_Cell.EmptyValue&&(r=coerceEmptyToValue(e)),"string"==typeof e&&"string"==typeof r?this.stringCmp(e,r):"boolean"==typeof e&&"boolean"==typeof r?numberCmp(coerceBooleanToNumber(e),coerceBooleanToNumber(r)):"number"==typeof e&&"number"==typeof r?this.floatCmp(e,r):e===_Cell.EmptyValue&&r===_Cell.EmptyValue?0:numberCmp((0,_Cell.CellValueTypeOrd)((0,_Cell.getCellValueType)(e)),(0,_Cell.CellValueTypeOrd)((0,_Cell.getCellValueType)(r)))}},{key:"floatCmp",value:function(e,r){var t=1+this.actualEps;return r>=0&&e*t>=r&&e<=r*t?0:r<=0&&e*t<=r&&e>=r*t?0:e>r?1:-1}},{key:"stringCmp",value:function(e,r){return this.collator.compare(e,r)}},{key:"add",value:function(e,r){return e instanceof _Cell.CellError?e:r instanceof _Cell.CellError?r:this.addWithEpsilon(e,r)}},{key:"addWithEpsilon",value:function(e,r){var t=e+r;return Math.abs(t)<this.actualEps*Math.abs(e)?0:t}},{key:"subtract",value:function(e,r){if(e instanceof _Cell.CellError)return e;if(r instanceof _Cell.CellError)return r;var t=e-r;return Math.abs(t)<this.actualEps*Math.abs(e)?0:t}},{key:"coerceScalarToNumberOrError",value:function(e){var r;return e instanceof _Cell.CellError?e:null!==(r=this.coerceToMaybeNumber(e))&&void 0!==r?r:new _Cell.CellError(_Cell.ErrorType.VALUE)}},{key:"coerceToMaybeNumber",value:function(e){var r;return null!==(r=this.coerceNonDateScalarToMaybeNumber(e))&&void 0!==r?r:"string"==typeof e?this.dateTimeHelper.dateStringToDateNumber(e):void 0}},{key:"coerceNonDateScalarToMaybeNumber",value:function(e){if(e===_Cell.EmptyValue)return 0;if("string"==typeof e&&this.numberLiteralsHelper.isNumber(e))return this.numberLiteralsHelper.numericStringToNumber(e);if(!("string"==typeof e&&e.length>0&&""===e.trim())){var r=Number(e);return isNaN(r)?void 0:r}}}]),e}();function coerceToRange(e){return e instanceof _InterpreterValue.SimpleRangeValue?e:_InterpreterValue.SimpleRangeValue.fromScalar(e)}function coerceToRangeNumbersOrError(e){return e instanceof _InterpreterValue.SimpleRangeValue&&e.hasOnlyNumbers()||e instanceof _Cell.CellError?e:"number"==typeof e?_InterpreterValue.SimpleRangeValue.fromScalar(e):null}function coerceBooleanToNumber(e){return Number(e)}function coerceEmptyToValue(e){return"string"==typeof e?"":"number"==typeof e?0:"boolean"!=typeof e&&_Cell.EmptyValue}function coerceScalarToBoolean(e){if(e instanceof _InterpreterValue.SimpleRangeValue)return new _Cell.CellError(_Cell.ErrorType.VALUE);if(e instanceof _Cell.CellError||"boolean"==typeof e)return e;if(e===_Cell.EmptyValue)return!1;if("number"==typeof e)return 0!==e;var r=e.toUpperCase();return"TRUE"===r||"FALSE"!==r&&(""!==r&&null)}function coerceScalarToString(e){return e instanceof _Cell.CellError||"string"==typeof e?e:e===_Cell.EmptyValue?"":"number"==typeof e?e.toString():e?"TRUE":"FALSE"}function multiply(e,r){return e instanceof _Cell.CellError?e:r instanceof _Cell.CellError?r:e*r}function power(e,r){return e instanceof _Cell.CellError?e:r instanceof _Cell.CellError?r:Math.pow(e,r)}function divide(e,r){return e instanceof _Cell.CellError?e:r instanceof _Cell.CellError?r:0===r?new _Cell.CellError(_Cell.ErrorType.DIV_BY_ZERO):e/r}function unaryminus(e){return e instanceof _Cell.CellError?e:-e}function percent(e){return e instanceof _Cell.CellError?e:e/100}function max(e,r){return e instanceof _Cell.CellError?e:r instanceof _Cell.CellError?r:"number"==typeof e?"number"==typeof r?Math.max(e,r):e:"number"==typeof r?r:Number.NEGATIVE_INFINITY}function maxa(e,r){return e instanceof _Cell.CellError?e:r instanceof _Cell.CellError?r:("boolean"==typeof e&&(e=coerceBooleanToNumber(e)),"boolean"==typeof r&&(r=coerceBooleanToNumber(r)),"number"==typeof e?"number"==typeof r?Math.max(e,r):e:"number"==typeof r?r:Number.NEGATIVE_INFINITY)}function min(e,r){return e instanceof _Cell.CellError?e:r instanceof _Cell.CellError?r:"number"==typeof e?"number"==typeof r?Math.min(e,r):e:"number"==typeof r?r:Number.POSITIVE_INFINITY}function mina(e,r){return e instanceof _Cell.CellError?e:r instanceof _Cell.CellError?r:("boolean"==typeof e&&(e=coerceBooleanToNumber(e)),"boolean"==typeof r&&(r=coerceBooleanToNumber(r)),"number"==typeof e?"number"==typeof r?Math.min(e,r):e:"number"==typeof r?r:Number.POSITIVE_INFINITY)}function numberCmp(e,r){return e>r?1:e<r?-1:0}function isNumberOverflow(e){return isNaN(e)||e===1/0||e===-1/0}function fixNegativeZero(e){return 0===e?0:e}function isWildcard(e){return["*","?"].includes(e)}exports.ArithmeticHelper=ArithmeticHelper;var escapedCharacters=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"];function needsEscape(e){return escapedCharacters.includes(e)}function escapeNonWildcards(e,r){for(var t="",n=0;n<e.length;n++){var o=e.charAt(n);if("~"===o){if(n==e.length-1){t+="~";continue}var l=e.charAt(n+1);isWildcard(l)||needsEscape(l)?(t+="\\"+l,n++):(t+=l,n++)}else isWildcard(o)?t+="."+o:needsEscape(o)?t+="\\"+o:t+=r?o:o.toLowerCase()}return t}function escapeAllCharacters(e,r){for(var t="",n=0;n<e.length;n++){var o=e.charAt(n);isWildcard(o)||needsEscape(o)?t+="\\"+o:t+=r?o:o.toLowerCase()}return t}function escapeNoCharacters(e,r){for(var t="",n=0;n<e.length;n++){var o=e.charAt(n);isWildcard(o)||needsEscape(o)?t+=o:t+=r?o:o.toLowerCase()}return t}
//# sourceMappingURL=/sm/a8cc78beaa99f182b33ca18558b02d98e285baac6412fe4160b1c44e87d4d14c.map