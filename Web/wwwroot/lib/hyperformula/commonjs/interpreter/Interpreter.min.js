/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/commonjs/interpreter/Interpreter.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";require("core-js/modules/es.symbol"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.symbol.iterator"),require("core-js/modules/es.array.from"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.array.slice"),require("core-js/modules/es.function.name"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/es.string.iterator"),require("core-js/modules/web.dom-collections.iterator"),exports.__esModule=!0,exports.Interpreter=void 0;var _gpu=_interopRequireDefault(require("gpu.js")),_AbsoluteCellRange=require("../AbsoluteCellRange"),_Cell=require("../Cell"),_Matrix=require("../Matrix"),_Ast=require("../parser/Ast"),_ArithmeticHelper=require("./ArithmeticHelper"),_Criterion=require("./Criterion"),_InterpreterValue=require("./InterpreterValue"),_text=require("./text");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],a=!0,s=!1,i=void 0;try{for(var l,o=e[Symbol.iterator]();!(a=(l=o.next()).done)&&(t.push(l.value),!r||t.length!==r);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw i}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var Interpreter=function(){function e(r,t,a,s,i,l,o,n){_classCallCheck(this,e),this.dependencyGraph=r,this.columnSearch=t,this.config=a,this.stats=s,this.dateHelper=i,this.numberLiteralsHelper=l,this.functionRegistry=o,this.namedExpressions=n,this.functionRegistry.initializePlugins(this),this.arithmeticHelper=new _ArithmeticHelper.ArithmeticHelper(a,i,l),this.criterionBuilder=new _Criterion.CriterionBuilder(a)}return _createClass(e,[{key:"evaluateAst",value:function(e,r){var t,a,s,i,l,o,n,u,c,p,h;switch(e.type){case _Ast.AstNodeType.EMPTY:throw new Error("Empty argument should not be evaluated.");case _Ast.AstNodeType.CELL_REFERENCE:var A=e.reference.toSimpleCellAddress(r);return(0,_Cell.invalidSimpleCellAddress)(A)?new _Cell.CellError(_Cell.ErrorType.REF):this.dependencyGraph.getCellValue(A);case _Ast.AstNodeType.NUMBER:case _Ast.AstNodeType.STRING:return e.value;case _Ast.AstNodeType.CONCATENATE_OP:var _=this.evaluateAst(e.left,r),d=this.evaluateAst(e.right,r);return(0,_text.concatenate)([_,d]);case _Ast.AstNodeType.EQUALS_OP:var m=this.evaluateAst(e.left,r),y=this.evaluateAst(e.right,r);return null!==(t=this.passErrors(m,y))&&void 0!==t?t:0===this.arithmeticHelper.compare(m,y);case _Ast.AstNodeType.NOT_EQUAL_OP:var E=this.evaluateAst(e.left,r),v=this.evaluateAst(e.right,r);return null!==(a=this.passErrors(E,v))&&void 0!==a?a:0!==this.arithmeticHelper.compare(E,v);case _Ast.AstNodeType.GREATER_THAN_OP:var f=this.evaluateAst(e.left,r),T=this.evaluateAst(e.right,r);return null!==(s=this.passErrors(f,T))&&void 0!==s?s:this.arithmeticHelper.compare(f,T)>0;case _Ast.AstNodeType.LESS_THAN_OP:var C=this.evaluateAst(e.left,r),g=this.evaluateAst(e.right,r);return null!==(i=this.passErrors(C,g))&&void 0!==i?i:this.arithmeticHelper.compare(C,g)<0;case _Ast.AstNodeType.GREATER_THAN_OR_EQUAL_OP:var N=this.evaluateAst(e.left,r),R=this.evaluateAst(e.right,r);return null!==(l=this.passErrors(N,R))&&void 0!==l?l:this.arithmeticHelper.compare(N,R)>=0;case _Ast.AstNodeType.LESS_THAN_OR_EQUAL_OP:var S=this.evaluateAst(e.left,r),b=this.evaluateAst(e.right,r);return null!==(o=this.passErrors(S,b))&&void 0!==o?o:this.arithmeticHelper.compare(S,b)<=0;case _Ast.AstNodeType.PLUS_OP:var O=this.evaluateAst(e.left,r),H=this.evaluateAst(e.right,r);return null!==(n=this.passErrors(O,H))&&void 0!==n?n:this.arithmeticHelper.add(this.arithmeticHelper.coerceScalarToNumberOrError(O),this.arithmeticHelper.coerceScalarToNumberOrError(H));case _Ast.AstNodeType.MINUS_OP:var w=this.evaluateAst(e.left,r),I=this.evaluateAst(e.right,r);return null!==(u=this.passErrors(w,I))&&void 0!==u?u:this.arithmeticHelper.subtract(this.arithmeticHelper.coerceScalarToNumberOrError(w),this.arithmeticHelper.coerceScalarToNumberOrError(I));case _Ast.AstNodeType.TIMES_OP:var P=this.evaluateAst(e.left,r),V=this.evaluateAst(e.right,r);return null!==(c=this.passErrors(P,V))&&void 0!==c?c:(0,_ArithmeticHelper.multiply)(this.arithmeticHelper.coerceScalarToNumberOrError(P),this.arithmeticHelper.coerceScalarToNumberOrError(V));case _Ast.AstNodeType.POWER_OP:var L=this.evaluateAst(e.left,r),x=this.evaluateAst(e.right,r);return null!==(p=this.passErrors(L,x))&&void 0!==p?p:(0,_ArithmeticHelper.power)(this.arithmeticHelper.coerceScalarToNumberOrError(L),this.arithmeticHelper.coerceScalarToNumberOrError(x));case _Ast.AstNodeType.DIV_OP:var q=this.evaluateAst(e.left,r),U=this.evaluateAst(e.right,r);return null!==(h=this.passErrors(q,U))&&void 0!==h?h:(0,_ArithmeticHelper.divide)(this.arithmeticHelper.coerceScalarToNumberOrError(q),this.arithmeticHelper.coerceScalarToNumberOrError(U));case _Ast.AstNodeType.PLUS_UNARY_OP:var M=this.evaluateAst(e.value,r);return M instanceof _InterpreterValue.SimpleRangeValue?new _Cell.CellError(_Cell.ErrorType.VALUE):M;case _Ast.AstNodeType.MINUS_UNARY_OP:var j=this.evaluateAst(e.value,r);return j instanceof _InterpreterValue.SimpleRangeValue?new _Cell.CellError(_Cell.ErrorType.VALUE):(0,_ArithmeticHelper.unaryminus)(this.arithmeticHelper.coerceScalarToNumberOrError(j));case _Ast.AstNodeType.PERCENT_OP:var G=this.evaluateAst(e.value,r);return G instanceof _InterpreterValue.SimpleRangeValue?new _Cell.CellError(_Cell.ErrorType.VALUE):(0,_ArithmeticHelper.percent)(this.arithmeticHelper.coerceScalarToNumberOrError(G));case _Ast.AstNodeType.FUNCTION_CALL:var k=this.functionRegistry.getFunction(e.procedureName);if(k&&this.config.translationPackage.isFunctionTranslated(e.procedureName)){var F=_slicedToArray(k,2),W=F[0];return F[1][W](e,r)}return new _Cell.CellError(_Cell.ErrorType.NAME);case _Ast.AstNodeType.NAMED_EXPRESSION:var D=this.namedExpressions.nearestNamedExpression(e.expressionName,r.sheet);return D?this.dependencyGraph.getCellValue(D.address):new _Cell.CellError(_Cell.ErrorType.NAME);case _Ast.AstNodeType.CELL_RANGE:if(!this.rangeSpansOneSheet(e))return new _Cell.CellError(_Cell.ErrorType.REF);var Q=_AbsoluteCellRange.AbsoluteCellRange.fromCellRange(e,r),B=this.dependencyGraph.getMatrix(Q);if(B){var Y=B.matrix;if(Y instanceof _Matrix.NotComputedMatrix)throw new Error("Matrix should be already computed");if(Y instanceof _Cell.CellError)return Y;if(Y instanceof _Matrix.Matrix)return _InterpreterValue.SimpleRangeValue.onlyNumbersDataWithRange(Y.raw(),Y.size,Q);throw new Error("Unknown matrix")}return _InterpreterValue.SimpleRangeValue.onlyRange(Q,this.dependencyGraph);case _Ast.AstNodeType.COLUMN_RANGE:if(!this.rangeSpansOneSheet(e))return new _Cell.CellError(_Cell.ErrorType.REF);var z=_AbsoluteCellRange.AbsoluteColumnRange.fromColumnRange(e,r);return _InterpreterValue.SimpleRangeValue.onlyRange(z,this.dependencyGraph);case _Ast.AstNodeType.ROW_RANGE:if(!this.rangeSpansOneSheet(e))return new _Cell.CellError(_Cell.ErrorType.REF);var X=_AbsoluteCellRange.AbsoluteRowRange.fromRowRange(e,r);return _InterpreterValue.SimpleRangeValue.onlyRange(X,this.dependencyGraph);case _Ast.AstNodeType.PARENTHESIS:return this.evaluateAst(e.expression,r);case _Ast.AstNodeType.ERROR_WITH_RAW_INPUT:case _Ast.AstNodeType.ERROR:return e.error}}},{key:"getGpuInstance",value:function(){if(!this.gpu){var e=_gpu.default.GPU||_gpu.default;this.gpu=new e({mode:this.config.gpuMode})}return this.gpu}},{key:"destroy",value:function(){this.gpu&&this.gpu.destroy()}},{key:"rangeSpansOneSheet",value:function(e){return e.start.sheet===e.end.sheet}},{key:"passErrors",value:function(e,r){return e instanceof _Cell.CellError?e:e instanceof _InterpreterValue.SimpleRangeValue?new _Cell.CellError(_Cell.ErrorType.VALUE):r instanceof _Cell.CellError?r:r instanceof _InterpreterValue.SimpleRangeValue?new _Cell.CellError(_Cell.ErrorType.VALUE):void 0}}]),e}();exports.Interpreter=Interpreter;
//# sourceMappingURL=/sm/a0dbf1c0b60aedb6954944544abd348501e05bb271d7c83b4584189ac3bbf0d6.map