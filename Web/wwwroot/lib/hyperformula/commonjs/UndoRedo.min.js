/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/hyperformula@0.1.3/commonjs/UndoRedo.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";require("core-js/modules/es.symbol"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.symbol.iterator"),require("core-js/modules/es.array.from"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.array.slice"),require("core-js/modules/es.array.splice"),require("core-js/modules/es.function.name"),require("core-js/modules/es.map"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/es.string.iterator"),require("core-js/modules/web.dom-collections.iterator"),exports.__esModule=!0,exports.UndoRedo=exports.BatchUndoEntry=exports.ChangeNamedExpressionUndoEntry=exports.RemoveNamedExpressionUndoEntry=exports.AddNamedExpressionUndoEntry=exports.PasteUndoEntry=exports.SetCellContentsUndoEntry=exports.ClearSheetUndoEntry=exports.RenameSheetUndoEntry=exports.RemoveSheetUndoEntry=exports.AddSheetUndoEntry=exports.RemoveColumnsUndoEntry=exports.AddColumnsUndoEntry=exports.MoveColumnsUndoEntry=exports.MoveRowsUndoEntry=exports.SetSheetContentUndoEntry=exports.AddRowsUndoEntry=exports.MoveCellsUndoEntry=exports.RemoveRowsUndoEntry=void 0,require("regenerator-runtime/runtime");var _Cell=require("./Cell"),_Operations=require("./Operations");function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var o=[],n=!0,r=!1,s=void 0;try{for(var a,i=e[Symbol.iterator]();!(n=(a=i.next()).done)&&(o.push(a.value),!t||o.length!==t);n=!0);}catch(e){r=!0,s=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw s}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var o;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,i=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return a=e.done,e},e:function(e){i=!0,s=e},f:function(){try{a||null==o.return||o.return()}finally{if(i)throw s}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var RemoveRowsUndoEntry=function e(t,o){_classCallCheck(this,e),this.command=t,this.rowsRemovals=o};exports.RemoveRowsUndoEntry=RemoveRowsUndoEntry;var MoveCellsUndoEntry=function e(t,o,n,r,s,a,i){_classCallCheck(this,e),this.sourceLeftCorner=t,this.width=o,this.height=n,this.destinationLeftCorner=r,this.overwrittenCellsData=s,this.addedGlobalNamedExpressions=a,this.version=i};exports.MoveCellsUndoEntry=MoveCellsUndoEntry;var AddRowsUndoEntry=function e(t){_classCallCheck(this,e),this.command=t};exports.AddRowsUndoEntry=AddRowsUndoEntry;var SetSheetContentUndoEntry=function e(t,o,n){_classCallCheck(this,e),this.sheetId=t,this.oldSheetContent=o,this.newSheetContent=n};exports.SetSheetContentUndoEntry=SetSheetContentUndoEntry;var MoveRowsUndoEntry=function e(t,o,n,r){_classCallCheck(this,e),this.sheet=t,this.startRow=o,this.numberOfRows=n,this.targetRow=r};exports.MoveRowsUndoEntry=MoveRowsUndoEntry;var MoveColumnsUndoEntry=function e(t,o,n,r){_classCallCheck(this,e),this.sheet=t,this.startColumn=o,this.numberOfColumns=n,this.targetColumn=r};exports.MoveColumnsUndoEntry=MoveColumnsUndoEntry;var AddColumnsUndoEntry=function e(t){_classCallCheck(this,e),this.command=t};exports.AddColumnsUndoEntry=AddColumnsUndoEntry;var RemoveColumnsUndoEntry=function e(t,o){_classCallCheck(this,e),this.command=t,this.columnsRemovals=o};exports.RemoveColumnsUndoEntry=RemoveColumnsUndoEntry;var AddSheetUndoEntry=function e(t){_classCallCheck(this,e),this.sheetName=t};exports.AddSheetUndoEntry=AddSheetUndoEntry;var RemoveSheetUndoEntry=function e(t,o,n,r){_classCallCheck(this,e),this.sheetName=t,this.sheetId=o,this.oldSheetContent=n,this.version=r};exports.RemoveSheetUndoEntry=RemoveSheetUndoEntry;var RenameSheetUndoEntry=function e(t,o,n){_classCallCheck(this,e),this.sheetId=t,this.oldName=o,this.newName=n};exports.RenameSheetUndoEntry=RenameSheetUndoEntry;var ClearSheetUndoEntry=function e(t,o){_classCallCheck(this,e),this.sheetId=t,this.oldSheetContent=o};exports.ClearSheetUndoEntry=ClearSheetUndoEntry;var SetCellContentsUndoEntry=function e(t){_classCallCheck(this,e),this.cellContents=t};exports.SetCellContentsUndoEntry=SetCellContentsUndoEntry;var PasteUndoEntry=function e(t,o,n,r){_classCallCheck(this,e),this.targetLeftCorner=t,this.oldContent=o,this.newContent=n,this.addedGlobalNamedExpressions=r};exports.PasteUndoEntry=PasteUndoEntry;var AddNamedExpressionUndoEntry=function e(t,o,n,r){_classCallCheck(this,e),this.name=t,this.newContent=o,this.scope=n,this.options=r};exports.AddNamedExpressionUndoEntry=AddNamedExpressionUndoEntry;var RemoveNamedExpressionUndoEntry=function e(t,o,n){_classCallCheck(this,e),this.namedExpression=t,this.content=o,this.scope=n};exports.RemoveNamedExpressionUndoEntry=RemoveNamedExpressionUndoEntry;var ChangeNamedExpressionUndoEntry=function e(t,o,n,r,s){_classCallCheck(this,e),this.namedExpression=t,this.newContent=o,this.oldContent=n,this.scope=r,this.options=s};exports.ChangeNamedExpressionUndoEntry=ChangeNamedExpressionUndoEntry;var BatchUndoEntry=function(){function e(){_classCallCheck(this,e),this.operations=[]}return _createClass(e,[{key:"add",value:function(e){this.operations.push(e)}},{key:"reversedOperations",value:regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.operations.length-1;case 1:if(!(t>=0)){e.next=7;break}return e.next=4,this.operations[t];case 4:t--,e.next=1;break;case 7:case"end":return e.stop()}},e,this)})}]),e}();exports.BatchUndoEntry=BatchUndoEntry;var UndoRedo=function(){function e(t,o){_classCallCheck(this,e),this.operations=o,this.undoStack=[],this.redoStack=[],this.oldData=new Map,this.undoLimit=t.undoLimit}return _createClass(e,[{key:"saveOperation",value:function(e){void 0!==this.batchUndoEntry?this.batchUndoEntry.add(e):this.addUndoEntry(e)}},{key:"beginBatchMode",value:function(){this.batchUndoEntry=new BatchUndoEntry}},{key:"addUndoEntry",value:function(e){this.undoStack.push(e),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}},{key:"commitBatchMode",value:function(){if(void 0===this.batchUndoEntry)throw"Batch mode wasn't started";this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}},{key:"storeDataForVersion",value:function(e,t,o){this.oldData.has(e)||this.oldData.set(e,[]),this.oldData.get(e).push([t,o])}},{key:"clearRedoStack",value:function(){this.redoStack=[]}},{key:"clearUndoStack",value:function(){this.undoStack=[]}},{key:"isUndoStackEmpty",value:function(){return 0===this.undoStack.length}},{key:"isRedoStackEmpty",value:function(){return 0===this.redoStack.length}},{key:"undo",value:function(){var e=this.undoStack.pop();if(!e)throw"Attempted to undo without operation on stack";this.undoEntry(e),this.redoStack.push(e)}},{key:"undoEntry",value:function(e){if(e instanceof RemoveRowsUndoEntry)this.undoRemoveRows(e);else if(e instanceof AddRowsUndoEntry)this.undoAddRows(e);else if(e instanceof SetCellContentsUndoEntry)this.undoSetCellContents(e);else if(e instanceof MoveRowsUndoEntry)this.undoMoveRows(e);else if(e instanceof AddSheetUndoEntry)this.undoAddSheet(e);else if(e instanceof RemoveSheetUndoEntry)this.undoRemoveSheet(e);else if(e instanceof RenameSheetUndoEntry)this.undoRenameSheet(e);else if(e instanceof ClearSheetUndoEntry)this.undoClearSheet(e);else if(e instanceof AddColumnsUndoEntry)this.undoAddColumns(e);else if(e instanceof RemoveColumnsUndoEntry)this.undoRemoveColumns(e);else if(e instanceof MoveColumnsUndoEntry)this.undoMoveColumns(e);else if(e instanceof MoveCellsUndoEntry)this.undoMoveCells(e);else if(e instanceof SetSheetContentUndoEntry)this.undoSetSheetContent(e);else if(e instanceof PasteUndoEntry)this.undoPaste(e);else if(e instanceof BatchUndoEntry)this.undoBatch(e);else if(e instanceof AddNamedExpressionUndoEntry)this.undoAddNamedExpression(e);else if(e instanceof RemoveNamedExpressionUndoEntry)this.undoRemoveNamedExpression(e);else{if(!(e instanceof ChangeNamedExpressionUndoEntry))throw"Unknown element";this.undoChangeNamedExpression(e)}}},{key:"undoBatch",value:function(e){var t,o=_createForOfIteratorHelper(e.reversedOperations());try{for(o.s();!(t=o.n()).done;){var n=t.value;this.undoEntry(n)}}catch(e){o.e(e)}finally{o.f()}}},{key:"undoRemoveRows",value:function(e){this.operations.forceApplyPostponedTransformations();for(var t=e.command.sheet,o=e.rowsRemovals,n=o.length-1;n>=0;--n){var r=o[n];this.operations.addRows(new _Operations.AddRowsCommand(t,[[r.rowFrom,r.rowCount]]));var s,a=_createForOfIteratorHelper(r.removedCells);try{for(a.s();!(s=a.n()).done;){var i=s.value,d=i.address,l=i.cellType;this.operations.restoreCell(d,l)}}catch(e){a.e(e)}finally{a.f()}this.restoreOldDataFromVersion(r.version-1)}}},{key:"undoRemoveColumns",value:function(e){this.operations.forceApplyPostponedTransformations();for(var t=e.command.sheet,o=e.columnsRemovals,n=o.length-1;n>=0;--n){var r=o[n];this.operations.addColumns(new _Operations.AddColumnsCommand(t,[[r.columnFrom,r.columnCount]]));var s,a=_createForOfIteratorHelper(r.removedCells);try{for(a.s();!(s=a.n()).done;){var i=s.value,d=i.address,l=i.cellType;this.operations.restoreCell(d,l)}}catch(e){a.e(e)}finally{a.f()}this.restoreOldDataFromVersion(r.version-1)}}},{key:"undoAddRows",value:function(e){for(var t=e.command.rowsSpans(),o=t.length-1;o>=0;--o){var n=t[o];this.operations.removeRows(new _Operations.RemoveRowsCommand(e.command.sheet,[[n.rowStart,n.numberOfRows]]))}}},{key:"undoAddColumns",value:function(e){for(var t=e.command.columnsSpans(),o=t.length-1;o>=0;--o){var n=t[o];this.operations.removeColumns(new _Operations.RemoveColumnsCommand(e.command.sheet,[[n.columnStart,n.numberOfColumns]]))}}},{key:"undoSetCellContents",value:function(e){var t,o=_createForOfIteratorHelper(e.cellContents);try{for(o.s();!(t=o.n()).done;){var n=t.value;this.operations.restoreCell(n.address,n.oldContent)}}catch(e){o.e(e)}finally{o.f()}}},{key:"undoPaste",value:function(e){var t,o=_createForOfIteratorHelper(e.oldContent);try{for(o.s();!(t=o.n()).done;){var n=_slicedToArray(t.value,2),r=n[0],s=n[1];this.operations.restoreCell(r,s)}}catch(e){o.e(e)}finally{o.f()}var a,i=_createForOfIteratorHelper(e.addedGlobalNamedExpressions);try{for(i.s();!(a=i.n()).done;){var d=a.value;this.operations.removeNamedExpression(d)}}catch(e){i.e(e)}finally{i.f()}}},{key:"undoMoveRows",value:function(e){var t=e.sheet;this.operations.moveRows(t,e.targetRow-e.numberOfRows,e.numberOfRows,e.startRow)}},{key:"undoMoveColumns",value:function(e){var t=e.sheet;this.operations.moveColumns(t,e.targetColumn-e.numberOfColumns,e.numberOfColumns,e.startColumn)}},{key:"undoMoveCells",value:function(e){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(e.destinationLeftCorner,e.width,e.height,e.sourceLeftCorner);var t,o=_createForOfIteratorHelper(e.overwrittenCellsData);try{for(o.s();!(t=o.n()).done;){var n=_slicedToArray(t.value,2),r=n[0],s=n[1];this.operations.restoreCell(r,s)}}catch(e){o.e(e)}finally{o.f()}this.restoreOldDataFromVersion(e.version-1);var a,i=_createForOfIteratorHelper(e.addedGlobalNamedExpressions);try{for(i.s();!(a=i.n()).done;){var d=a.value;this.operations.removeNamedExpression(d)}}catch(e){i.e(e)}finally{i.f()}}},{key:"undoAddSheet",value:function(e){var t=e.sheetName;this.operations.removeSheet(t)}},{key:"undoRemoveSheet",value:function(e){this.operations.forceApplyPostponedTransformations();var t=e.oldSheetContent,o=e.sheetId;this.operations.addSheet(e.sheetName);for(var n=0;n<t.length;n++)for(var r=t[n],s=0;s<r.length;s++){var a=r[s],i=(0,_Cell.simpleCellAddress)(o,s,n);this.operations.restoreCell(i,a)}this.restoreOldDataFromVersion(e.version-1)}},{key:"undoRenameSheet",value:function(e){this.operations.renameSheet(e.sheetId,e.oldName)}},{key:"undoClearSheet",value:function(e){for(var t=e.oldSheetContent,o=e.sheetId,n=0;n<t.length;n++)for(var r=t[n],s=0;s<r.length;s++){var a=r[s],i=(0,_Cell.simpleCellAddress)(o,s,n);this.operations.restoreCell(i,a)}}},{key:"undoSetSheetContent",value:function(e){var t=e.oldSheetContent,o=(e.newSheetContent,e.sheetId);this.operations.clearSheet(o);for(var n=0;n<t.length;n++)for(var r=t[n],s=0;s<r.length;s++){var a=r[s],i=(0,_Cell.simpleCellAddress)(o,s,n);this.operations.restoreCell(i,a)}}},{key:"undoAddNamedExpression",value:function(e){this.operations.removeNamedExpression(e.name,e.scope)}},{key:"undoRemoveNamedExpression",value:function(e){this.operations.restoreNamedExpression(e.namedExpression,e.content,e.scope)}},{key:"undoChangeNamedExpression",value:function(e){this.operations.restoreNamedExpression(e.namedExpression,e.oldContent,e.scope)}},{key:"redo",value:function(){var e=this.redoStack.pop();if(!e)throw"Attempted to redo without operation on stack";this.redoEntry(e),this.undoStack.push(e)}},{key:"redoEntry",value:function(e){if(e instanceof RemoveRowsUndoEntry)this.redoRemoveRows(e);else if(e instanceof RemoveRowsUndoEntry)this.redoRemoveRows(e);else if(e instanceof AddRowsUndoEntry)this.redoAddRows(e);else if(e instanceof SetCellContentsUndoEntry)this.redoSetCellContents(e);else if(e instanceof MoveRowsUndoEntry)this.redoMoveRows(e);else if(e instanceof AddSheetUndoEntry)this.redoAddSheet(e);else if(e instanceof RemoveSheetUndoEntry)this.redoRemoveSheet(e);else if(e instanceof RenameSheetUndoEntry)this.redoRenameSheet(e);else if(e instanceof ClearSheetUndoEntry)this.redoClearSheet(e);else if(e instanceof AddColumnsUndoEntry)this.redoAddColumns(e);else if(e instanceof RemoveColumnsUndoEntry)this.redoRemoveColumns(e);else if(e instanceof MoveColumnsUndoEntry)this.redoMoveColumns(e);else if(e instanceof MoveCellsUndoEntry)this.redoMoveCells(e);else if(e instanceof SetSheetContentUndoEntry)this.redoSetSheetContent(e);else if(e instanceof PasteUndoEntry)this.redoPaste(e);else if(e instanceof BatchUndoEntry)this.redoBatch(e);else if(e instanceof AddNamedExpressionUndoEntry)this.redoAddNamedExpression(e);else if(e instanceof RemoveNamedExpressionUndoEntry)this.redoRemoveNamedExpression(e);else{if(!(e instanceof ChangeNamedExpressionUndoEntry))throw"Unknown element";this.redoChangeNamedExpression(e)}}},{key:"redoBatch",value:function(e){var t,o=_createForOfIteratorHelper(e.operations);try{for(o.s();!(t=o.n()).done;){var n=t.value;this.redoEntry(n)}}catch(e){o.e(e)}finally{o.f()}}},{key:"redoRemoveRows",value:function(e){this.operations.removeRows(e.command)}},{key:"redoMoveCells",value:function(e){this.operations.moveCells(e.sourceLeftCorner,e.width,e.height,e.destinationLeftCorner)}},{key:"redoRemoveColumns",value:function(e){this.operations.removeColumns(e.command)}},{key:"redoPaste",value:function(e){for(var t=e.targetLeftCorner,o=e.newContent,n=o.length,r=o[0].length,s=0;s<n;++s)for(var a=0;a<r;++a){var i=(0,_Cell.simpleCellAddress)(t.sheet,t.col+a,t.row+s);this.operations.restoreCell(i,o[s][a])}}},{key:"redoSetCellContents",value:function(e){var t,o=_createForOfIteratorHelper(e.cellContents);try{for(o.s();!(t=o.n()).done;){var n=t.value;this.operations.setCellContent(n.address,n.newContent)}}catch(e){o.e(e)}finally{o.f()}}},{key:"redoAddRows",value:function(e){this.operations.addRows(e.command)}},{key:"redoAddColumns",value:function(e){this.operations.addColumns(e.command)}},{key:"redoRemoveSheet",value:function(e){this.operations.removeSheet(e.sheetName)}},{key:"redoAddSheet",value:function(e){this.operations.addSheet(e.sheetName)}},{key:"redoRenameSheet",value:function(e){this.operations.renameSheet(e.sheetId,e.newName)}},{key:"redoMoveRows",value:function(e){this.operations.moveRows(e.sheet,e.startRow,e.numberOfRows,e.targetRow)}},{key:"redoMoveColumns",value:function(e){this.operations.moveColumns(e.sheet,e.startColumn,e.numberOfColumns,e.targetColumn)}},{key:"redoClearSheet",value:function(e){this.operations.clearSheet(e.sheetId)}},{key:"redoSetSheetContent",value:function(e){var t=e.sheetId,o=e.newSheetContent;this.operations.setSheetContent(t,o)}},{key:"redoAddNamedExpression",value:function(e){this.operations.addNamedExpression(e.name,e.newContent,e.scope,e.options)}},{key:"redoRemoveNamedExpression",value:function(e){this.operations.removeNamedExpression(e.namedExpression.displayName,e.scope)}},{key:"redoChangeNamedExpression",value:function(e){this.operations.changeNamedExpressionExpression(e.namedExpression.displayName,e.newContent,e.scope,e.options)}},{key:"restoreOldDataFromVersion",value:function(e){var t,o=_createForOfIteratorHelper(this.oldData.get(e)||[]);try{for(o.s();!(t=o.n()).done;){var n=_slicedToArray(t.value,2),r=n[0],s=n[1];this.operations.setFormulaToCellFromCache(s,r)}}catch(e){o.e(e)}finally{o.f()}}}]),e}();exports.UndoRedo=UndoRedo;
//# sourceMappingURL=/sm/37657f3a83326229953df5ecbd4e7f94e25a36cae4d6c5ef3228c6c046e3e239.map